
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NO2 over Spain with CAMS European air quality analysis using RELIANCE services &#8212; Showcase Jupyter notebooks series</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Notebooks from researchers" href="../science/intro.html" />
    <link rel="prev" title="PM10 over Norway with CAMS European air quality analysis using RELIANCE services" href="RELIANCE_Norway_PM10.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/reliance-icon.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Showcase Jupyter notebooks series</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../welcome.html">
   Welcome to RELIANCE showcase series
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  About
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../CONDUCT.html">
   Code of Conduct
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../LICENSE.html">
   LICENSE
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  ADAM service jupyter notebooks
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../adam/setup.html">
   ADAM service
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../adam/notebooks/MOD_AquaCHL_ADAM.html">
     Using ADAM-API to access MODIS Aqua CHL
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../adam/notebooks/UERRA_ADAM.html">
     Using ADAM-API to access UERRA regional reanalysis
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  ROHUB service jupyter notebooks
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../rohub/setup.html">
   ROHUB service
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../rohub/notebooks/ROHub-library-prod-demo.html">
     Example to use Rohub from Jupyter notebook
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rohub/notebooks/Sharing-files-EGI-DataHub.html">
     WORKING WITH EGI DATAHUB
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Scientific showcase series
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../science/eosc-future.html">
   EOSC-Future demo
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="README.html">
     Demo for EOSC-Future
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="RELIANCE-Datacube-featuring-EOSC.html">
     Using CAMS European air quality analysis from Copernicus Atmosphere Monitoring with RELIANCE services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="RELIANCE_France_PM10.html">
     PM10 over France with CAMS European air quality analysis using RELIANCE services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="RELIANCE_Italy_NO2.html">
     NO2 over Italy with CAMS European air quality analysis using RELIANCE services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="RELIANCE_Norway-Viken_NO2.html">
     NO2 over Viken &amp; Oslo (Norway) with CAMS European air quality analysis using RELIANCE services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="RELIANCE_Norway-Viken_PM10.html">
     PM10 over Viken &amp; Oslo (Norway) with CAMS European air quality analysis using RELIANCE services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="RELIANCE_Norway-Viken_PM25.html">
     PM2.5 over Viken &amp; Oslo (Norway) with CAMS European air quality analysis using RELIANCE services
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="RELIANCE_Norway_PM10.html">
     PM10 over Norway with CAMS European air quality analysis using RELIANCE services
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     NO2 over Spain with CAMS European air quality analysis using RELIANCE services
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../science/intro.html">
   Notebooks from researchers
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../science/notebooks/CMIP6_hr_1985-2014.html">
     Example with high-resolution CMIP6 models (~100 km) using Pangeo catalog
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../science/notebooks/ERA5_1985-2014.html">
     Cloud feedback Analysis with ERA5 high-resolution (~0.25deg) monthly means
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../science/notebooks/Urban-heat-island-ERA5-Land.html">
     Urban Heat Island effect in Fortaleza, Brazil
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../science/notebooks/air_quality_lockdown.html">
     Impact of the Covid-19 Lockdown on Air quality over Europe
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../science/notebooks/comparisons_with_air_quality_measurements.html">
     Jupyter notebook comparing CAMS and air quality measurements
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/demo-eosc-future/RELIANCE_Spain_NO2_month.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/NordicESMHub/RELIANCE"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/NordicESMHub/RELIANCE/issues/new?title=Issue%20on%20page%20%2Fdemo-eosc-future/RELIANCE_Spain_NO2_month.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/NordicESMHub/RELIANCE/main?urlpath=tree/content/demo-eosc-future/RELIANCE_Spain_NO2_month.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analysis-over-a-particular-country-and-a-town-in-the-country-of-interest">
   Analysis over a particular country and a town in the country of interest
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#step-1-data-management">
   <strong>
    Step 1: Data Management
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#authors">
     Authors
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-the-university-of-olso-and-the-nordic-e-infrastructure-collaboration-as-publishers">
     Add the University of Olso and the Nordic e-Infrastructure Collaboration as publishers
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-the-funding">
     Add the funding
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#choose-a-license-for-your-fair-digital-object">
     Choose a license for your FAIR digital object
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#organize-my-data-using-egi-datahub">
     Organize my data using EGI datahub
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#import-python-packages">
     Import Python packages
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#initialization">
   Initialization
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#choose-the-country-of-interest">
     Choose the country of interest
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#geojson-for-selecting-data-from-adam">
     Geojson for selecting data from ADAM
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-folders">
     Create folders
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#geojson-file-for-selecting-data-from-adam">
     Geojson file for selecting data from ADAM
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#show-area-of-interest">
     Show area of interest
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-2-authentication-a-step-2-authentication">
   <a id="2_Authentication">
   </a>
   <strong>
    Step 2: Authentication
   </strong>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-3-datasets-discovery-a-step-3-datasets-discovery">
   <a id="3_Datasets_Discovery">
   </a>
   <strong>
    Step 3: Datasets Discovery
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pre-filter-datasets">
     Pre-filter datasets
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-4-products-discovery-a-step-4-products-discovery">
   <a id="4_Products_Discovery">
   </a>
   <strong>
    Step 4: Products Discovery
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#search-data">
     Search data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-5-data-access-a-step-5-data-access">
   <a id="5_Data_Access">
   </a>
   <strong>
    Step 5: Data Access
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-a-function-to-select-a-time-range-and-get-data">
     Define a function to select a time range and get data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-variable-of-interest-for-each-day-of-the-month-we-study-for-2019-2020-and-2021-time-00-00-00">
     Get variable of interest for each day of the month we study for 2019, 2020 and 2021 (time 00:00:00)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-6-data-analysis-visualization-a-step-6-data-analysis-and-visualization">
   <a id="6_Data_Analysis_Visualization">
   </a>
   <strong>
    Step 6: Data Analysis and Visualization
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unzip-data">
     Unzip data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-data-and-make-a-monthly-average">
     Read data and make a monthly average
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#analyze-data">
     Analyze data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualize-data">
     Visualize data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-one-single-date">
     Plot one single date
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#save-data-cube-selection-into-netcdf">
     Save Data Cube selection into netCDF
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-7-rohub-a-step-7-create-research-object-and-share-my-work">
   <a id="7_rohub">
   </a>
   <strong>
    Step 7: Create Research Object and Share my work
   </strong>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-research-object-in-rohub">
   Create Research Object in ROHUB
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#authenticating">
     Authenticating
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-a-new-exectuable-ro">
   Create a new Exectuable RO
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#show-metadata">
   Show metadata
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-additional-authors-and-or-contributors-to-our-research-object">
   Add additional authors and/or contributors to our Research Object
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-publisher-copyright-holder">
   Add publisher/copyright holder
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-publishers">
     Add publishers
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-ro-funding-information">
   Add RO Funding information
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-ro-license">
   Add RO license
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aggregate-resources">
   Aggregate Resources
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#list-ro-folders-for-this-type-of-ro">
     List RO folders for this type of RO
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aggregate-internal-resources">
   Aggregate internal resources
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-sketch-to-my-ro">
     Add sketch to my RO
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-conda-environment-to-my-ro">
     Add conda environment to my RO
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aggregate-external-resources">
   Aggregate external resources
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-shared-link-from-datahub">
     Get shared link from datahub
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#egi-datahub-functions-to-initialize-egi-datahub-and-get-shared-link">
       EGI Datahub functions to initialize EGI datahub and get shared link
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#egi-datahub-initialization">
     EGI DataHub initialization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-inputs-to-my-ro">
   Add inputs to my RO
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#geojson-file-used-for-rertieving-data-from-adam-data-cube">
     Geojson file used for rertieving data from ADAM data-cube
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#input-data-retrieved-from-adam-data-cube">
     Input data retrieved from ADAM data-cube
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-our-jupyter-notebook-to-our-ro">
     Add our Jupyter Notebook to our RO
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#copy-current-notebook-to-shared-datahub">
       Copy current notebook to shared datahub
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-a-shared-link-for-my-jupyter-notebook">
     Create a shared link for my Jupyter Notebook
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#get-public-url-from-egi-datahub-to-share-link-in-ro">
       Get public URL from EGI Datahub to share link in RO
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-link-to-jupyter-notebook-in-github">
       Add link to Jupyter notebook in github
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-link-to-online-rendered-jupyter-notebook">
       Add link to online rendered Jupyter notebook
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-first-plot-as-image-to-my-research-object-external-resource-from-egi-datahub">
       Add first plot as Image to my Research Object (external resource from EGI Datahub)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-second-plot-as-image-to-my-research-object-external-resource-from-egi-datahub">
       Add second plot as Image to my Research Object (external resource from EGI Datahub)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-netcdf-file-corresponding-to-data-cube-selection-external-resource-from-egi-datahub">
       Add netCDF file corresponding to Data cube selection (external resource from EGI Datahub)
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-metadata-for-the-ro">
   Additional metadata for the RO
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-geolocation-to-my-research-object">
     Add geolocation to my Research Object
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-tags">
     Add tags
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#export-to-ro-crate">
     Export to RO-crate
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#take-a-snapshot-of-my-ro">
     Take a snapshot of my RO
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#archive-and-publish-to-zenodo-optionally-assign-doi">
     Archive and publish to Zenodo, optionally assign DOI
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-the-published-research-object">
     Load the published Research Object
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#show-the-doi-and-get-the-link">
     Show the DOI and get the link
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fork-and-reuse-existing-ro-to-create-derivative-work">
     Fork and reuse existing RO to create derivative work
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>NO2 over Spain with CAMS European air quality analysis using RELIANCE services</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analysis-over-a-particular-country-and-a-town-in-the-country-of-interest">
   Analysis over a particular country and a town in the country of interest
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#step-1-data-management">
   <strong>
    Step 1: Data Management
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#authors">
     Authors
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-the-university-of-olso-and-the-nordic-e-infrastructure-collaboration-as-publishers">
     Add the University of Olso and the Nordic e-Infrastructure Collaboration as publishers
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-the-funding">
     Add the funding
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#choose-a-license-for-your-fair-digital-object">
     Choose a license for your FAIR digital object
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#organize-my-data-using-egi-datahub">
     Organize my data using EGI datahub
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#import-python-packages">
     Import Python packages
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#initialization">
   Initialization
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#choose-the-country-of-interest">
     Choose the country of interest
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#geojson-for-selecting-data-from-adam">
     Geojson for selecting data from ADAM
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-folders">
     Create folders
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#geojson-file-for-selecting-data-from-adam">
     Geojson file for selecting data from ADAM
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#show-area-of-interest">
     Show area of interest
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-2-authentication-a-step-2-authentication">
   <a id="2_Authentication">
   </a>
   <strong>
    Step 2: Authentication
   </strong>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-3-datasets-discovery-a-step-3-datasets-discovery">
   <a id="3_Datasets_Discovery">
   </a>
   <strong>
    Step 3: Datasets Discovery
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pre-filter-datasets">
     Pre-filter datasets
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-4-products-discovery-a-step-4-products-discovery">
   <a id="4_Products_Discovery">
   </a>
   <strong>
    Step 4: Products Discovery
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#search-data">
     Search data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-5-data-access-a-step-5-data-access">
   <a id="5_Data_Access">
   </a>
   <strong>
    Step 5: Data Access
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-a-function-to-select-a-time-range-and-get-data">
     Define a function to select a time range and get data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-variable-of-interest-for-each-day-of-the-month-we-study-for-2019-2020-and-2021-time-00-00-00">
     Get variable of interest for each day of the month we study for 2019, 2020 and 2021 (time 00:00:00)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-6-data-analysis-visualization-a-step-6-data-analysis-and-visualization">
   <a id="6_Data_Analysis_Visualization">
   </a>
   <strong>
    Step 6: Data Analysis and Visualization
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unzip-data">
     Unzip data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-data-and-make-a-monthly-average">
     Read data and make a monthly average
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#analyze-data">
     Analyze data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualize-data">
     Visualize data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-one-single-date">
     Plot one single date
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#save-data-cube-selection-into-netcdf">
     Save Data Cube selection into netCDF
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-7-rohub-a-step-7-create-research-object-and-share-my-work">
   <a id="7_rohub">
   </a>
   <strong>
    Step 7: Create Research Object and Share my work
   </strong>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-research-object-in-rohub">
   Create Research Object in ROHUB
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#authenticating">
     Authenticating
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-a-new-exectuable-ro">
   Create a new Exectuable RO
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#show-metadata">
   Show metadata
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-additional-authors-and-or-contributors-to-our-research-object">
   Add additional authors and/or contributors to our Research Object
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-publisher-copyright-holder">
   Add publisher/copyright holder
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-publishers">
     Add publishers
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-ro-funding-information">
   Add RO Funding information
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-ro-license">
   Add RO license
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aggregate-resources">
   Aggregate Resources
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#list-ro-folders-for-this-type-of-ro">
     List RO folders for this type of RO
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aggregate-internal-resources">
   Aggregate internal resources
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-sketch-to-my-ro">
     Add sketch to my RO
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-conda-environment-to-my-ro">
     Add conda environment to my RO
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aggregate-external-resources">
   Aggregate external resources
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-shared-link-from-datahub">
     Get shared link from datahub
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#egi-datahub-functions-to-initialize-egi-datahub-and-get-shared-link">
       EGI Datahub functions to initialize EGI datahub and get shared link
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#egi-datahub-initialization">
     EGI DataHub initialization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-inputs-to-my-ro">
   Add inputs to my RO
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#geojson-file-used-for-rertieving-data-from-adam-data-cube">
     Geojson file used for rertieving data from ADAM data-cube
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#input-data-retrieved-from-adam-data-cube">
     Input data retrieved from ADAM data-cube
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-our-jupyter-notebook-to-our-ro">
     Add our Jupyter Notebook to our RO
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#copy-current-notebook-to-shared-datahub">
       Copy current notebook to shared datahub
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-a-shared-link-for-my-jupyter-notebook">
     Create a shared link for my Jupyter Notebook
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#get-public-url-from-egi-datahub-to-share-link-in-ro">
       Get public URL from EGI Datahub to share link in RO
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-link-to-jupyter-notebook-in-github">
       Add link to Jupyter notebook in github
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-link-to-online-rendered-jupyter-notebook">
       Add link to online rendered Jupyter notebook
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-first-plot-as-image-to-my-research-object-external-resource-from-egi-datahub">
       Add first plot as Image to my Research Object (external resource from EGI Datahub)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-second-plot-as-image-to-my-research-object-external-resource-from-egi-datahub">
       Add second plot as Image to my Research Object (external resource from EGI Datahub)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-netcdf-file-corresponding-to-data-cube-selection-external-resource-from-egi-datahub">
       Add netCDF file corresponding to Data cube selection (external resource from EGI Datahub)
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-metadata-for-the-ro">
   Additional metadata for the RO
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-geolocation-to-my-research-object">
     Add geolocation to my Research Object
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-tags">
     Add tags
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#export-to-ro-crate">
     Export to RO-crate
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#take-a-snapshot-of-my-ro">
     Take a snapshot of my RO
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#archive-and-publish-to-zenodo-optionally-assign-doi">
     Archive and publish to Zenodo, optionally assign DOI
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-the-published-research-object">
     Load the published Research Object
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#show-the-doi-and-get-the-link">
     Show the DOI and get the link
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fork-and-reuse-existing-ro-to-create-derivative-work">
     Fork and reuse existing RO to create derivative work
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <table style="width:100%">
  <tr>
    <th><img src='https://www.reliance-project.eu/wp-content/uploads/2021/03/Asset-8mdpi.svg' alt='Layout' class="left" width='65%'></img></th>
    <th><img src='https://raw.githubusercontent.com/RELIANCE-EOSC/rohub-portal-documentation/main/images/image58.png' alt='Layout' align='center' width='65%'></img></th>
    <th></img></p><img src='https://media-exp1.licdn.com/dms/image/C560BAQFFDze0s3l-pQ/company-logo_200_200/0?e=2159024400&v=beta&t=jG_sh9NpwE6yc2TspIcL2YUR2X7OBzTrRSu6w7sNYtc' alt='Layout' align='right' width='30%'></img></th>
  </tr>
</table>
<br>
<br><div class="tex2jax_ignore mathjax_ignore section" id="no2-over-spain-with-cams-european-air-quality-analysis-using-reliance-services">
<h1>NO2 over Spain with CAMS European air quality analysis using RELIANCE services<a class="headerlink" href="#no2-over-spain-with-cams-european-air-quality-analysis-using-reliance-services" title="Permalink to this headline">¶</a></h1>
<div class="section" id="analysis-over-a-particular-country-and-a-town-in-the-country-of-interest">
<h2>Analysis over a particular country and a town in the country of interest<a class="headerlink" href="#analysis-over-a-particular-country-and-a-town-in-the-country-of-interest" title="Permalink to this headline">¶</a></h2>
<div class="alert alert-success alert-info">
<b>How to discover RELIANCE datacube resources (spatial & temporal search and subsetting), share resources using EGI datahub, and use RoHub to create FAIR digital Objects</b></div><p>This notebook shows how to discover and access the <a class="reference external" href="https://ads.atmosphere.copernicus.eu/#%21/home">Copernicus Atmosphere Monitoring</a> products available in the <strong>RELIANCE</strong> datacube resources, by using the functionalities provided in the <font color='blue'> <strong>Adam API</strong> </font>. The process is structured in 7 steps, including example of data analysis and visualization with the Python libraries installed in the Jupyter environment as well as the creation of a FAIR digital object on <a class="reference external" href="https://reliance.rohub.org/">RoHUB</a> where all the resources used and generated in this notebook are aggregated.</p>
<p>You can customize this Jupyter notebook, for instance by updating the content of <a class="reference external" href="#1.Data_Management">Data Management</a> section.</p>
<ul class="simple">
<li><p><a class="reference external" href="#1_Data_Management">1. Data Management</a></p></li>
<li><p><a class="reference external" href="#2_Authentication">2. Authentication</a></p></li>
<li><p><a class="reference external" href="#3_Datasets_Discovery">3. Datasets Discovery</a></p></li>
<li><p><a class="reference external" href="#4_Products_Discovery">4. Products Discovery</a></p></li>
<li><p><a class="reference external" href="#5_Data_Access">5. Data Access</a></p></li>
<li><p><a class="reference external" href="#6_Data_Analysis_Visualization">6. Data Analysis and Visualizarion</a></p></li>
<li><p><a class="reference external" href="#7_rohub">7. Create Research Object and Share my work</a></p></li>
</ul>
<p><a id=1_Data_Management></a></p>
</div>
<div class="section" id="step-1-data-management">
<h2><strong>Step 1: Data Management</strong><a class="headerlink" href="#step-1-data-management" title="Permalink to this headline">¶</a></h2>
<div class="section" id="authors">
<h3>Authors<a class="headerlink" href="#authors" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Make sure you first register to RoHub at <a class="reference external" href="https://reliance.rohub.org/">https://reliance.rohub.org/</a>.</p></li>
<li><p>We recommend you use your <a class="reference external" href="https://orcid.org/">ORCID</a> identifier to login and register to EOSC services.</p></li>
<li><p>In the list of authors, add any co-authors using the email address they used when they registered in RoHub.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">author_emails</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;annefou@geo.uio.no&#39;</span><span class="p">]</span>
<span class="n">contributor_emails</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;jeani@uio.no&#39;</span><span class="p">,</span> <span class="s1">&#39;mantovani@meeo.it&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-the-university-of-olso-and-the-nordic-e-infrastructure-collaboration-as-publishers">
<h3>Add the University of Olso and the Nordic e-Infrastructure Collaboration as publishers<a class="headerlink" href="#add-the-university-of-olso-and-the-nordic-e-infrastructure-collaboration-as-publishers" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">UiO_organization</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;org_id&quot;</span><span class="p">:</span><span class="s2">&quot;http://www.uio.no/english/&quot;</span><span class="p">,</span> 
                     <span class="s2">&quot;display_name&quot;</span><span class="p">:</span> <span class="s2">&quot;University of Oslo&quot;</span><span class="p">,</span> 
                     <span class="s2">&quot;agent_type&quot;</span><span class="p">:</span> <span class="s2">&quot;organization&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;ror_identifier&quot;</span><span class="p">:</span><span class="s2">&quot;01xtthb56&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;organization_url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://www.uio.no/english/&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NeIC_organization</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;org_id&quot;</span><span class="p">:</span><span class="s2">&quot;https://neic.no/&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;display_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Nordic e-Infrastructure Collaboration&quot;</span><span class="p">,</span> 
                     <span class="s2">&quot;agent_type&quot;</span><span class="p">:</span> <span class="s2">&quot;organization&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ror_identifier&quot;</span><span class="p">:</span><span class="s2">&quot;04jcwf484&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;organization_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://neic.no/&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">list_publishers</span> <span class="o">=</span> <span class="p">[</span><span class="n">UiO_organization</span><span class="p">,</span> <span class="n">NeIC_organization</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">list_copyright_holders</span> <span class="o">=</span> <span class="p">[</span><span class="n">UiO_organization</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-the-funding">
<h3>Add the funding<a class="headerlink" href="#add-the-funding" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>if your work is not funded set</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">funded_by</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">funded_by</span> <span class="o">=</span> <span class="p">{</span>
<span class="s2">&quot;grant_id&quot;</span><span class="p">:</span> <span class="s2">&quot;101017502&quot;</span><span class="p">,</span>
<span class="s2">&quot;grant_Name&quot;</span><span class="p">:</span> <span class="s2">&quot;RELIANCE&quot;</span><span class="p">,</span>
<span class="s2">&quot;grant_title&quot;</span><span class="p">:</span> <span class="s2">&quot;Research Lifecycle Management for Earth Science Communities and Copernicus Users&quot;</span><span class="p">,</span>
<span class="s2">&quot;funder_name&quot;</span><span class="p">:</span> <span class="s2">&quot;European Commission&quot;</span><span class="p">,</span>
<span class="s2">&quot;funder_doi&quot;</span><span class="p">:</span> <span class="s2">&quot;10.13039/501100000781&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="choose-a-license-for-your-fair-digital-object">
<h3>Choose a license for your FAIR digital object<a class="headerlink" href="#choose-a-license-for-your-fair-digital-object" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">rohub</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rohub</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">licenses</span> <span class="o">=</span> <span class="n">rohub</span><span class="o">.</span><span class="n">list_available_licenses</span><span class="p">()</span>
<span class="c1"># Update line below to print more licenses</span>
<span class="n">licenses</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">license</span> <span class="o">=</span> <span class="s1">&#39;MIT&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="organize-my-data-using-egi-datahub">
<h3>Organize my data using EGI datahub<a class="headerlink" href="#organize-my-data-using-egi-datahub" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Define a prefix for my project (you may need to adjust it for your own usage on your infrastructure).</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">input</span></code> folder where all the data used as input to my Jupyter Notebook is stored (and eventually shared)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output</span></code> folder where all the results to keep are stored</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tool</span></code> folder where all the tools, including this Jupyter Notebook will be copied for sharing</p></li>
</ul>
</li>
<li><p>Create all corresponding folders</p></li>
</ul>
</div>
<div class="section" id="import-python-packages">
<h3>Import Python packages<a class="headerlink" href="#import-python-packages" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="initialization">
<h2>Initialization<a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Choose a country and add its name and country code</p></li>
<li><p>Choose the variable to analyze (PM10, PM25, NO2, O3, etc.)</p></li>
<li><p>Choose the area for your analysis</p></li>
</ul>
<div class="section" id="choose-the-country-of-interest">
<h3>Choose the country of interest<a class="headerlink" href="#choose-the-country-of-interest" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">country_code</span> <span class="o">=</span> <span class="s1">&#39;ES&#39;</span> 
<span class="n">country_fullname</span> <span class="o">=</span> <span class="s2">&quot;Spain&quot;</span>
<span class="n">town_fullname</span> <span class="o">=</span> <span class="s1">&#39;Madrid&#39;</span> 
<span class="n">town_coordinates</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="mf">40.4168</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="mf">3.7038</span><span class="p">}</span>
<span class="n">variable_name</span> <span class="o">=</span> <span class="s1">&#39;NO2&#39;</span>
<span class="n">variable_unit</span> <span class="o">=</span> <span class="s1">&#39;µg m-3&#39;</span>
<span class="n">variable_long_name</span> <span class="o">=</span> <span class="s1">&#39;Nitrogen Dioxide&#39;</span>
<span class="n">month_name</span> <span class="o">=</span> <span class="s1">&#39;April&#39;</span>
<span class="n">month_number</span> <span class="o">=</span> <span class="s1">&#39;04&#39;</span>
<span class="n">month_nb_days</span> <span class="o">=</span> <span class="s1">&#39;30&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="geojson-for-selecting-data-from-adam">
<h3>Geojson for selecting data from ADAM<a class="headerlink" href="#geojson-for-selecting-data-from-adam" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The geometry field is extracted from a GeoJSON file, retrieving the value of the “feature” element.</p></li>
<li><p>To create a geojson file for the area of interest, you can use <a class="reference external" href="https://geojson.io/">https://geojson.io/</a></p></li>
<li><p>Then paste the result below in the geojson variable</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geojson</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;{&quot;type&quot;: &quot;FeatureCollection&quot;,&quot;features&quot;: [{&quot;type&quot;: &quot;Feature&quot;,&quot;properties&quot;: </span><span class="si">{}</span><span class="s2">,&quot;geometry&quot;: {&quot;type&quot;: &quot;Polygon&quot;,&quot;coordinates&quot;: [[[3.05419921875,42.601619944327965],[-1.69189453125,43.46886761482925],[-8.10791015625,43.866218006556394],[-9.60205078125,43.03677585761058],[-9.11865234375,42.24478535602799],[-9.03076171875,40.245991504199026],[-9.580078125,39.07890809706475],[-9.73388671875,38.70265930723801],[-9.25048828125,38.30718056188316],[-8.942871093749998,38.25543637637947],[-9.052734375,37.142803443716836],[-9.29443359375,36.79169061907076],[-8.10791015625,36.89719446989036],[-7.778320312499999,36.79169061907076],[-7.27294921875,37.07271048132943],[-6.78955078125,36.86204269508728],[-6.17431640625,36.06686213257888],[-5.69091796875,35.90684930677121],[-5.09765625,36.08462129606931],[-4.74609375,36.33282808737917],[-4.10888671875,36.59788913307022],[-3.09814453125,36.54494944148322],[-2.43896484375,36.56260003738545],[-2.04345703125,36.63316209558658],[-1.69189453125,37.16031654673677],[-1.34033203125,37.43997405227057],[-0.439453125,37.49229399862877],[-0.59326171875,37.75334401310656],[-0.37353515625,38.272688535980976],[0.263671875,38.59970036588819],[0.3955078125,38.839707613545144],[0.06591796875,38.94232097947902],[-0.17578125,39.2832938689385],[-0.19775390625,39.58875727696545],[0.24169921874999997,39.977120098439634],[0.68115234375,40.463666324587685],[1.07666015625,40.83043687764923],[1.58203125,41.062786068733026],[2.2412109375,41.178653972331674],[2.83447265625,41.541477666790286],[3.33984375,41.73852846935917],[3.3618164062499996,42.13082130188811],[3.05419921875,42.601619944327965]]]}}]}&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="create-folders">
<h3>Create folders<a class="headerlink" href="#create-folders" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">WORKDIR_FOLDER</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span> <span class="s2">&quot;datahub/Reliance/Climate&quot;</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">country_code</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">variable_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">month_name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WORKDIR FOLDER: &quot;</span><span class="p">,</span> <span class="n">WORKDIR_FOLDER</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">INPUT_DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">WORKDIR_FOLDER</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">)</span>
<span class="n">OUTPUT_DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">WORKDIR_FOLDER</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">)</span>
<span class="n">TOOL_DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">WORKDIR_FOLDER</span><span class="p">,</span> <span class="s1">&#39;tool&#39;</span><span class="p">)</span>

<span class="n">list_folders</span> <span class="o">=</span> <span class="p">[</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="n">TOOL_DATA_DIR</span><span class="p">]</span>

<span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">list_folders</span><span class="p">:</span>
    <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="geojson-file-for-selecting-data-from-adam">
<h3>Geojson file for selecting data from ADAM<a class="headerlink" href="#geojson-file-for-selecting-data-from-adam" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>We dissolve geojson in case we have more than one polygon and then save the results into a geojson file</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cartopy</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">local_path_geom</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="n">country_code</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;.geo.json&#39;</span><span class="p">)</span>
<span class="n">local_path_geom</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">local_path_geom</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">local_path_geom</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_path_geom</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">geojson</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">local_path_geom</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">single_shape</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dissolve</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="show-area-of-interest">
<h3>Show area of interest<a class="headerlink" href="#show-area-of-interest" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">single_shape</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">local_path_geom</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">local_path_geom</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">single_shape</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">local_path_geom</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GeoJSON&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="a-id-2-authentication-a-step-2-authentication">
<h2><a id=2_Authentication></a> <strong>Step 2: Authentication</strong><a class="headerlink" href="#a-id-2-authentication-a-step-2-authentication" title="Permalink to this headline">¶</a></h2>
<p>The following lines of code will show the personal <strong>Adam API-Key</strong> of the user and the endpoint currently in use, that provides access to the products in the related catalogue. At the end of the execution, if the authentication process is successfull the personal token and the expiration time should be returned as outputs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">adamapi</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adam_key</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s2">&quot;adam-key&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">adamapi</span> <span class="k">as</span> <span class="nn">adam</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">adam</span><span class="o">.</span><span class="n">Auth</span><span class="p">()</span>

<span class="n">a</span><span class="o">.</span><span class="n">setKey</span><span class="p">(</span><span class="n">adam_key</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">setAdamCore</span><span class="p">(</span><span class="s1">&#39;https://reliance.adamplatform.eu&#39;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">authorize</span><span class="p">()</span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="a-id-3-datasets-discovery-a-step-3-datasets-discovery">
<h2><a id=3_Datasets_Discovery></a> <strong>Step 3: Datasets Discovery</strong><a class="headerlink" href="#a-id-3-datasets-discovery-a-step-3-datasets-discovery" title="Permalink to this headline">¶</a></h2>
<p>After authorization, the user can browse the whole catalogue, structured as a JSON object after a pagination process,  displaying all the available datasets. This operation can be executed with the <font color='blue'> <strong>getDatasets()</strong> </font> function without including any argument. Some lines of code should be added to parse the Json object and extract the names of the datasets.The Json object can be handled as a Python dictionary.</p>
<div class="section" id="pre-filter-datasets">
<h3>Pre-filter datasets<a class="headerlink" href="#pre-filter-datasets" title="Permalink to this headline">¶</a></h3>
<p>We will discover all the available datasets in the ADAM platform but will only print elements of interest <strong>EU_CAMS</strong> e.g. <a class="reference external" href="https://ads.atmosphere.copernicus.eu/cdsapp#%21/dataset/cams-europe-air-quality-forecasts?tab=overview">European air quality datasets</a> from Copernicus Atmosphere Monitoring Service</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">list_datasets</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">search</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">dataset_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="n">adam</span><span class="o">.</span><span class="n">Datasets</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">catalogue</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">getDatasets</span><span class="p">()</span>
    <span class="n">datasetID</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Extracting the size of the catalogue</span>

    <span class="n">total</span> <span class="o">=</span> <span class="n">catalogue</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;totalResults&#39;</span><span class="p">]</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">catalogue</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;itemsPerPage&#39;</span><span class="p">]</span>
    <span class="n">pages</span> <span class="o">=</span> <span class="n">total</span> <span class="o">//</span> <span class="n">items</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1;34m&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------------------------------------------------------------&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;List of available datasets:&#39;</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0;0m&#39;</span><span class="p">)</span>

<span class="c1"># Extracting the list of datasets across the whole catalogue</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pages</span><span class="p">):</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">getDatasets</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">page</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">search</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">search</span> <span class="ow">in</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">element</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; --&gt; datasetId = &quot;</span> <span class="o">+</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;datasetId&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;datasetId&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">dataset_name</span><span class="p">:</span>
                    <span class="n">datasetID</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;datasetId&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">datasetID</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datasets</span><span class="p">,</span> <span class="n">datasetID</span> <span class="o">=</span> <span class="n">list_datasets</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">search</span><span class="o">=</span><span class="s2">&quot;CAMS&quot;</span><span class="p">,</span> <span class="n">dataset_name</span> <span class="o">=</span> <span class="s1">&#39;EU_CAMS_SURFACE_&#39;</span> <span class="o">+</span> <span class="n">variable_name</span> <span class="o">+</span> <span class="s1">&#39;_G&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We are interested by one variable only so we will discover the corresponding dataset and print its metadata, showing the data provenance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_metadata</span><span class="p">(</span><span class="n">datasetID</span><span class="p">,</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1;34m&#39;</span> <span class="o">+</span> <span class="s1">&#39;Metadata of &#39;</span> <span class="o">+</span> <span class="n">datasetID</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0;0m&#39;</span><span class="p">)</span>
    
    <span class="n">paged</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">getDatasets</span><span class="p">(</span><span class="n">datasetID</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">paged</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m&quot;</span> <span class="o">+</span>  <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">paged</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metadata_variable</span> <span class="o">=</span> <span class="n">get_metadata</span><span class="p">(</span><span class="n">datasetID</span><span class="p">,</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="a-id-4-products-discovery-a-step-4-products-discovery">
<h2><a id=4_Products_Discovery></a> <strong>Step 4: Products Discovery</strong><a class="headerlink" href="#a-id-4-products-discovery-a-step-4-products-discovery" title="Permalink to this headline">¶</a></h2>
<p>The products discovery operation related to a specific dataset is implemented in the Adam API with the <font color='blue'> <strong>getProducts()</strong> </font> function. A combined <strong>spatial and temporal search</strong> can be requested by specifying the <font color='red'> <strong>datasetId</strong> </font> for the selected dataset, the <font color='red'> <strong>geometry</strong> </font> argument that specifies the <u>Area Of Interest</u>, and a temporal range defined by <code class="docutils literal notranslate"><span class="pre">startDate</span></code> and <code class="docutils literal notranslate"><span class="pre">endDate</span></code> . The geometry must <strong><u>always</u></strong> be defined by a <font color='red'> <strong>GeoJson object</strong> </font> that describes the polygon in the <strong><u>counterclockwise winding order</strong></u>. The optional arguments <code class="docutils literal notranslate"><span class="pre">startIndex</span></code> and <code class="docutils literal notranslate"><span class="pre">maxRecords</span></code> can set the list of the results returned as an output. The results of the search are displayed with their metadata and they are sorted starting from the most recent product.</p>
<div class="section" id="search-data">
<h3>Search data<a class="headerlink" href="#search-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">geojson_rewind</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">geojson_rewind</span> <span class="kn">import</span> <span class="n">rewind</span>
<span class="kn">import</span> <span class="nn">json</span>
</pre></div>
</div>
</div>
</div>
<p>The GeoJson object needs to be rearranged according to the counterclockwise winding order. This operation is executed in the next few lines to obtain
a geometry that meets the requirements of the method. <strong>Geom_1</strong> is the final result to be used in the discovery operation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_path_geom</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">geom_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">rewind</span><span class="p">(</span><span class="n">geom_dict</span><span class="p">)</span>    
<span class="n">geom_1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">geom_dict</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;geometry&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Copernicus air quality analyses are hourly product but when we select a given date, we will only get the first 10 products.
Below, we make a list of the first 10 available products for the 1st day of the studied month in 2020 e.g. we restrict our search to this date.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start_date</span> <span class="o">=</span> <span class="s1">&#39;2019-&#39;</span> <span class="o">+</span> <span class="n">month_number</span> <span class="o">+</span> <span class="s1">&#39;-01&#39;</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="n">start_date</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search</span> <span class="o">=</span> <span class="n">adam</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span> <span class="n">a</span> <span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">getProducts</span><span class="p">(</span>
    <span class="n">datasetID</span><span class="p">,</span> 
    <span class="n">geometry</span><span class="o">=</span><span class="n">geom_1</span><span class="p">,</span>
    <span class="n">startDate</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
    <span class="n">endDate</span><span class="o">=</span><span class="n">end_date</span>
 <span class="p">)</span>

<span class="c1"># Printing the results</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1;34m&#39;</span> <span class="o">+</span> <span class="s1">&#39;List of available products (maximum 10 products printed):&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0;0m&#39;</span><span class="p">)</span>

<span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1;31;1m&quot;</span> <span class="o">+</span> <span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0m&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">count</span><span class="o">+</span><span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;------------------------------------&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="a-id-5-data-access-a-step-5-data-access">
<h2><a id=5_Data_Access></a> <strong>Step 5: Data Access</strong><a class="headerlink" href="#a-id-5-data-access-a-step-5-data-access" title="Permalink to this headline">¶</a></h2>
<p>After the data discovery operation that retrieves the availability of products in the catalogue, it is possible to access the data with the <font color='blue'> <strong>getData</strong> </font> function. Each product in the output list intersects the selected geometry and the following example shows how to access a specific product from the list of results obtained in the previous step. While the <font color='red'> <strong>datasetId</strong> </font> is always a mandatory parameter, for each data access request the <font color='blue'> <strong>getData</strong> </font> function needs only one of the following arguments: <font color='red'> <strong>geometry</strong> </font> or <font color='red'> <strong>productId</strong> </font>, that is the value of the <font color='blue'> <strong>_id</strong> </font> field in each product metadata. In the case of a <u><strong>spatial and temporal search</strong></u> the geometry must be provided to the function, together with the time range of interest.
The output of the <font color='blue'> <strong>getData</strong> </font> function is <u>always</u> a <font color='red'> <strong>.zip</strong> </font> file containing the data retrieved with the data access request, providing the spatial <strong>subset</strong> of the product. The zip file will contain a geotiff file for each of the spatial subsets extracted in the selected time range.</p>
<div class="section" id="define-a-function-to-select-a-time-range-and-get-data">
<h3>Define a function to select a time range and get data<a class="headerlink" href="#define-a-function-to-select-a-time-range-and-get-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getZipData</span><span class="p">(</span><span class="n">auth</span><span class="p">,</span> <span class="n">dataset_info</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">dataset_info</span><span class="p">[</span><span class="s1">&#39;outputFname&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">or</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">dataset_info</span><span class="p">[</span><span class="s1">&#39;outputFname&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
        <span class="n">data</span><span class="o">=</span><span class="n">adam</span><span class="o">.</span><span class="n">GetData</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">getData</span><span class="p">(</span>
        <span class="n">datasetId</span> <span class="o">=</span> <span class="n">dataset_info</span><span class="p">[</span><span class="s1">&#39;datasetID&#39;</span><span class="p">],</span>
        <span class="n">startDate</span> <span class="o">=</span> <span class="n">dataset_info</span><span class="p">[</span><span class="s1">&#39;startDate&#39;</span><span class="p">],</span>
        <span class="n">endDate</span> <span class="o">=</span> <span class="n">dataset_info</span><span class="p">[</span><span class="s1">&#39;endDate&#39;</span><span class="p">],</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="n">dataset_info</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">],</span>
        <span class="n">outputFname</span> <span class="o">=</span> <span class="n">dataset_info</span><span class="p">[</span><span class="s1">&#39;outputFname&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="get-variable-of-interest-for-each-day-of-the-month-we-study-for-2019-2020-and-2021-time-00-00-00">
<h3>Get variable of interest for each day of the month we study for 2019, 2020 and 2021 (time 00:00:00)<a class="headerlink" href="#get-variable-of-interest-for-each-day-of-the-month-we-study-for-2019-2020-and-2021-time-00-00-00" title="Permalink to this headline">¶</a></h3>
<p>This process can take a bit of time so be patient!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;2019&#39;</span><span class="p">,</span> <span class="s1">&#39;2020&#39;</span><span class="p">,</span> <span class="s1">&#39;2021&#39;</span><span class="p">]:</span>
    <span class="n">datasetInfo</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;datasetID&#39;</span> <span class="p">:</span> <span class="n">datasetID</span><span class="p">,</span>
    <span class="s1">&#39;startDate&#39;</span> <span class="p">:</span> <span class="n">year</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">month_number</span> <span class="o">+</span> <span class="s1">&#39;-01&#39;</span><span class="p">,</span>
    <span class="s1">&#39;endDate&#39;</span> <span class="p">:</span> <span class="n">year</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">month_number</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">month_nb_days</span><span class="p">,</span>
    <span class="s1">&#39;geometry&#39;</span> <span class="p">:</span> <span class="n">geom_1</span><span class="p">,</span>
    <span class="s1">&#39;outputFname&#39;</span> <span class="p">:</span> <span class="n">INPUT_DATA_DIR</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">variable_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">country_code</span> <span class="o">+</span> <span class="s1">&#39;_ADAMAPI_&#39;</span> <span class="o">+</span> <span class="n">year</span> <span class="o">+</span> <span class="s1">&#39;.zip&#39;</span>
    <span class="p">}</span>
    <span class="n">getZipData</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">datasetInfo</span><span class="p">)</span>
    
<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">delta1</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1m&#39;</span><span class="o">+</span><span class="s1">&#39;Processing time: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">delta1</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="a-id-6-data-analysis-visualization-a-step-6-data-analysis-and-visualization">
<h2><a id=6_Data_Analysis_Visualization></a> <strong>Step 6: Data Analysis and Visualization</strong><a class="headerlink" href="#a-id-6-data-analysis-visualization-a-step-6-data-analysis-and-visualization" title="Permalink to this headline">¶</a></h2>
<p>The data retrieved via the Adam API is now available as a zip file that must be unzipped to directly handle the data in a geotiff format. Then with the Python packages provided in the Jupyter environment it is possible to process and visualized the requested product.</p>
<div class="section" id="unzip-data">
<h3>Unzip data<a class="headerlink" href="#unzip-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">zipfile</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">unzipData</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">out_prefix</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
        <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_prefix</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;2019&#39;</span><span class="p">,</span> <span class="s1">&#39;2020&#39;</span><span class="p">,</span> <span class="s1">&#39;2021&#39;</span><span class="p">]:</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">INPUT_DATA_DIR</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">variable_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">country_code</span> <span class="o">+</span> <span class="s1">&#39;_ADAMAPI_&#39;</span> <span class="o">+</span> <span class="n">year</span> <span class="o">+</span> <span class="s1">&#39;.zip&#39;</span>
    <span class="n">target_file</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">)))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">target_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">unzipData</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">INPUT_DATA_DIR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="read-data-and-make-a-monthly-average">
<h3>Read data and make a monthly average<a class="headerlink" href="#read-data-and-make-a-monthly-average" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">xesmf</span> <span class="k">as</span> <span class="nn">xe</span>
<span class="kn">import</span> <span class="nn">glob</span>
</pre></div>
</div>
</div>
</div>
<p>We need to regrid data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">parse_coordinates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Convert our xarray.DataArray into a xarray.Dataset</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">(</span><span class="s1">&#39;band&#39;</span><span class="p">)</span><span class="o">*</span><span class="n">factor</span>
    <span class="c1"># Rename the dimensions to make it CF-convention compliant</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">rename_dims</span><span class="p">({</span><span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="s1">&#39;longitude&#39;</span><span class="p">})</span>
    <span class="c1"># Rename the variable to a more useful name</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">rename_vars</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span> <span class="n">variable</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="s1">&#39;longitude&#39;</span><span class="p">})</span>
    <span class="n">tmp</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;units&#39;</span> <span class="p">:</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">],</span> <span class="s1">&#39;long_name&#39;</span> <span class="p">:</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]}</span>
    <span class="k">return</span> <span class="n">tmp</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">output_grid</span> <span class="o">=</span> <span class="n">read_file</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">variable_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">country_code</span> <span class="o">+</span> <span class="s1">&#39;_ADAMAPI_2021/eu_cams_surface_&#39;</span> <span class="o">+</span> <span class="n">variable_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;_g_2021-&#39;</span> <span class="o">+</span> <span class="n">month_number</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">month_nb_days</span> <span class="o">+</span> <span class="s1">&#39;t000000.tif&#39;</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">,</span> <span class="n">metadata_variable</span><span class="p">)</span>
<span class="n">output_grid</span>
</pre></div>
</div>
</div>
</div>
<p>We now read these files using <code class="docutils literal notranslate"><span class="pre">xarray</span></code>. First, we make a list of all the geotiff files in a given folder. To ensure each raster is labelled correctly with its time, we can use a helper function <code class="docutils literal notranslate"><span class="pre">paths_to_datetimeindex()</span></code> to extract time information from the file paths we obtained above. We then load and concatenate each dataset along the time dimension using <code class="docutils literal notranslate"><span class="pre">xarray.open_rasterio()</span></code>, convert the resulting <code class="docutils literal notranslate"><span class="pre">xarray.DataArray</span></code> to a <code class="docutils literal notranslate"><span class="pre">xarray.Dataset</span></code>, and give the variable a more useful name (<strong>PM10</strong>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">paths_to_datetimeindex</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span>
    <span class="k">return</span>  <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">t</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="n">dirtif</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">grid_out</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">geotiff_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">dirtif</span><span class="p">)</span>
    <span class="c1"># Create variable used for time axis</span>
    <span class="n">time_var</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">paths_to_datetimeindex</span><span class="p">(</span><span class="n">geotiff_list</span><span class="p">))</span>
    <span class="c1"># Load in and concatenate all individual GeoTIFFs</span>
    <span class="n">xarray_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">grid_out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nlats</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid_out</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">nlons</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid_out</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">geotiff_list</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">read_file</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">factor</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">grid_out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;regridding &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">regridder</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">Regridder</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">grid_out</span><span class="p">,</span> <span class="s1">&#39;conservative&#39;</span><span class="p">)</span>
            <span class="n">tmp_regrid</span> <span class="o">=</span> <span class="n">regridder</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">xarray_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_regrid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xarray_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
    <span class="c1">#print(xarray_list[0:2])</span>
    <span class="n">geotiffs_da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">xarray_list</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">time_var</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">geotiffs_da</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geotiff_ds</span> <span class="o">=</span> <span class="n">getData</span><span class="p">(</span> <span class="n">INPUT_DATA_DIR</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">variable_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span> <span class="n">country_code</span> <span class="o">+</span> <span class="s1">&#39;_ADAMAPI_20*/*.tif&#39;</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">,</span> <span class="n">metadata_variable</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">1.e9</span><span class="p">,</span> <span class="n">grid_out</span><span class="o">=</span><span class="n">output_grid</span><span class="p">)</span>
<span class="n">geotiff_ds</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;units&#39;</span> <span class="p">:</span> <span class="n">variable_unit</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span> <span class="p">:</span> <span class="n">variable_long_name</span> <span class="p">}</span>
<span class="n">geotiff_ds</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="analyze-data">
<h3>Analyze data<a class="headerlink" href="#analyze-data" title="Permalink to this headline">¶</a></h3>
<p>Make yearly average for the month we study</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geotiff_dm</span> <span class="o">=</span> <span class="n">geotiff_ds</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geotiff_dm</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="visualize-data">
<h3>Visualize data<a class="headerlink" href="#visualize-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">cmaps</span> <span class="s2">&quot;holoviews&lt;1.14.8&quot;</span> <span class="n">GeoViews</span> <span class="n">cartopy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">cmaps</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To plot over Norway, taking a central longitude of 60 is fine. You may want to change it when plotting over different geographical areas</span>
<span class="n">central_longitude</span> <span class="o">=</span> <span class="n">town_coordinates</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># generate figure</span>
<span class="n">proj_plot</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mercator</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">)</span>

<span class="n">lcmap</span> <span class="o">=</span> <span class="n">cmaps</span><span class="o">.</span><span class="n">BlueYellowRed</span>
<span class="c1"># Only plot values greater than 0</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">geotiff_dm</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">geotiff_dm</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span>
                                                                 <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                                                                 <span class="n">subplot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="n">proj_plot</span><span class="p">},</span>
                                                                 <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                                                                 <span class="n">col</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                 <span class="n">cmap</span><span class="o">=</span><span class="n">lcmap</span><span class="p">,</span> <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># We have to set the map&#39;s options on all four axes</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span>  <span class="n">geotiff_dm</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Surface &#39;</span> <span class="o">+</span> <span class="n">variable_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plot_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="n">variable_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">country_code</span> <span class="o">+</span> <span class="s1">&#39;_2019-2021.png&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">plot_file</span> <span class="o">+</span> <span class="s1">&#39;.bak&#39;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">plot_file</span> <span class="o">+</span> <span class="s1">&#39;.bak&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">plot_file</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">plot_file</span><span class="p">,</span> <span class="n">plot_file</span> <span class="o">+</span> <span class="s1">&#39;.bak&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-one-single-date">
<h3>Plot one single date<a class="headerlink" href="#plot-one-single-date" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="c1"># Define the projection</span>
<span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>

<span class="c1"># We&#39;re using cartopy and are plotting in Orthographic projection </span>
<span class="c1"># (see documentation on cartopy)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Mercator</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;10m&#39;</span><span class="p">)</span>

<span class="c1"># custom colormap</span>

<span class="n">lcmap</span> <span class="o">=</span> <span class="n">cmaps</span><span class="o">.</span><span class="n">BlueYellowRed</span>

<span class="c1"># We need to project our data to the new Mercator projection and for this we use `transform`.</span>
<span class="c1"># we set the original data projection in transform (here PlateCarree)</span>
<span class="c1"># we only plot values greather than 0</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">geotiff_ds</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">geotiff_ds</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;2021-&#39;</span> <span class="o">+</span> <span class="n">month_number</span> <span class="o">+</span> <span class="s1">&#39;-15&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                                                                                                 <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                                                                                                 <span class="n">cmap</span><span class="o">=</span><span class="n">lcmap</span><span class="p">)</span>  

<span class="c1"># Title for plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Surface &#39;</span> <span class="o">+</span> <span class="n">variable_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> 15th &#39;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span> <span class="s1">&#39; 2021 over &#39;</span> <span class="o">+</span> <span class="n">country_fullname</span><span class="p">,</span>
          <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plot_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="n">variable_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span><span class="s1">&#39; _&#39;</span> <span class="o">+</span> <span class="n">country_code</span> <span class="o">+</span> <span class="s1">&#39;_2021-&#39;</span> <span class="o">+</span> <span class="n">month_number</span> <span class="o">+</span> <span class="s1">&#39;-15.png&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">plot_file</span> <span class="o">+</span> <span class="s1">&#39;.bak&#39;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">plot_file</span> <span class="o">+</span> <span class="s1">&#39;.bak&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">plot_file</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">plot_file</span><span class="p">,</span> <span class="n">plot_file</span> <span class="o">+</span> <span class="s1">&#39;.bak&#39;</span><span class="p">)</span>  
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geotiff_ds</span> <span class="o">=</span> <span class="n">geotiff_ds</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="save-data-cube-selection-into-netcdf">
<h3>Save Data Cube selection into netCDF<a class="headerlink" href="#save-data-cube-selection-into-netcdf" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="n">variable_name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">country_code</span> <span class="o">+</span> <span class="s2">&quot;_2019-2021.nc&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_file</span> <span class="o">+</span> <span class="s1">&#39;.bak&#39;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">output_file</span> <span class="o">+</span> <span class="s1">&#39;.bak&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_file</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">output_file</span> <span class="o">+</span> <span class="s1">&#39;.bak&#39;</span><span class="p">)</span> 
<span class="n">geotiff_ds</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="a-id-7-rohub-a-step-7-create-research-object-and-share-my-work">
<h2><a id=7_rohub></a> <strong>Step 7: Create Research Object and Share my work</strong><a class="headerlink" href="#a-id-7-rohub-a-step-7-create-research-object-and-share-my-work" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="create-research-object-in-rohub">
<h2>Create Research Object in ROHUB<a class="headerlink" href="#create-research-object-in-rohub" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">rohub</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">from</span> <span class="nn">rohub</span> <span class="kn">import</span> <span class="n">rohub</span><span class="p">,</span> <span class="n">settings</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="authenticating">
<h3>Authenticating<a class="headerlink" href="#authenticating" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>If the code cell below fails,  make sure you have created the two files:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">rohub-user</span></code>: contains your rohub username</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rohub-pwd</span></code>: contains your rohub password</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rohub_user</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s2">&quot;rohub-user&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
<span class="n">rohub_pwd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s2">&quot;rohub-pwd&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rohub</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">rohub_user</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">rohub_pwd</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="create-a-new-exectuable-ro">
<h2>Create a new Exectuable RO<a class="headerlink" href="#create-a-new-exectuable-ro" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ro_title</span> <span class="o">=</span>  <span class="n">variable_name</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span> <span class="s1">&#39; 2019, 2020, 2021) in &#39;</span> <span class="o">+</span> <span class="n">country_fullname</span> <span class="o">+</span> <span class="s2">&quot; Jupyter notebook demonstrating the usage of CAMS European air quality analysis from Copernicus Atmosphere Monitoring with RELIANCE services&quot;</span>
<span class="n">ro_research_areas</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Earth sciences&quot;</span><span class="p">]</span>
<span class="n">ro_description</span> <span class="o">=</span> <span class="s2">&quot;This Research Object demonstrates how to use CAMS European air quality analysis from Copernicus Atmosphere Monitoring with RELIANCE services and compute monthly map of &quot;</span> <span class="o">+</span> \
                 <span class="n">variable_name</span> <span class="o">+</span> <span class="s2">&quot; over a given geographical area, here &quot;</span> <span class="o">+</span> <span class="n">country_fullname</span>
<span class="n">ro</span> <span class="o">=</span> <span class="n">rohub</span><span class="o">.</span><span class="n">ros_create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">ro_title</span><span class="p">,</span> <span class="n">research_areas</span><span class="o">=</span><span class="n">ro_research_areas</span><span class="p">,</span> 
                      <span class="n">description</span><span class="o">=</span><span class="n">ro_description</span><span class="p">,</span> 
                      <span class="n">use_template</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">ros_type</span><span class="o">=</span><span class="s2">&quot;Executable Research Object&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="show-metadata">
<h2>Show metadata<a class="headerlink" href="#show-metadata" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ro</span><span class="o">.</span><span class="n">show_metadata</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-additional-authors-and-or-contributors-to-our-research-object">
<h2>Add additional authors and/or contributors to our Research Object<a class="headerlink" href="#add-additional-authors-and-or-contributors-to-our-research-object" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ro</span><span class="o">.</span><span class="n">set_authors</span><span class="p">(</span><span class="n">agents</span><span class="o">=</span><span class="n">author_emails</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ro</span><span class="o">.</span><span class="n">set_contributors</span><span class="p">(</span><span class="n">agents</span><span class="o">=</span><span class="n">contributor_emails</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-publisher-copyright-holder">
<h2>Add publisher/copyright holder<a class="headerlink" href="#add-publisher-copyright-holder" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Use <a class="reference external" href="https://ror.org/">Research Organization Registry (ROR)</a> to find the identifier of your organization</p></li>
</ul>
<div class="section" id="add-publishers">
<h3>Add publishers<a class="headerlink" href="#add-publishers" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ro</span><span class="o">.</span><span class="n">set_publishers</span><span class="p">(</span><span class="n">agents</span><span class="o">=</span><span class="n">list_publishers</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ro</span><span class="o">.</span><span class="n">set_copyright_holders</span><span class="p">(</span><span class="n">agents</span><span class="o">=</span><span class="n">list_copyright_holders</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">organizations</span> <span class="o">=</span> <span class="n">rohub</span><span class="o">.</span><span class="n">organizations_find</span><span class="p">()</span>
<span class="n">organizations</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="add-ro-funding-information">
<h2>Add RO Funding information<a class="headerlink" href="#add-ro-funding-information" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">funded_by</span><span class="p">:</span>
    <span class="n">ro</span><span class="o">.</span><span class="n">add_funding</span><span class="p">(</span><span class="n">grant_identifier</span><span class="o">=</span><span class="n">funded_by</span><span class="p">[</span><span class="s2">&quot;grant_id&quot;</span><span class="p">],</span> <span class="n">grant_name</span><span class="o">=</span><span class="n">funded_by</span><span class="p">[</span><span class="s2">&quot;grant_Name&quot;</span><span class="p">],</span>
                   <span class="n">funder_name</span><span class="o">=</span><span class="n">funded_by</span><span class="p">[</span><span class="s2">&quot;funder_name&quot;</span><span class="p">],</span> <span class="n">grant_title</span><span class="o">=</span><span class="n">funded_by</span><span class="p">[</span><span class="s2">&quot;grant_title&quot;</span><span class="p">],</span>
                   <span class="n">funder_doi</span><span class="o">=</span><span class="n">funded_by</span><span class="p">[</span><span class="s2">&quot;funder_doi&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-ro-license">
<h2>Add RO license<a class="headerlink" href="#add-ro-license" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ro</span><span class="o">.</span><span class="n">set_license</span><span class="p">(</span><span class="n">license_id</span><span class="o">=</span><span class="n">license</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="aggregate-resources">
<h2>Aggregate Resources<a class="headerlink" href="#aggregate-resources" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>We will be adding all the resources generated by our notebook (data and plots)</p></li>
<li><p>Our data and plots can also be shared in B2DROP so we will get the shared link from B2DROP and add it to our research object</p></li>
</ul>
<div class="section" id="list-ro-folders-for-this-type-of-ro">
<h3>List RO folders for this type of RO<a class="headerlink" href="#list-ro-folders-for-this-type-of-ro" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myfolders</span> <span class="o">=</span> <span class="n">ro</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()</span>
<span class="n">myfolders</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="aggregate-internal-resources">
<h2>Aggregate internal resources<a class="headerlink" href="#aggregate-internal-resources" title="Permalink to this headline">¶</a></h2>
<div class="section" id="add-sketch-to-my-ro">
<h3>Add sketch to my RO<a class="headerlink" href="#add-sketch-to-my-ro" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="n">variable_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">country_code</span> <span class="o">+</span> <span class="s1">&#39;_2019-2021.png&#39;</span><span class="p">)</span>
<span class="n">res_res_type</span> <span class="o">=</span> <span class="s2">&quot;Sketch&quot;</span>
<span class="n">res_title</span> <span class="o">=</span> <span class="n">variable_long_name</span> <span class="o">+</span> <span class="s2">&quot; [&quot;</span> <span class="o">+</span> <span class="n">variable_unit</span> <span class="o">+</span> <span class="s2">&quot;] over &quot;</span> <span class="o">+</span> <span class="n">country_fullname</span> <span class="o">+</span> <span class="s2">&quot; for &quot;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span> <span class="s2">&quot;  2019, 2020 and 2021&quot;</span>
<span class="n">res_description</span> <span class="o">=</span> <span class="s2">&quot;Monthly average maps of CAMS &quot;</span> <span class="o">+</span> <span class="n">variable_long_name</span> <span class="o">+</span> <span class="s2">&quot; [&quot;</span> <span class="o">+</span> <span class="n">variable_unit</span> <span class="o">+</span> <span class="s2">&quot;] over &quot;</span> <span class="o">+</span> <span class="n">country_fullname</span> <span class="o">+</span> <span class="s2">&quot; in 2019, 2020 and 2021&quot;</span>
<span class="n">res_folder</span> <span class="o">=</span>  <span class="s1">&#39;output&#39;</span>

<span class="n">ro</span><span class="o">.</span><span class="n">add_internal_resource</span><span class="p">(</span><span class="n">res_type</span><span class="o">=</span><span class="n">res_res_type</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">res_file_path</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">res_title</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">res_description</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">res_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-conda-environment-to-my-ro">
<h3>Add conda environment to my RO<a class="headerlink" href="#add-conda-environment-to-my-ro" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">copy_conda_env</span><span class="p">(</span><span class="n">local_conda_path</span><span class="p">,</span> <span class="n">shared_conda_path</span><span class="p">):</span>
    <span class="n">bkfile</span> <span class="o">=</span> <span class="n">shared_conda_path</span> <span class="o">+</span> <span class="s1">&#39;.bak&#39;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">bkfile</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">bkfile</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">shared_conda_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">shared_conda_path</span><span class="p">,</span> <span class="n">bkfile</span><span class="p">)</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">local_conda_path</span><span class="p">,</span> <span class="n">shared_conda_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">shutil</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">os_name</span><span class="p">,</span> <span class="n">conda_filename</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;linux-64&#39;</span><span class="p">,</span> <span class="s1">&#39;osx-64&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;cams-conda.yml&#39;</span><span class="p">,</span> <span class="s1">&#39;conda-lock-linux-64.yml&#39;</span><span class="p">,</span> <span class="s1">&#39;conda-lock-osx-64.yml&#39;</span><span class="p">]):</span>
    <span class="n">local_conda_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">conda_filename</span><span class="p">)</span>
    <span class="n">shared_conda_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TOOL_DATA_DIR</span><span class="p">,</span> <span class="n">conda_filename</span><span class="p">)</span>
    <span class="n">copy_conda_env</span><span class="p">(</span><span class="n">local_conda_path</span><span class="p">,</span> <span class="n">shared_conda_path</span><span class="p">)</span>
    
    <span class="n">res_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="n">shared_conda_path</span><span class="p">)</span>
    <span class="n">res_res_type</span> <span class="o">=</span> <span class="s2">&quot;Script&quot;</span>
    <span class="n">res_title</span> <span class="o">=</span> <span class="s1">&#39;Conda environment &#39;</span> <span class="o">+</span> <span class="n">os_name</span>
    <span class="k">if</span> <span class="n">os_name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">res_description</span> <span class="o">=</span> <span class="s2">&quot;Conda environment used on EGI notebook on &quot;</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">res_description</span> <span class="o">=</span> <span class="s2">&quot;Conda environment generated with conda-lock for &quot;</span> <span class="o">+</span> <span class="n">os_name</span>
    <span class="n">res_folder</span> <span class="o">=</span>  <span class="s1">&#39;input&#39;</span>

    <span class="n">ro</span><span class="o">.</span><span class="n">add_internal_resource</span><span class="p">(</span><span class="n">res_type</span><span class="o">=</span><span class="n">res_res_type</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">res_file_path</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">res_title</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">res_description</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">res_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="aggregate-external-resources">
<h2>Aggregate external resources<a class="headerlink" href="#aggregate-external-resources" title="Permalink to this headline">¶</a></h2>
<div class="section" id="get-shared-link-from-datahub">
<h3>Get shared link from datahub<a class="headerlink" href="#get-shared-link-from-datahub" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>Retrieve your client identifier, client secret and refresh token from <a class="reference external" href="https://aai.egi.eu/fedcloud/">https://aai.egi.eu/fedcloud/</a></p></li>
<li><p>Create a new file in your HOME area for instance using nano (keep the <code class="docutils literal notranslate"><span class="pre">$</span></code> character in front of HOME; this is meant to be an environment variable):</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>nano $HOME/egi_fedcloud.cfg
</pre></div>
</div>
<ol class="simple">
<li><p>Paste your client identifier, client secret and refresh token using the following syntax (do not forget <code class="docutils literal notranslate"><span class="pre">{</span></code> and <code class="docutils literal notranslate"><span class="pre">}</span></code> as well as comma <code class="docutils literal notranslate"><span class="pre">,</span></code> and columns <code class="docutils literal notranslate"><span class="pre">:</span></code></p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;XXXXXXXXXXXXXXXXX&quot;</span><span class="p">,</span>
<span class="s2">&quot;secret&quot;</span><span class="p">:</span> <span class="s2">&quot;YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY&quot;</span><span class="p">,</span>
<span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="s2">&quot;ffffffffffffffffffffffff&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="simple">
<li><p>You are ready to go. If you have issues, check first that the syntax is correct in your egi_fedcloud.cfg, that this file is located in the correct folder and then finally that your refresh token is still valid (check on <a class="reference external" href="https://aai.egi.eu/fedcloud/">https://aai.egi.eu/fedcloud/</a>)</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="egi-datahub-functions-to-initialize-egi-datahub-and-get-shared-link">
<h4>EGI Datahub functions to initialize EGI datahub and get shared link<a class="headerlink" href="#egi-datahub-functions-to-initialize-egi-datahub-and-get-shared-link" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">egi_datahub_init</span><span class="p">():</span>
    <span class="n">egi_fedcloud_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span> <span class="s1">&#39;egi_fedcloud.cfg&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">egi_fedcloud_filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">convert_file</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">convert_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">egi_fedcloud_auth</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Retrieving an OIDC token from Check-in</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="n">egi_fedcloud_auth</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                <span class="s1">&#39;client_secret&#39;</span><span class="p">:</span> <span class="n">egi_fedcloud_auth</span><span class="p">[</span><span class="s1">&#39;secret&#39;</span><span class="p">],</span>
                <span class="s1">&#39;refresh_token&#39;</span><span class="p">:</span> <span class="n">egi_fedcloud_auth</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">],</span>
                <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="s1">&#39;openid email profile&#39;</span><span class="p">,</span>
                <span class="s1">&#39;grant_type&#39;</span><span class="p">:</span> <span class="s1">&#39;refresh_token&#39;</span>
            <span class="p">}</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;https://aai.egi.eu/oidc/token&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">egi_fedcloud_auth</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> 
                                                                                       <span class="n">egi_fedcloud_auth</span><span class="p">[</span><span class="s1">&#39;secret&#39;</span><span class="p">]))</span>
            <span class="c1">#print(json.dumps(response.json(), indent=2))</span>
            <span class="n">EGItoken</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;access_token&#39;</span><span class="p">]</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;X-Auth-Token&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;egi:&quot;</span> <span class="o">+</span> <span class="n">EGItoken</span><span class="p">,</span>
                <span class="s1">&#39;Content-type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="c1"># get current timestamp</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span> 
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;REST and CDMI access token &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">),</span> 
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="p">{</span> 
                    <span class="s1">&#39;accessToken&#39;</span><span class="p">:</span> <span class="p">{}</span> 
                <span class="p">},</span> 
                <span class="s1">&#39;caveats&#39;</span><span class="p">:</span> <span class="p">[</span> <span class="p">{</span> 
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;interface&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;interface&#39;</span><span class="p">:</span> <span class="s1">&#39;rest&#39;</span> 
                <span class="p">}]</span> 
            <span class="p">})</span>

            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;https://datahub.egi.eu/api/v3/onezone/user/tokens/named&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="n">DATAHUB_TOKEN</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;token&#39;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">DATAHUB_TOKEN</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;EGI Datahub Authentication problem: check your credentials&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">egi_datahub_getlink</span><span class="p">(</span><span class="n">datahub_token</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="n">bname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">datahub_remote_prefix</span> <span class="o">=</span> <span class="s1">&#39;https://cesnet-oneprovider-01.datahub.egi.eu/api/v3/oneprovider/files/&#39;</span>
    <span class="n">hname</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;datahub/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">datahub_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">datahub_remote_prefix</span><span class="p">,</span> <span class="n">hname</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">datahub_location</span><span class="p">)</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;X-Auth-Token&#39;</span><span class="p">:</span> <span class="n">datahub_token</span> <span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">datahub_location</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">dh_fileid</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
    
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;X-Auth-Token&#39;</span><span class="p">:</span> <span class="n">datahub_token</span><span class="p">,</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">bname</span><span class="p">,</span>
    <span class="s1">&#39;fileId&#39;</span><span class="p">:</span> <span class="n">dh_fileid</span>
    <span class="p">})</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;https://cesnet-oneprovider-01.datahub.egi.eu/api/v3/oneprovider/shares&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="c1"># print(json.dumps(response.json(), indent=2))</span>
    <span class="n">shareIdGenerated</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;shareId&#39;</span><span class="p">]</span>
    
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X-Auth-Token&#39;</span><span class="p">:</span> <span class="n">datahub_token</span><span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://cesnet-oneprovider-01.datahub.egi.eu/api/v3/oneprovider/shares/&#39;</span><span class="o">+</span><span class="n">shareIdGenerated</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span> 
    <span class="c1"># print(json.dumps(response.json(), indent=2))</span>
    <span class="n">publicURL</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;publicUrl&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">publicURL</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="egi-datahub-initialization">
<h3>EGI DataHub initialization<a class="headerlink" href="#egi-datahub-initialization" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DATAHUB_TOKEN</span> <span class="o">=</span> <span class="n">egi_datahub_init</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="add-inputs-to-my-ro">
<h2>Add inputs to my RO<a class="headerlink" href="#add-inputs-to-my-ro" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>I used ADAM to retrieve relevant data but I will be sharing what I retrieved from the data cube so that my collaborators do not have to re-download the same input data again.</p></li>
</ul>
<div class="section" id="geojson-file-used-for-rertieving-data-from-adam-data-cube">
<h3>Geojson file used for rertieving data from ADAM data-cube<a class="headerlink" href="#geojson-file-used-for-rertieving-data-from-adam-data-cube" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shared_input_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="n">country_code</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;.geo.json&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">shared_input_path</span><span class="p">)</span>
<span class="n">res_file_url</span> <span class="o">=</span> <span class="n">egi_datahub_getlink</span><span class="p">(</span><span class="n">DATAHUB_TOKEN</span><span class="p">,</span> <span class="n">shared_input_path</span><span class="p">)</span>
<span class="n">res_type</span> <span class="o">=</span> <span class="s2">&quot;Dataset&quot;</span>
<span class="n">res_title</span> <span class="o">=</span> <span class="s2">&quot;Geojson for &quot;</span> <span class="o">+</span> <span class="n">country_fullname</span>
<span class="n">res_description</span> <span class="o">=</span> <span class="s2">&quot;Geojson file used for retrieving data from the ADAM platform over &quot;</span> <span class="o">+</span> <span class="n">country_fullname</span>
<span class="n">res_folder</span> <span class="o">=</span> <span class="s1">&#39;input&#39;</span>
<span class="n">ro</span><span class="o">.</span><span class="n">add_external_resource</span><span class="p">(</span><span class="n">res_type</span><span class="o">=</span><span class="n">res_type</span><span class="p">,</span> <span class="n">input_url</span><span class="o">=</span><span class="n">res_file_url</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">res_title</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">res_description</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">res_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="input-data-retrieved-from-adam-data-cube">
<h3>Input data retrieved from ADAM data-cube<a class="headerlink" href="#input-data-retrieved-from-adam-data-cube" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;2019&#39;</span><span class="p">,</span> <span class="s1">&#39;2020&#39;</span><span class="p">,</span> <span class="s1">&#39;2021&#39;</span><span class="p">]:</span>
    <span class="n">shared_input_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="n">variable_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">country_code</span> <span class="o">+</span> <span class="s1">&#39;_ADAMAPI_&#39;</span> <span class="o">+</span> <span class="n">year</span> <span class="o">+</span> <span class="s1">&#39;.zip&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">shared_input_path</span><span class="p">)</span>
    <span class="n">res_file_url</span> <span class="o">=</span> <span class="n">egi_datahub_getlink</span><span class="p">(</span><span class="n">DATAHUB_TOKEN</span><span class="p">,</span> <span class="n">shared_input_path</span><span class="p">)</span>
    <span class="n">res_type</span> <span class="o">=</span> <span class="s2">&quot;Data Cube Product&quot;</span>
    <span class="n">res_title</span> <span class="o">=</span> <span class="s2">&quot;Data-Cube from ADAM platform over &quot;</span> <span class="o">+</span> <span class="n">country_fullname</span> <span class="o">+</span> <span class="s2">&quot; in &quot;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">year</span>
    <span class="n">res_description</span> <span class="o">=</span> <span class="s2">&quot;This dataset is a data-Cube retrieved from the ADAM platform over &quot;</span> <span class="o">+</span> <span class="n">country_fullname</span> <span class="o">+</span> <span class="s2">&quot; in &quot;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">year</span>
    <span class="n">res_folder</span> <span class="o">=</span><span class="s1">&#39;input&#39;</span>
    <span class="n">ro</span><span class="o">.</span><span class="n">add_external_resource</span><span class="p">(</span><span class="n">res_type</span><span class="o">=</span><span class="n">res_type</span><span class="p">,</span> <span class="n">input_url</span><span class="o">=</span><span class="n">res_file_url</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">res_title</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">res_description</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">res_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-our-jupyter-notebook-to-our-ro">
<h3>Add our Jupyter Notebook to our RO<a class="headerlink" href="#add-our-jupyter-notebook-to-our-ro" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Make a copy of the current notebook to the tool folder for sharing as an external resource</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">notebook_filename</span> <span class="o">=</span> <span class="s1">&#39;RELIANCE_&#39;</span> <span class="o">+</span> <span class="n">country_fullname</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">variable_name</span> <span class="o">+</span> <span class="s1">&#39;_month.ipynb&#39;</span>
<span class="n">local_notebook_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">notebook_filename</span><span class="p">)</span>
<span class="n">shared_notebook_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TOOL_DATA_DIR</span><span class="p">,</span> <span class="n">notebook_filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shared_notebook_path</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="copy-current-notebook-to-shared-datahub">
<h4>Copy current notebook to shared datahub<a class="headerlink" href="#copy-current-notebook-to-shared-datahub" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkfile</span> <span class="o">=</span> <span class="n">shared_notebook_path</span> <span class="o">+</span> <span class="s1">&#39;.bak&#39;</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">bkfile</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">bkfile</span><span class="p">)</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">shared_notebook_path</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">shared_notebook_path</span><span class="p">,</span> <span class="n">bkfile</span><span class="p">)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">local_notebook_path</span><span class="p">,</span> <span class="n">shared_notebook_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="create-a-shared-link-for-my-jupyter-notebook">
<h3>Create a shared link for my Jupyter Notebook<a class="headerlink" href="#create-a-shared-link-for-my-jupyter-notebook" title="Permalink to this headline">¶</a></h3>
<div class="section" id="get-public-url-from-egi-datahub-to-share-link-in-ro">
<h4>Get public URL from EGI Datahub to share link in RO<a class="headerlink" href="#get-public-url-from-egi-datahub-to-share-link-in-ro" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_file_url</span> <span class="o">=</span> <span class="n">egi_datahub_getlink</span><span class="p">(</span><span class="n">DATAHUB_TOKEN</span><span class="p">,</span> <span class="n">shared_notebook_path</span><span class="p">)</span>
<span class="n">res_type</span> <span class="o">=</span> <span class="s2">&quot;Jupyter Notebook&quot;</span>
<span class="n">res_title</span> <span class="o">=</span> <span class="s2">&quot;Jupyter Notebook of CAMS European air quality analysis from Copernicus Atmosphere Monitoring with RELIANCE services - Applied over &quot;</span> <span class="o">+</span> <span class="n">country_fullname</span> <span class="o">+</span> <span class="s2">&quot; and variable &quot;</span> <span class="o">+</span> <span class="n">variable_long_name</span>
<span class="n">res_description</span> <span class="o">=</span> <span class="s2">&quot;Jupyter Notebook for discovering, accessing and processing RELIANCE data cube, and creating a Research Object with results, and finally publish it in Zenodo&quot;</span>
<span class="n">res_folder</span> <span class="o">=</span> <span class="s1">&#39;tool&#39;</span>
<span class="n">ro</span><span class="o">.</span><span class="n">add_external_resource</span><span class="p">(</span><span class="n">res_type</span><span class="o">=</span><span class="n">res_type</span><span class="p">,</span> <span class="n">input_url</span><span class="o">=</span><span class="n">res_file_url</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">res_title</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">res_description</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">res_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-link-to-jupyter-notebook-in-github">
<h4>Add link to Jupyter notebook in github<a class="headerlink" href="#add-link-to-jupyter-notebook-in-github" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_file_url</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/NordicESMhub/RELIANCE/main/content/demo-eosc-future/RELIANCE_Spain_NO2_month.ipynb&#39;</span>
<span class="n">res_type</span> <span class="o">=</span> <span class="s2">&quot;Jupyter Notebook&quot;</span>
<span class="n">res_title</span> <span class="o">=</span> <span class="s2">&quot;Jupyter Notebook (Github) of CAMS European air quality analysis from Copernicus Atmosphere Monitoring with RELIANCE services - Applied over &quot;</span> <span class="o">+</span> <span class="n">country_fullname</span> <span class="o">+</span> <span class="s2">&quot; and variable &quot;</span> <span class="o">+</span> <span class="n">variable_long_name</span>
<span class="n">res_description</span> <span class="o">=</span> <span class="s2">&quot;Jupyter Notebook (stored in Github) for discovering, accessing and processing RELIANCE data cube, and creating a Research Object with results, and finally publish it in Zenodo&quot;</span>
<span class="n">res_folder</span> <span class="o">=</span> <span class="s1">&#39;tool&#39;</span>
<span class="n">ro</span><span class="o">.</span><span class="n">add_external_resource</span><span class="p">(</span><span class="n">res_type</span><span class="o">=</span><span class="n">res_type</span><span class="p">,</span> <span class="n">input_url</span><span class="o">=</span><span class="n">res_file_url</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">res_title</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">res_description</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">res_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-link-to-online-rendered-jupyter-notebook">
<h4>Add link to online rendered Jupyter notebook<a class="headerlink" href="#add-link-to-online-rendered-jupyter-notebook" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_file_url</span> <span class="o">=</span> <span class="s1">&#39;https://nordicesmhub.github.io/RELIANCE/demo-eosc-future/RELIANCE_Spain_NO2_month.html&#39;</span>
<span class="n">res_type</span> <span class="o">=</span> <span class="s2">&quot;Result&quot;</span>
<span class="n">res_title</span> <span class="o">=</span> <span class="s2">&quot;online rendered jupyter book of CAMS European air quality analysis from Copernicus Atmosphere Monitoring with RELIANCE services - Applied over &quot;</span> <span class="o">+</span> <span class="n">country_fullname</span> <span class="o">+</span> <span class="s2">&quot; and variable &quot;</span> <span class="o">+</span> <span class="n">variable_long_name</span>
<span class="n">res_description</span> <span class="o">=</span> <span class="s2">&quot;Jupyter Notebook (stored in Github) for discovering, accessing and processing RELIANCE data cube, and creating a Research Object with results, and finally publish it in Zenodo&quot;</span>
<span class="n">res_folder</span> <span class="o">=</span> <span class="s1">&#39;tool&#39;</span>
<span class="n">ro</span><span class="o">.</span><span class="n">add_external_resource</span><span class="p">(</span><span class="n">res_type</span><span class="o">=</span><span class="n">res_type</span><span class="p">,</span> <span class="n">input_url</span><span class="o">=</span><span class="n">res_file_url</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">res_title</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">res_description</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">res_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-first-plot-as-image-to-my-research-object-external-resource-from-egi-datahub">
<h4>Add first plot as Image to my Research Object (external resource from EGI Datahub)<a class="headerlink" href="#add-first-plot-as-image-to-my-research-object-external-resource-from-egi-datahub" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shared_plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="n">variable_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">country_code</span> <span class="o">+</span> <span class="s1">&#39;_2019-2021.png&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">shared_plot_path</span><span class="p">)</span>
<span class="n">res_file_url</span> <span class="o">=</span> <span class="n">egi_datahub_getlink</span><span class="p">(</span><span class="n">DATAHUB_TOKEN</span><span class="p">,</span> <span class="n">shared_plot_path</span><span class="p">)</span>
<span class="n">res_type</span> <span class="o">=</span> <span class="s2">&quot;Image&quot;</span>
<span class="n">res_title</span> <span class="o">=</span> <span class="n">variable_long_name</span> <span class="o">+</span> <span class="s2">&quot; [&quot;</span> <span class="o">+</span> <span class="n">variable_unit</span> <span class="o">+</span> <span class="s2">&quot;] over &quot;</span> <span class="o">+</span> <span class="n">country_fullname</span> <span class="o">+</span> <span class="s2">&quot; for &quot;</span> <span class="o">+</span>  <span class="n">month_name</span> <span class="o">+</span> <span class="s2">&quot; 2019, 2020 and 2021&quot;</span>
<span class="n">res_description</span> <span class="o">=</span> <span class="s2">&quot;Monthly average maps of CAMS &quot;</span> <span class="o">+</span> <span class="n">variable_long_name</span> <span class="o">+</span> <span class="s2">&quot; [&quot;</span> <span class="o">+</span> <span class="n">variable_unit</span> <span class="o">+</span> <span class="s2">&quot;] over &quot;</span> <span class="o">+</span> <span class="n">country_fullname</span> <span class="o">+</span> <span class="s2">&quot; in 2019, 2020 and 2021&quot;</span>
<span class="n">res_folder</span> <span class="o">=</span> <span class="s1">&#39;output&#39;</span>
<span class="n">ro</span><span class="o">.</span><span class="n">add_external_resource</span><span class="p">(</span><span class="n">res_type</span><span class="o">=</span><span class="n">res_type</span><span class="p">,</span> <span class="n">input_url</span><span class="o">=</span><span class="n">res_file_url</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">res_title</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">res_description</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">res_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-second-plot-as-image-to-my-research-object-external-resource-from-egi-datahub">
<h4>Add second plot as Image to my Research Object (external resource from EGI Datahub)<a class="headerlink" href="#add-second-plot-as-image-to-my-research-object-external-resource-from-egi-datahub" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shared_plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="n">variable_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span> <span class="s1">&#39; _&#39;</span> <span class="o">+</span> <span class="n">country_code</span> <span class="o">+</span> <span class="s1">&#39;_2021-&#39;</span> <span class="o">+</span> <span class="n">month_number</span> <span class="o">+</span> <span class="s1">&#39;-15.png&#39;</span><span class="p">)</span>
<span class="n">res_file_url</span> <span class="o">=</span> <span class="n">egi_datahub_getlink</span><span class="p">(</span><span class="n">DATAHUB_TOKEN</span><span class="p">,</span> <span class="n">shared_plot_path</span><span class="p">)</span>
<span class="n">res_type</span> <span class="o">=</span> <span class="s2">&quot;Image&quot;</span>
<span class="n">res_title</span> <span class="o">=</span> <span class="n">variable_long_name</span> <span class="o">+</span> <span class="s2">&quot; [&quot;</span> <span class="o">+</span> <span class="n">variable_unit</span> <span class="o">+</span> <span class="s2">&quot;] over &quot;</span> <span class="o">+</span> <span class="n">country_fullname</span> <span class="o">+</span> <span class="s2">&quot; on &quot;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span>  <span class="s2">&quot; 15, 2021&quot;</span>
<span class="n">res_description</span><span class="o">=</span><span class="s2">&quot;Daily average maps of CAMS &quot;</span> <span class="o">+</span> <span class="n">variable_long_name</span> <span class="o">+</span> <span class="n">variable_unit</span> <span class="o">+</span> <span class="s2">&quot;] over &quot;</span> <span class="o">+</span> <span class="n">country_fullname</span> <span class="o">+</span> <span class="s2">&quot; on &quot;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span> <span class="s2">&quot; 15, 2021&quot;</span>
<span class="n">res_folder</span> <span class="o">=</span> <span class="s1">&#39;output&#39;</span>
<span class="n">ro</span><span class="o">.</span><span class="n">add_external_resource</span><span class="p">(</span><span class="n">res_type</span><span class="o">=</span><span class="n">res_type</span><span class="p">,</span> <span class="n">input_url</span><span class="o">=</span><span class="n">res_file_url</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">res_title</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">res_description</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">res_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-netcdf-file-corresponding-to-data-cube-selection-external-resource-from-egi-datahub">
<h4>Add netCDF file corresponding to Data cube selection (external resource from EGI Datahub)<a class="headerlink" href="#add-netcdf-file-corresponding-to-data-cube-selection-external-resource-from-egi-datahub" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shared_plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="n">variable_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">country_code</span> <span class="o">+</span> <span class="s1">&#39;_2019-2021.nc&#39;</span><span class="p">)</span>
<span class="n">res_file_url</span> <span class="o">=</span> <span class="n">egi_datahub_getlink</span><span class="p">(</span><span class="n">DATAHUB_TOKEN</span><span class="p">,</span> <span class="n">shared_plot_path</span><span class="p">)</span>
<span class="n">res_type</span><span class="o">=</span><span class="s2">&quot;Result&quot;</span>
<span class="n">res_title</span><span class="o">=</span><span class="s2">&quot;netCDF data for daily &quot;</span> <span class="o">+</span> <span class="n">variable_name</span> <span class="o">+</span> <span class="s2">&quot;over &quot;</span> <span class="o">+</span> <span class="n">country_fullname</span> <span class="o">+</span> <span class="s2">&quot; in &quot;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span> <span class="s2">&quot; 2019, 2020 and 2021&quot;</span>
<span class="n">res_description</span><span class="o">=</span><span class="s2">&quot;netCDF data corresponding to daily average of CAMS &quot;</span> <span class="o">+</span> <span class="n">variable_long_name</span> <span class="o">+</span> <span class="s2">&quot; [&quot;</span> <span class="o">+</span> <span class="n">variable_unit</span> <span class="o">+</span> <span class="s2">&quot;] over &quot;</span> <span class="o">+</span> <span class="n">country_fullname</span> <span class="o">+</span> <span class="s2">&quot; for &quot;</span> <span class="o">+</span>  <span class="n">month_name</span> <span class="o">+</span> <span class="s2">&quot; 2019, &quot;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span> <span class="s2">&quot; 2020 and &quot;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span> <span class="s2">&quot; 2021&quot;</span>
<span class="n">res_folder</span> <span class="o">=</span> <span class="s1">&#39;output&#39;</span>
<span class="n">ro</span><span class="o">.</span><span class="n">add_external_resource</span><span class="p">(</span><span class="n">res_type</span><span class="o">=</span><span class="n">res_type</span><span class="p">,</span> <span class="n">input_url</span><span class="o">=</span><span class="n">res_file_url</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">res_title</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">res_description</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">res_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="additional-metadata-for-the-ro">
<h2>Additional metadata for the RO<a class="headerlink" href="#additional-metadata-for-the-ro" title="Permalink to this headline">¶</a></h2>
<div class="section" id="add-geolocation-to-my-research-object">
<h3>Add geolocation to my Research Object<a class="headerlink" href="#add-geolocation-to-my-research-object" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>We need to transform our geojson file into geojson-ld</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">geojson_rewind</span> <span class="kn">import</span> <span class="n">rewind</span>
<span class="kn">import</span> <span class="nn">json</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geojson_ld_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="n">country_code</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;.geo-ld.json&#39;</span><span class="p">)</span>
<span class="n">bkfile</span> <span class="o">=</span> <span class="n">geojson_ld_file</span> <span class="o">+</span> <span class="s1">&#39;.bak&#39;</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">bkfile</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">bkfile</span><span class="p">)</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">geojson_ld_file</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">geojson_ld_file</span><span class="p">,</span> <span class="n">bkfile</span><span class="p">)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="n">country_code</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;.geo.json&#39;</span><span class="p">),</span> <span class="n">geojson_ld_file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">geojson_ld_file</span> <span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">rewind</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">output</span><span class="p">[</span><span class="s1">&#39;@context&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;geojson&quot;</span><span class="p">:</span> <span class="s2">&quot;https://purl.org/geojson/vocab#&quot;</span> <span class="p">}</span> 
    <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>        
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">truncate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geolocation_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="n">country_code</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;.geo.json&#39;</span><span class="p">)</span>
<span class="n">ro</span><span class="o">.</span><span class="n">add_geolocation</span><span class="p">(</span><span class="n">body_specification_json</span><span class="o">=</span><span class="n">geolocation_file_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-tags">
<h3>Add tags<a class="headerlink" href="#add-tags" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ro</span><span class="o">.</span><span class="n">add_keywords</span><span class="p">(</span><span class="n">keywords</span><span class="o">=</span><span class="p">[</span><span class="n">country_fullname</span><span class="p">,</span> <span class="s2">&quot;CAMS&quot;</span><span class="p">,</span> <span class="s2">&quot;air quality&quot;</span><span class="p">,</span> <span class="s2">&quot;copernicus&quot;</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">,</span> <span class="s2">&quot;jupyter-notebook&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="export-to-ro-crate">
<h3>Export to RO-crate<a class="headerlink" href="#export-to-ro-crate" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ro</span><span class="o">.</span><span class="n">export_to_rocrate</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;climate_EU-CAMS_&quot;</span> <span class="o">+</span> <span class="n">country_code</span> <span class="o">+</span>  <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">variable_name</span> <span class="o">+</span> <span class="s2">&quot;_ro-crate&quot;</span><span class="p">,</span> <span class="n">use_format</span><span class="o">=</span><span class="s2">&quot;zip&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="take-a-snapshot-of-my-ro">
<h3>Take a snapshot of my RO<a class="headerlink" href="#take-a-snapshot-of-my-ro" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#snapshot_id=ro.snapshot()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="archive-and-publish-to-zenodo-optionally-assign-doi">
<h3>Archive and publish to Zenodo, optionally assign DOI<a class="headerlink" href="#archive-and-publish-to-zenodo-optionally-assign-doi" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">snapshot_title</span><span class="o">=</span><span class="s2">&quot;Jupyter Notebook Analysing the Air quality during Covid-19 pandemic using Copernicus Atmosphere Monitoring Service - Applied over &quot;</span>  <span class="o">+</span> <span class="n">country_fullname</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">month_name</span> <span class="o">+</span> <span class="s2">&quot; 2019, 2020, 2021) with &quot;</span> <span class="o">+</span> <span class="n">variable_long_name</span>
<span class="c1">#snapshot_id_pub=ro.snapshot(title=snapshot_title, create_doi=True, publication_services=[&quot;Zenodo&quot;])</span>
<span class="c1">#snapshot_id_pub</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="load-the-published-research-object">
<h3>Load the published Research Object<a class="headerlink" href="#load-the-published-research-object" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#published_ro = rohub.ros_load(identifier=snapshot_id)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="show-the-doi-and-get-the-link">
<h3>Show the DOI and get the link<a class="headerlink" href="#show-the-doi-and-get-the-link" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#published_ro.show_publication()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="fork-and-reuse-existing-ro-to-create-derivative-work">
<h3>Fork and reuse existing RO to create derivative work<a class="headerlink" href="#fork-and-reuse-existing-ro-to-create-derivative-work" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#fork_id=ro.fork(title=&quot;Forked Jupyter Notebook to analyze  the Air quality during Covid-19 pandemic using Copernicus Atmosphere Monitoring Service&quot;)</span>
<span class="c1">#forked_ro = rohub.ros_load(identifier=fork_id)</span>
<span class="c1">#forked_ro.show_metadata()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ro</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./demo-eosc-future"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="RELIANCE_Norway_PM10.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">PM10 over Norway with CAMS European air quality analysis using RELIANCE services</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../science/intro.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Notebooks from researchers</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Anne Fouilloux<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>