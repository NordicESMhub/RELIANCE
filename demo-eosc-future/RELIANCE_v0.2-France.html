
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Using CAMS European air quality analysis from Copernicus Atmosphere Monitoring with RELIANCE services &#8212; Showcase Jupyter notebooks series</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Notebooks from researchers" href="../science/intro.html" />
    <link rel="prev" title="Using CAMS European air quality analysis from Copernicus Atmosphere Monitoring with RELIANCE services" href="RELIANCE-Datacube-featuring-EOSC_v0.2.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/reliance-icon.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Showcase Jupyter notebooks series</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../welcome.html">
   Welcome to RELIANCE showcase series
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  About
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../CONDUCT.html">
   Code of Conduct
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../LICENSE.html">
   LICENSE
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  ADAM service jupyter notebooks
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../adam/setup.html">
   ADAM service
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../adam/notebooks/MOD_AquaCHL_ADAM.html">
     Using ADAM-API to access MODIS Aqua CHL
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../adam/notebooks/UERRA_ADAM.html">
     Using ADAM-API to access UERRA regional reanalysis
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  ROHUB service jupyter notebooks
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../rohub/setup.html">
   ROHUB service
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../rohub/notebooks/ROHub-library-prod-demo.html">
     Example to use Rohub from Jupyter notebook
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Scientific showcase series
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../science/eosc-future.html">
   EOSC-Future demo
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="README.html">
     Demo for EOSC-Future
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="RELIANCE-Datacube-featuring-EOSC_v0.2.html">
     Using CAMS European air quality analysis from Copernicus Atmosphere Monitoring with RELIANCE services
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Using CAMS European air quality analysis from Copernicus Atmosphere Monitoring with RELIANCE services
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../science/intro.html">
   Notebooks from researchers
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../science/notebooks/CMIP6_hr_1985-2014.html">
     Example with high-resolution CMIP6 models (~100 km) using Pangeo catalog
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../science/notebooks/ERA5_1985-2014.html">
     Example ERA5
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../science/notebooks/air_quality_lockdown.html">
     Impact of the Covid-19 Lockdown on Air quality over Europe
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../science/notebooks/comparisons_with_air_quality_measurements.html">
     Jupyter notebook comparing CAMS and air quality measurements
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/demo-eosc-future/RELIANCE_v0.2-France.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/NordicESMHub/RELIANCE"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/NordicESMHub/RELIANCE/issues/new?title=Issue%20on%20page%20%2Fdemo-eosc-future/RELIANCE_v0.2-France.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/NordicESMHub/RELIANCE/main?urlpath=tree/content/demo-eosc-future/RELIANCE_v0.2-France.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analysis-over-france">
   Analysis over France
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-1-data-management-a-step-1-data-management">
   <a id="1.Data_Management">
   </a>
   <strong>
    Step 1: Data Management
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#import-python-packages">
     Import Python packages
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-folders">
     Create folders
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-2-authentication-a-step-2-authentication">
   <a id="2.Authentication">
   </a>
   <strong>
    Step 2: Authentication
   </strong>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-3-datasets-discovery-a-step-3-datasets-discovery">
   <a id="3.Datasets_Discovery">
   </a>
   <strong>
    Step 3: Datasets Discovery
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pre-filter-datasets">
     Pre-filter datasets
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-4-products-discovery-a-step-4-products-discovery">
   <a id="4.Products_Discovery">
   </a>
   <strong>
    Step 4: Products Discovery
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generate-geometry-for-france">
     Generate geometry for France
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#search-data">
     Search data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-5-data-access-a-step-5-data-access">
   <a id="5.Data_Access">
   </a>
   <strong>
    Step 5: Data Access
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-a-function-to-select-a-time-range-and-get-data">
     Define a function to select a time range and get data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-pm10-for-each-day-of-september-2019-2020-and-2021-time-00-00-00">
     Get PM10 for each day of September 2019, 2020 and 2021 (time 00:00:00)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-6-data-analysis-visualization-a-step-6-data-analysis-and-visualization">
   <a id="6.Data_Analysis_Visualization">
   </a>
   <strong>
    Step 6: Data Analysis and Visualization
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unzip-data">
     Unzip data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-data-and-make-a-monthly-average">
     Read data and make a monthly average
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#analyze-data">
     Analyze data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualize-data">
     Visualize data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-one-single-date">
     Plot one single date
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interactive-plot-with-bokeh">
     Interactive plot with bokeh
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#save-data-cube-selection-into-netcdf">
     Save Data Cube selection into netCDF
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-a-timeseries">
     Plot a timeseries
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#save-timeseries-into-tabular-csv-file">
     Save timeseries into tabular (csv) file
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-7-rohub-a-step-7-create-research-object-and-share-my-work">
   <a id="7.rohub">
   </a>
   <strong>
    Step 7: Create Research Object and Share my work
   </strong>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-research-object-in-rohub">
   Create Research Object in ROHUB
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#authenticating">
     Authenticating
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-a-new-exectuable-ro">
   Create a new Exectuable RO
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#show-metadata">
   Show metadata
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-additional-authors-and-or-contributors-to-our-research-object">
   Add additional authors and/or contributors to our Research Object
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-publisher-copyright-holder">
   Add publisher/copyright holder
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-the-university-of-olso-and-the-nordic-e-infrastructure-collaboration-as-publishers">
     Add the University of Olso and the Nordic e-Infrastructure Collaboration as publishers
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-ro-funding-information">
   Add RO Funding information
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-ro-license">
   Add RO license
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aggregate-resources">
   Aggregate Resources
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#list-ro-folders-for-this-type-of-ro">
     List RO folders for this type of RO
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aggregate-internal-resources">
   Aggregate internal resources
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-sketch-to-my-ro">
     Add sketch to my RO
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aggregate-external-resources">
   Aggregate external resources
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-shared-link-from-datahub">
     Get shared link from datahub
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#egi-datahub-functions-to-initialize-egi-datahub-and-get-shared-link">
       EGI Datahub functions to initialize EGI datahub and get shared link
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#egi-datahub-initialization">
     EGI DataHub initialization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-inputs-to-my-ro">
   Add inputs to my RO
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#geojson-file-used-for-rertieving-data-from-adam-data-cube">
     Geojson file used for rertieving data from ADAM data-cube
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#input-data-retrieved-from-adam-data-cube">
     Input data retrieved from ADAM data-cube
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-our-jupyter-notebook-to-our-ro">
     Add our Jupyter Notebook to our RO
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#copy-current-notebook-to-shared-datahub">
       Copy current notebook to shared datahub
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-a-shared-link-for-my-jupyter-notebook">
     Create a shared link for my Jupyter Notebook
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#get-public-url-from-egi-datahub-to-share-link-in-ro">
       Get public URL from EGI Datahub to share link in RO
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-first-plot-as-image-to-my-research-object-external-resource-from-egi-datahub">
       Add first plot as Image to my Research Object (external resource from EGI Datahub)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-second-plot-as-image-to-my-research-object-external-resource-from-egi-datahub">
       Add second plot as Image to my Research Object (external resource from EGI Datahub)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-timeseries-for-paris-external-resource-from-egi-datahub">
       Add timeseries for Paris (external resource from EGI Datahub)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-netcdf-file-corresponding-to-data-cube-selection-external-resource-from-egi-datahub">
       Add netCDF file corresponding to Data cube selection (external resource from EGI Datahub)
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-metadata-for-the-ro">
   Additional metadata for the RO
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-geolocation-to-my-research-object">
     Add geolocation to my Research Object
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#export-to-ro-crate">
     Export to RO-crate
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#take-a-snapshot-of-my-ro">
     Take a snapshot of my RO
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#archive-and-publish-to-zenodo-optionally-assign-doi">
     Archive and publish to Zenodo, optionally assign DOI
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-the-published-research-object">
     Load the published Research Object
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#show-the-doi-and-get-the-link">
     Show the DOI and get the link
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fork-and-reuse-existing-ro-to-create-derivative-work">
     Fork and reuse existing RO to create derivative work
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Using CAMS European air quality analysis from Copernicus Atmosphere Monitoring with RELIANCE services</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analysis-over-france">
   Analysis over France
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-1-data-management-a-step-1-data-management">
   <a id="1.Data_Management">
   </a>
   <strong>
    Step 1: Data Management
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#import-python-packages">
     Import Python packages
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-folders">
     Create folders
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-2-authentication-a-step-2-authentication">
   <a id="2.Authentication">
   </a>
   <strong>
    Step 2: Authentication
   </strong>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-3-datasets-discovery-a-step-3-datasets-discovery">
   <a id="3.Datasets_Discovery">
   </a>
   <strong>
    Step 3: Datasets Discovery
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pre-filter-datasets">
     Pre-filter datasets
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-4-products-discovery-a-step-4-products-discovery">
   <a id="4.Products_Discovery">
   </a>
   <strong>
    Step 4: Products Discovery
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generate-geometry-for-france">
     Generate geometry for France
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#search-data">
     Search data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-5-data-access-a-step-5-data-access">
   <a id="5.Data_Access">
   </a>
   <strong>
    Step 5: Data Access
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-a-function-to-select-a-time-range-and-get-data">
     Define a function to select a time range and get data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-pm10-for-each-day-of-september-2019-2020-and-2021-time-00-00-00">
     Get PM10 for each day of September 2019, 2020 and 2021 (time 00:00:00)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-6-data-analysis-visualization-a-step-6-data-analysis-and-visualization">
   <a id="6.Data_Analysis_Visualization">
   </a>
   <strong>
    Step 6: Data Analysis and Visualization
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unzip-data">
     Unzip data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-data-and-make-a-monthly-average">
     Read data and make a monthly average
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#analyze-data">
     Analyze data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualize-data">
     Visualize data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-one-single-date">
     Plot one single date
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interactive-plot-with-bokeh">
     Interactive plot with bokeh
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#save-data-cube-selection-into-netcdf">
     Save Data Cube selection into netCDF
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-a-timeseries">
     Plot a timeseries
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#save-timeseries-into-tabular-csv-file">
     Save timeseries into tabular (csv) file
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-id-7-rohub-a-step-7-create-research-object-and-share-my-work">
   <a id="7.rohub">
   </a>
   <strong>
    Step 7: Create Research Object and Share my work
   </strong>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-research-object-in-rohub">
   Create Research Object in ROHUB
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#authenticating">
     Authenticating
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-a-new-exectuable-ro">
   Create a new Exectuable RO
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#show-metadata">
   Show metadata
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-additional-authors-and-or-contributors-to-our-research-object">
   Add additional authors and/or contributors to our Research Object
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-publisher-copyright-holder">
   Add publisher/copyright holder
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-the-university-of-olso-and-the-nordic-e-infrastructure-collaboration-as-publishers">
     Add the University of Olso and the Nordic e-Infrastructure Collaboration as publishers
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-ro-funding-information">
   Add RO Funding information
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-ro-license">
   Add RO license
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aggregate-resources">
   Aggregate Resources
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#list-ro-folders-for-this-type-of-ro">
     List RO folders for this type of RO
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aggregate-internal-resources">
   Aggregate internal resources
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-sketch-to-my-ro">
     Add sketch to my RO
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aggregate-external-resources">
   Aggregate external resources
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-shared-link-from-datahub">
     Get shared link from datahub
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#egi-datahub-functions-to-initialize-egi-datahub-and-get-shared-link">
       EGI Datahub functions to initialize EGI datahub and get shared link
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#egi-datahub-initialization">
     EGI DataHub initialization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-inputs-to-my-ro">
   Add inputs to my RO
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#geojson-file-used-for-rertieving-data-from-adam-data-cube">
     Geojson file used for rertieving data from ADAM data-cube
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#input-data-retrieved-from-adam-data-cube">
     Input data retrieved from ADAM data-cube
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-our-jupyter-notebook-to-our-ro">
     Add our Jupyter Notebook to our RO
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#copy-current-notebook-to-shared-datahub">
       Copy current notebook to shared datahub
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-a-shared-link-for-my-jupyter-notebook">
     Create a shared link for my Jupyter Notebook
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#get-public-url-from-egi-datahub-to-share-link-in-ro">
       Get public URL from EGI Datahub to share link in RO
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-first-plot-as-image-to-my-research-object-external-resource-from-egi-datahub">
       Add first plot as Image to my Research Object (external resource from EGI Datahub)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-second-plot-as-image-to-my-research-object-external-resource-from-egi-datahub">
       Add second plot as Image to my Research Object (external resource from EGI Datahub)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-timeseries-for-paris-external-resource-from-egi-datahub">
       Add timeseries for Paris (external resource from EGI Datahub)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-netcdf-file-corresponding-to-data-cube-selection-external-resource-from-egi-datahub">
       Add netCDF file corresponding to Data cube selection (external resource from EGI Datahub)
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-metadata-for-the-ro">
   Additional metadata for the RO
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-geolocation-to-my-research-object">
     Add geolocation to my Research Object
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#export-to-ro-crate">
     Export to RO-crate
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#take-a-snapshot-of-my-ro">
     Take a snapshot of my RO
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#archive-and-publish-to-zenodo-optionally-assign-doi">
     Archive and publish to Zenodo, optionally assign DOI
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-the-published-research-object">
     Load the published Research Object
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#show-the-doi-and-get-the-link">
     Show the DOI and get the link
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fork-and-reuse-existing-ro-to-create-derivative-work">
     Fork and reuse existing RO to create derivative work
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <p><img src='https://www.reliance-project.eu/wp-content/uploads/2021/03/Asset-8mdpi.svg' alt='Layout' align='left' width='25%'></img>
<img src='https://media-exp1.licdn.com/dms/image/C560BAQFFDze0s3l-pQ/company-logo_200_200/0?e=2159024400&v=beta&t=jG_sh9NpwE6yc2TspIcL2YUR2X7OBzTrRSu6w7sNYtc' alt='Layout' align='right' width='10%'></img></p>
<div class="tex2jax_ignore mathjax_ignore section" id="using-cams-european-air-quality-analysis-from-copernicus-atmosphere-monitoring-with-reliance-services">
<h1>Using CAMS European air quality analysis from Copernicus Atmosphere Monitoring with RELIANCE services<a class="headerlink" href="#using-cams-european-air-quality-analysis-from-copernicus-atmosphere-monitoring-with-reliance-services" title="Permalink to this headline">¶</a></h1>
<div class="section" id="analysis-over-france">
<h2>Analysis over France<a class="headerlink" href="#analysis-over-france" title="Permalink to this headline">¶</a></h2>
<div class="alert alert-success alert-info">
<b>How to discover RELIANCE datacube resources (spatial and temporal search and subsetting)</b></div><p>This notebook shows how to discover and access the <a class="reference external" href="https://ads.atmosphere.copernicus.eu/#%21/home">Copernicus Atmosphere Monitoring</a> products available in the <strong>RELIANCE</strong> datacube resources, by using the functionalities provided in the <font color='blue'> <strong>Adam API</strong> </font>. The process is structured in 6 steps, including example of data analysis and visualization with the Python libraries installed in the Jupyter environment.</p>
<ul class="simple">
<li><p><a class="reference external" href="#1.Data_Management">1. Data Management</a></p></li>
<li><p><a class="reference external" href="#2.Authentication">2. Authentication</a></p></li>
<li><p><a class="reference external" href="#3.Datasets_Discovery">3. Datasets Discovery</a></p></li>
<li><p><a class="reference external" href="#4.Products_Discovery">4. Products Discovery</a></p></li>
<li><p><a class="reference external" href="#5.Data_Access">5. Data Access</a></p></li>
<li><p><a class="reference external" href="#6.Data_Analysis_Visualization">6. Data Analysis and Visualizarion</a></p></li>
<li><p><a class="reference external" href="#7.rohub">7. Create Research Object and Share my work</a></p></li>
</ul>
</div>
<div class="section" id="a-id-1-data-management-a-step-1-data-management">
<h2><a id=1.Data_Management></a> <strong>Step 1: Data Management</strong><a class="headerlink" href="#a-id-1-data-management-a-step-1-data-management" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Organize my data:</p>
<ul>
<li><p>Define a prefix for my project (you may need to adjust it for your own usage on your infrastructure).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">input</span></code> folder where all the data used as input to my Jupyter Notebook is stored (and eventually shared)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output</span></code> folder where all the results to keep are stored</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tool</span></code> folder where all the tools, including this Jupyter Notebook will be copied for sharing</p></li>
</ul>
</li>
<li><p>Create all corresponding folders</p></li>
</ul>
<div class="section" id="import-python-packages">
<h3>Import Python packages<a class="headerlink" href="#import-python-packages" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="create-folders">
<h3>Create folders<a class="headerlink" href="#create-folders" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">WORKDIR_FOLDER</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span> <span class="s2">&quot;datahub/Reliance/Climate&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WORKDIR FOLDER: &quot;</span><span class="p">,</span> <span class="n">WORKDIR_FOLDER</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WORKDIR FOLDER:  /home/jovyan/datahub/Reliance/Climate
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">INPUT_DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">WORKDIR_FOLDER</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">)</span>
<span class="n">OUTPUT_DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">WORKDIR_FOLDER</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">)</span>
<span class="n">TOOL_DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">WORKDIR_FOLDER</span><span class="p">,</span> <span class="s1">&#39;tool&#39;</span><span class="p">)</span>

<span class="n">list_folders</span> <span class="o">=</span> <span class="p">[</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="n">TOOL_DATA_DIR</span><span class="p">]</span>

<span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">list_folders</span><span class="p">:</span>
    <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="a-id-2-authentication-a-step-2-authentication">
<h2><a id=2.Authentication></a> <strong>Step 2: Authentication</strong><a class="headerlink" href="#a-id-2-authentication-a-step-2-authentication" title="Permalink to this headline">¶</a></h2>
<p>The following lines of code will show the personal <strong>Adam API-Key</strong> of the user and the endpoint currently in use, that provide access to the products in the related catalogue. At the end of the execution, if the authentication process is successfull the personal token and the expiration time should be returned as outputs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">adamapi</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting adamapi
  Using cached adamapi-2.0.11-py3-none-any.whl (14 kB)
Requirement already satisfied: requests&gt;=2.22.0 in /opt/conda/lib/python3.8/site-packages (from adamapi) (2.25.1)
Requirement already satisfied: imageio in /opt/conda/lib/python3.8/site-packages (from adamapi) (2.9.0)
Requirement already satisfied: idna&lt;3,&gt;=2.5 in /opt/conda/lib/python3.8/site-packages (from requests&gt;=2.22.0-&gt;adamapi) (2.10)
Requirement already satisfied: urllib3&lt;1.27,&gt;=1.21.1 in /opt/conda/lib/python3.8/site-packages (from requests&gt;=2.22.0-&gt;adamapi) (1.26.4)
Requirement already satisfied: chardet&lt;5,&gt;=3.0.2 in /opt/conda/lib/python3.8/site-packages (from requests&gt;=2.22.0-&gt;adamapi) (4.0.0)
Requirement already satisfied: certifi&gt;=2017.4.17 in /opt/conda/lib/python3.8/site-packages (from requests&gt;=2.22.0-&gt;adamapi) (2021.10.8)
Requirement already satisfied: pillow in /opt/conda/lib/python3.8/site-packages (from imageio-&gt;adamapi) (8.1.2)
Requirement already satisfied: numpy in /opt/conda/lib/python3.8/site-packages (from imageio-&gt;adamapi) (1.19.5)
Installing collected packages: adamapi
Successfully installed adamapi-2.0.11
Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adam_key</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s2">&quot;adam-key&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">adamapi</span> <span class="k">as</span> <span class="nn">adam</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">adam</span><span class="o">.</span><span class="n">Auth</span><span class="p">()</span>

<span class="n">a</span><span class="o">.</span><span class="n">setKey</span><span class="p">(</span><span class="n">adam_key</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">setAdamCore</span><span class="p">(</span><span class="s1">&#39;https://reliance.adamplatform.eu&#39;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">authorize</span><span class="p">()</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;expires_at&#39;: &#39;2022-01-17T16:45:56.329Z&#39;,
 &#39;access_token&#39;: &#39;48c59a806afa41ef811f5dafe8277cb1&#39;,
 &#39;refresh_token&#39;: &#39;c366297d635d490e8279df67e7c35215&#39;,
 &#39;expires_in&#39;: 3600}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="a-id-3-datasets-discovery-a-step-3-datasets-discovery">
<h2><a id=3.Datasets_Discovery></a> <strong>Step 3: Datasets Discovery</strong><a class="headerlink" href="#a-id-3-datasets-discovery-a-step-3-datasets-discovery" title="Permalink to this headline">¶</a></h2>
<p>After the authorization, the user can browse the whole catalogue, structured as a JSON object after a pagination process,  displaying all the available datasets. This operation can be executed with the <font color='blue'> <strong>getDatasets()</strong> </font> function without including any argument. Some lines of code should be added to parse the Json object and extract the names of the datasets.The Json object can be handled as a Python dictionary.</p>
<div class="section" id="pre-filter-datasets">
<h3>Pre-filter datasets<a class="headerlink" href="#pre-filter-datasets" title="Permalink to this headline">¶</a></h3>
<p>We will discover all the available datasets in the ADAM platform but will only print elements of interest <strong>EU_CAMS</strong> e.g. <a class="reference external" href="https://ads.atmosphere.copernicus.eu/cdsapp#%21/dataset/cams-europe-air-quality-forecasts?tab=overview">European air quality datasets</a> from Copernicus Atmosphere Monitoring Service</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">list_datasets</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">search</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="n">adam</span><span class="o">.</span><span class="n">Datasets</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">catalogue</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">getDatasets</span><span class="p">()</span>

<span class="c1"># Extracting the size of the catalogue</span>

    <span class="n">total</span> <span class="o">=</span> <span class="n">catalogue</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;totalResults&#39;</span><span class="p">]</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">catalogue</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;itemsPerPage&#39;</span><span class="p">]</span>
    <span class="n">pages</span> <span class="o">=</span> <span class="n">total</span> <span class="o">//</span> <span class="n">items</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1;34m&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------------------------------------------------------------&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;List of available datasets:&#39;</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0;0m&#39;</span><span class="p">)</span>

<span class="c1"># Extracting the list of datasets across the whole catalogue</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pages</span><span class="p">):</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">getDatasets</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">page</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">search</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">search</span> <span class="ow">in</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">element</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; --&gt; datasetId = &quot;</span> <span class="o">+</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;datasetId&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">datasets</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datasets</span> <span class="o">=</span> <span class="n">list_datasets</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">search</span><span class="o">=</span><span class="s2">&quot;EU_CAMS&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold -Color-Bold-Blue">----------------------------------------------------------------------</span>
<span class=" -Color -Color-Bold -Color-Bold-Blue">List of available datasets:</span>

EU_CAMS_SURFACE_C2H3NO5_G --&gt; datasetId = 69619:EU_CAMS_SURFACE_C2H3NO5_G
EU_CAMS_SURFACE_CO_G --&gt; datasetId = 69620:EU_CAMS_SURFACE_CO_G
EU_CAMS_SURFACE_NH3_G --&gt; datasetId = 69621:EU_CAMS_SURFACE_NH3_G
EU_CAMS_SURFACE_NMVOC_G --&gt; datasetId = 69622:EU_CAMS_SURFACE_NMVOC_G
EU_CAMS_SURFACE_NO2_G --&gt; datasetId = 69623:EU_CAMS_SURFACE_NO2_G
EU_CAMS_SURFACE_NO_G --&gt; datasetId = 69624:EU_CAMS_SURFACE_NO_G
EU_CAMS_SURFACE_O3_G --&gt; datasetId = 69625:EU_CAMS_SURFACE_O3_G
EU_CAMS_SURFACE_PM10_G --&gt; datasetId = 69626:EU_CAMS_SURFACE_PM10_G
EU_CAMS_SURFACE_PM25_G --&gt; datasetId = 69627:EU_CAMS_SURFACE_PM25_G
EU_CAMS_SURFACE_REC_G --&gt; datasetId = 69628:EU_CAMS_SURFACE_REC_G
EU_CAMS_SURFACE_SIA_G --&gt; datasetId = 69629:EU_CAMS_SURFACE_SIA_G
EU_CAMS_SURFACE_SO2_G --&gt; datasetId = 69630:EU_CAMS_SURFACE_SO2_G
EU_CAMS_SURFACE_TEC_G --&gt; datasetId = 69631:EU_CAMS_SURFACE_TEC_G
</pre></div>
</div>
</div>
</div>
<p>We are interested by <strong>Particulate matter &lt; 10 µm (PM10)</strong> so we will discover <strong>EU_CAMS_SURFACE_PM10_G</strong> and print the metadata of this particular dataset, showing the data provenance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datasetID</span> <span class="o">=</span> <span class="s1">&#39;69626:EU_CAMS_SURFACE_PM10_G&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1;34m&#39;</span> <span class="o">+</span> <span class="s1">&#39;Metadata of &#39;</span> <span class="o">+</span> <span class="n">datasetID</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0;0m&#39;</span><span class="p">)</span>

<span class="n">paged</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">getDatasets</span><span class="p">(</span><span class="n">datasetID</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">paged</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Blue">Metadata of 69626:EU_CAMS_SURFACE_PM10_G:</span>

datasetId: 69626:EU_CAMS_SURFACE_PM10_G
creationDate: 2021-07-12T02:00:00Z
dataType: Float32
epsg: 4326
keywords: []
license: {&#39;documentationUrl&#39;: &#39;&#39;, &#39;dataProviderName&#39;: &#39;ADS&#39;, &#39;dataProviderUrl&#39;: &#39;&#39;, &#39;licenseId&#39;: &#39;&#39;, &#39;dataPolicy&#39;: &#39;&#39;, &#39;doi&#39;: &#39;&#39;, &#39;credits&#39;: &#39;&#39;}
maxValue: [2645.995849609375]
minValue: [0.003789698239415884]
numberOfRecords: 61598
profile: {&#39;profileSchema&#39;: &#39;eo_profile_schema.json&#39;, &#39;name&#39;: &#39;Earth Observation&#39;, &#39;mission&#39;: &#39;CAMS&#39;, &#39;sensor&#39;: &#39;CAMS&#39;, &#39;processingLevel&#39;: &#39;forecast&#39;, &#39;instrument&#39;: &#39;&#39;, &#39;platform&#39;: &#39;&#39;}
resolutionUnit: degree
temporalResolution: Hourly
unit: 
unitDescription: 
updateDate: 2022-01-17T12:01:44Z
geometry: {&#39;type&#39;: &#39;Polygon&#39;, &#39;coordinates&#39;: [[[-25.000012, 29.999997], [44.999988, 29.999997], [44.999988, 71.999997], [-25.000012, 71.999997], [-25.000012, 29.999997]]]}
resolutions: [0.1]
anyText: 4326,ESA,Daily,ESA
applications: [&#39;Atmosphere&#39;]
datasetManager: govoni@meeo.it
datasetManagerOrganisation: meeo
description: This dataset provides daily air quality analyses and forecasts for Europe.

CAMS produces specific daily air quality analyses and forecasts for the European domain at significantly higher spatial resolution (0.1 degrees, approx. 10km) than is available from the global analyses and forecasts. The production is based on an ensemble of nine air quality forecasting systems across Europe. A median ensemble is calculated from individual outputs, since ensemble products yield on average better performance than the individual model products. The spread between the nine models are used to provide an estimate of the forecast uncertainty. The analysis combines model data with observations provided by the European Environment Agency (EEA) into a complete and consistent dataset using various data assimilation techniques depending upon the air-quality forecasting system used. In parallel, air quality forecasts are produced once a day for the next four days. Both the analysis and the forecast are available at hourly time steps at seven height levels.

Note that only nitrogen monoxide, nitrogen dioxide, sulphur dioxide, ozone, PM2.5, PM10 and dust are regularly validated against in situ observations, and therefore forecasts of all other variables are unvalidated and should be considered experimental.
title: EU_CAMS_SURFACE_PM10_G
noDataValue: 0
timeReferenceSystem: UTC
units: µg m-3
unitsDescription: PM10
services: [&#39;MWCS&#39;, &#39;ADAM&#39;, &#39;AdamApi&#39;]
technicalManager: govoni@meeo.it
filtersEnabled: {&#39;type&#39;: &#39;object&#39;, &#39;title&#39;: &#39;Dataset filters&#39;, &#39;properties&#39;: {&#39;startDate&#39;: {&#39;title&#39;: &#39;Start Date&#39;, &#39;type&#39;: &#39;string&#39;, &#39;format&#39;: &#39;date&#39;, &#39;text_rule&#39;: &#39;false&#39;, &#39;ops_only&#39;: &#39;false&#39;, &#39;math_rule&#39;: &#39;false&#39;, &#39;order_rule&#39;: &#39;false&#39;, &#39;pattern&#39;: &#39;^d{4}-[01]d-[0-3]d(T[0-2]d:[0-9]d:[0-9]dZ)?$&#39;}, &#39;endDate&#39;: {&#39;title&#39;: &#39;End Date&#39;, &#39;type&#39;: &#39;string&#39;, &#39;format&#39;: &#39;date&#39;, &#39;ops_only&#39;: &#39;false&#39;, &#39;text_rule&#39;: &#39;false&#39;, &#39;math_rule&#39;: &#39;false&#39;, &#39;order_rule&#39;: &#39;false&#39;, &#39;pattern&#39;: &#39;^d{4}-[01]d-[0-3]d(T[0-2]d:[0-9]d:[0-9]dZ)?$&#39;}}}
starDate: 2018-07-12T00:00:00Z
endDate: 2022-01-16T23:00:00Z
accounting: {&#39;unit&#39;: 0.0032}
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="a-id-4-products-discovery-a-step-4-products-discovery">
<h2><a id=4.Products_Discovery></a> <strong>Step 4: Products Discovery</strong><a class="headerlink" href="#a-id-4-products-discovery-a-step-4-products-discovery" title="Permalink to this headline">¶</a></h2>
<p>The products discovery operation related to a specific dataset is implemented in the Adam API with the <font color='blue'> <strong>getProducts()</strong> </font> function. A combined <strong>spatial and temporal search</strong> can be requested by specifying the <font color='red'> <strong>datasetId</strong> </font> for the selected dataset,the <font color='red'> <strong>geometry</strong> </font> argument that specifies the <u>Area Of Interest</u> and a temporal range, defined by <code class="docutils literal notranslate"><span class="pre">startDate</span></code> and <code class="docutils literal notranslate"><span class="pre">endDate</span></code> . The geometry must <strong><u>always</u></strong> be defined by a <font color='red'> <strong>GeoJson object</strong> </font> that describes the polygon in the <strong><u>counterclockwise winding order</strong></u>. The optional arguments <code class="docutils literal notranslate"><span class="pre">startIndex</span></code> and <code class="docutils literal notranslate"><span class="pre">maxRecords</span></code> can set the list of the results returned as an output. The results of the search are displayed with their metadata and they are sorted starting from the most recent product.</p>
<div class="section" id="generate-geometry-for-france">
<h3>Generate geometry for France<a class="headerlink" href="#generate-geometry-for-france" title="Permalink to this headline">¶</a></h3>
<p>The geometry field is extracted from a GeoJSON object , retrieving the value of the “feature” element.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">wget</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting wget
  Downloading wget-3.2.zip (10 kB)
Building wheels for collected packages: wget
  Building wheel for wget (setup.py) ... ?25ldone
?25h  Created wheel for wget: filename=wget-3.2-py3-none-any.whl size=9680 sha256=28a5f6f20cc30bf0122342aa5142fa8764267b3321bf11507c368c9c1a7670ca
  Stored in directory: /home/jovyan/.cache/pip/wheels/bd/a8/c3/3cf2c14a1837a4e04bd98631724e81f33f462d86a1d895fae0
Successfully built wget
Installing collected packages: wget
Successfully installed wget-3.2
Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">wget</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/mledoze/countries/master/data/fra.geo.json&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">local_path_geom</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
<span class="n">local_path_geom</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;/home/jovyan/datahub/Reliance/Climate/input/fra.geo.json&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">local_path_geom</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
        <span class="n">wget</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">INPUT_DATA_DIR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="search-data">
<h3>Search data<a class="headerlink" href="#search-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">geojson_rewind</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting geojson_rewind
  Using cached geojson_rewind-1.0.2-py3-none-any.whl (4.9 kB)
Installing collected packages: geojson-rewind
Successfully installed geojson-rewind-1.0.2
Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">geojson_rewind</span> <span class="kn">import</span> <span class="n">rewind</span>
<span class="kn">import</span> <span class="nn">json</span>
</pre></div>
</div>
</div>
</div>
<p>The GeoJson object needs to be rearranged according to the counterclockwise winding order.This operation is executed in the next few lines to obtain
a geometry that meets the requirements of the method. <strong>Geom_1</strong> is the final result to be used in the discovery operation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_path_geom</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">geom_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">rewind</span><span class="p">(</span><span class="n">geom_dict</span><span class="p">)</span>    
<span class="n">geom_1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">geom_dict</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;geometry&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Copernicus air quality analyses are hourly product but when we select a given date, we will only get the first 10 products.
Below, we make a list of the first 10 available products for the 1st September 2020 e.g. we restrict our search to this date.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start_date</span> <span class="o">=</span> <span class="s1">&#39;2019-09-01&#39;</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="s1">&#39;2019-09-01&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search</span> <span class="o">=</span> <span class="n">adam</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span> <span class="n">a</span> <span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">getProducts</span><span class="p">(</span>
    <span class="n">datasetID</span><span class="p">,</span> 
    <span class="n">geometry</span><span class="o">=</span><span class="n">geom_1</span><span class="p">,</span>
    <span class="n">startDate</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
    <span class="n">endDate</span><span class="o">=</span><span class="n">end_date</span>
 <span class="p">)</span>

<span class="c1"># Printing the results</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1;34m&#39;</span> <span class="o">+</span> <span class="s1">&#39;List of available products (maximum 10 products printed):&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0;0m&#39;</span><span class="p">)</span>

<span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1;31;1m&quot;</span> <span class="o">+</span> <span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0m&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">count</span><span class="o">+</span><span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;------------------------------------&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold -Color-Bold-Blue">List of available products (maximum 10 products printed):</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">#1</span>

_id: {&#39;$oid&#39;: &#39;60ef2c3d6dfebc0806c75279&#39;}
datasetId: EU_CAMS_SURFACE_PM10_G
productDate: 2019-09-01T23:00:00Z
productId: EU_CAMS_SURFACE_PM10_G_20190901230000.tif
geometry: {&#39;geometries&#39;: [{&#39;type&#39;: &#39;Polygon&#39;, &#39;coordinates&#39;: [[[-25.000012, 29.999997], [44.999988, 29.999997], [44.999988, 71.999997], [-25.000012, 71.999997], [-25.000012, 29.999997]]]}], &#39;type&#39;: &#39;GeometryCollection&#39;}
insertDate: 2021-07-14T18:26:05Z
status: Online
------------------------------------
<span class=" -Color -Color-Bold -Color-Bold-Red">#2</span>

_id: {&#39;$oid&#39;: &#39;60ef2c3d6dfebc0806c75276&#39;}
datasetId: EU_CAMS_SURFACE_PM10_G
productDate: 2019-09-01T22:00:00Z
productId: EU_CAMS_SURFACE_PM10_G_20190901220000.tif
geometry: {&#39;geometries&#39;: [{&#39;type&#39;: &#39;Polygon&#39;, &#39;coordinates&#39;: [[[-25.000012, 29.999997], [44.999988, 29.999997], [44.999988, 71.999997], [-25.000012, 71.999997], [-25.000012, 29.999997]]]}], &#39;type&#39;: &#39;GeometryCollection&#39;}
insertDate: 2021-07-14T18:26:05Z
status: Online
------------------------------------
<span class=" -Color -Color-Bold -Color-Bold-Red">#3</span>

_id: {&#39;$oid&#39;: &#39;60ef2c3d6dfebc0806c7526b&#39;}
datasetId: EU_CAMS_SURFACE_PM10_G
productDate: 2019-09-01T21:00:00Z
productId: EU_CAMS_SURFACE_PM10_G_20190901210000.tif
geometry: {&#39;geometries&#39;: [{&#39;type&#39;: &#39;Polygon&#39;, &#39;coordinates&#39;: [[[-25.000012, 29.999997], [44.999988, 29.999997], [44.999988, 71.999997], [-25.000012, 71.999997], [-25.000012, 29.999997]]]}], &#39;type&#39;: &#39;GeometryCollection&#39;}
insertDate: 2021-07-14T18:26:05Z
status: Online
------------------------------------
<span class=" -Color -Color-Bold -Color-Bold-Red">#4</span>

_id: {&#39;$oid&#39;: &#39;60ef2c3d6dfebc0806c75269&#39;}
datasetId: EU_CAMS_SURFACE_PM10_G
productDate: 2019-09-01T20:00:00Z
productId: EU_CAMS_SURFACE_PM10_G_20190901200000.tif
geometry: {&#39;geometries&#39;: [{&#39;type&#39;: &#39;Polygon&#39;, &#39;coordinates&#39;: [[[-25.000012, 29.999997], [44.999988, 29.999997], [44.999988, 71.999997], [-25.000012, 71.999997], [-25.000012, 29.999997]]]}], &#39;type&#39;: &#39;GeometryCollection&#39;}
insertDate: 2021-07-14T18:26:05Z
status: Online
------------------------------------
<span class=" -Color -Color-Bold -Color-Bold-Red">#5</span>

_id: {&#39;$oid&#39;: &#39;60ef2c3d6dfebc0806c75260&#39;}
datasetId: EU_CAMS_SURFACE_PM10_G
productDate: 2019-09-01T19:00:00Z
productId: EU_CAMS_SURFACE_PM10_G_20190901190000.tif
geometry: {&#39;geometries&#39;: [{&#39;type&#39;: &#39;Polygon&#39;, &#39;coordinates&#39;: [[[-25.000012, 29.999997], [44.999988, 29.999997], [44.999988, 71.999997], [-25.000012, 71.999997], [-25.000012, 29.999997]]]}], &#39;type&#39;: &#39;GeometryCollection&#39;}
insertDate: 2021-07-14T18:26:05Z
status: Online
------------------------------------
<span class=" -Color -Color-Bold -Color-Bold-Red">#6</span>

_id: {&#39;$oid&#39;: &#39;60ef2c3d6dfebc0806c75263&#39;}
datasetId: EU_CAMS_SURFACE_PM10_G
productDate: 2019-09-01T18:00:00Z
productId: EU_CAMS_SURFACE_PM10_G_20190901180000.tif
geometry: {&#39;geometries&#39;: [{&#39;type&#39;: &#39;Polygon&#39;, &#39;coordinates&#39;: [[[-25.000012, 29.999997], [44.999988, 29.999997], [44.999988, 71.999997], [-25.000012, 71.999997], [-25.000012, 29.999997]]]}], &#39;type&#39;: &#39;GeometryCollection&#39;}
insertDate: 2021-07-14T18:26:05Z
status: Online
------------------------------------
<span class=" -Color -Color-Bold -Color-Bold-Red">#7</span>

_id: {&#39;$oid&#39;: &#39;60ef2c3d6dfebc0806c75255&#39;}
datasetId: EU_CAMS_SURFACE_PM10_G
productDate: 2019-09-01T17:00:00Z
productId: EU_CAMS_SURFACE_PM10_G_20190901170000.tif
geometry: {&#39;geometries&#39;: [{&#39;type&#39;: &#39;Polygon&#39;, &#39;coordinates&#39;: [[[-25.000012, 29.999997], [44.999988, 29.999997], [44.999988, 71.999997], [-25.000012, 71.999997], [-25.000012, 29.999997]]]}], &#39;type&#39;: &#39;GeometryCollection&#39;}
insertDate: 2021-07-14T18:26:05Z
status: Online
------------------------------------
<span class=" -Color -Color-Bold -Color-Bold-Red">#8</span>

_id: {&#39;$oid&#39;: &#39;60ef2c3d6dfebc0806c75250&#39;}
datasetId: EU_CAMS_SURFACE_PM10_G
productDate: 2019-09-01T16:00:00Z
productId: EU_CAMS_SURFACE_PM10_G_20190901160000.tif
geometry: {&#39;geometries&#39;: [{&#39;type&#39;: &#39;Polygon&#39;, &#39;coordinates&#39;: [[[-25.000012, 29.999997], [44.999988, 29.999997], [44.999988, 71.999997], [-25.000012, 71.999997], [-25.000012, 29.999997]]]}], &#39;type&#39;: &#39;GeometryCollection&#39;}
insertDate: 2021-07-14T18:26:05Z
status: Online
------------------------------------
<span class=" -Color -Color-Bold -Color-Bold-Red">#9</span>

_id: {&#39;$oid&#39;: &#39;60ef2c3d6dfebc0806c7524a&#39;}
datasetId: EU_CAMS_SURFACE_PM10_G
productDate: 2019-09-01T15:00:00Z
productId: EU_CAMS_SURFACE_PM10_G_20190901150000.tif
geometry: {&#39;geometries&#39;: [{&#39;type&#39;: &#39;Polygon&#39;, &#39;coordinates&#39;: [[[-25.000012, 29.999997], [44.999988, 29.999997], [44.999988, 71.999997], [-25.000012, 71.999997], [-25.000012, 29.999997]]]}], &#39;type&#39;: &#39;GeometryCollection&#39;}
insertDate: 2021-07-14T18:26:05Z
status: Online
------------------------------------
<span class=" -Color -Color-Bold -Color-Bold-Red">#10</span>

_id: {&#39;$oid&#39;: &#39;60ef2c3d6dfebc0806c7524c&#39;}
datasetId: EU_CAMS_SURFACE_PM10_G
productDate: 2019-09-01T14:00:00Z
productId: EU_CAMS_SURFACE_PM10_G_20190901140000.tif
geometry: {&#39;geometries&#39;: [{&#39;type&#39;: &#39;Polygon&#39;, &#39;coordinates&#39;: [[[-25.000012, 29.999997], [44.999988, 29.999997], [44.999988, 71.999997], [-25.000012, 71.999997], [-25.000012, 29.999997]]]}], &#39;type&#39;: &#39;GeometryCollection&#39;}
insertDate: 2021-07-14T18:26:05Z
status: Online
------------------------------------
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="a-id-5-data-access-a-step-5-data-access">
<h2><a id=5.Data_Access></a> <strong>Step 5: Data Access</strong><a class="headerlink" href="#a-id-5-data-access-a-step-5-data-access" title="Permalink to this headline">¶</a></h2>
<p>After the data discovery operation that retrieves the availability of products in the catalogue, it is possible to access the data with the <font color='blue'> <strong>getData</strong> </font> function. Each product in the output list intersects the selected geometry and the following example shows how to access a specific product from the list of results obtained in the previous step. While the <font color='red'> <strong>datasetId</strong> </font> is always a mandatory parameter, for each data access request the <font color='blue'> <strong>getData</strong> </font> function needs only one of the following arguments: <font color='red'> <strong>geometry</strong> </font> or <font color='red'> <strong>productId</strong> </font>, that is the value of the <font color='blue'> <strong>_id</strong> </font> field in each product metadata. In the case of a <u><strong>spatial and temporal search</strong></u> the geometry must be provided to the function, together with the time range of interest.
The output of the <font color='blue'> <strong>getData</strong> </font> function is <u>always</u> a <font color='red'> <strong>.zip</strong> </font> file containing the data retrieved with the data access request, providing the spatial <strong>subset</strong> of the product. The zip file will contain a geotiff file for each of the spatial subsets extracted in the selected time range.</p>
<div class="section" id="define-a-function-to-select-a-time-range-and-get-data">
<h3>Define a function to select a time range and get data<a class="headerlink" href="#define-a-function-to-select-a-time-range-and-get-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getZipData</span><span class="p">(</span><span class="n">auth</span><span class="p">,</span> <span class="n">dataset_info</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">dataset_info</span><span class="p">[</span><span class="s1">&#39;outputFname&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">or</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">dataset_info</span><span class="p">[</span><span class="s1">&#39;outputFname&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
        <span class="n">data</span><span class="o">=</span><span class="n">adam</span><span class="o">.</span><span class="n">GetData</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">getData</span><span class="p">(</span>
        <span class="n">datasetId</span> <span class="o">=</span> <span class="n">dataset_info</span><span class="p">[</span><span class="s1">&#39;datasetID&#39;</span><span class="p">],</span>
        <span class="n">startDate</span> <span class="o">=</span> <span class="n">dataset_info</span><span class="p">[</span><span class="s1">&#39;startDate&#39;</span><span class="p">],</span>
        <span class="n">endDate</span> <span class="o">=</span> <span class="n">dataset_info</span><span class="p">[</span><span class="s1">&#39;endDate&#39;</span><span class="p">],</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="n">dataset_info</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">],</span>
        <span class="n">outputFname</span> <span class="o">=</span> <span class="n">dataset_info</span><span class="p">[</span><span class="s1">&#39;outputFname&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="get-pm10-for-each-day-of-september-2019-2020-and-2021-time-00-00-00">
<h3>Get PM10 for each day of September 2019, 2020 and 2021 (time 00:00:00)<a class="headerlink" href="#get-pm10-for-each-day-of-september-2019-2020-and-2021-time-00-00-00" title="Permalink to this headline">¶</a></h3>
<p>This process can take a bit of time so be patient!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;2019&#39;</span><span class="p">,</span> <span class="s1">&#39;2020&#39;</span><span class="p">,</span> <span class="s1">&#39;2021&#39;</span><span class="p">]:</span>
    <span class="n">datasetInfo</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;datasetID&#39;</span> <span class="p">:</span> <span class="s1">&#39;69626:EU_CAMS_SURFACE_PM10_G&#39;</span><span class="p">,</span>
    <span class="s1">&#39;startDate&#39;</span> <span class="p">:</span> <span class="n">year</span> <span class="o">+</span> <span class="s1">&#39;-09-01&#39;</span><span class="p">,</span>
    <span class="s1">&#39;endDate&#39;</span> <span class="p">:</span> <span class="n">year</span> <span class="o">+</span> <span class="s1">&#39;-09-30&#39;</span><span class="p">,</span>
    <span class="s1">&#39;geometry&#39;</span> <span class="p">:</span> <span class="n">geom_1</span><span class="p">,</span>
    <span class="s1">&#39;outputFname&#39;</span> <span class="p">:</span> <span class="n">INPUT_DATA_DIR</span> <span class="o">+</span> <span class="s1">&#39;/PM10_FR_ADAMAPI_&#39;</span> <span class="o">+</span> <span class="n">year</span> <span class="o">+</span> <span class="s1">&#39;.zip&#39;</span>
    <span class="p">}</span>
    <span class="n">getZipData</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">datasetInfo</span><span class="p">)</span>
    
<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">delta1</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[1m&#39;</span><span class="o">+</span><span class="s1">&#39;Processing time: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">delta1</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Processing time: 0.0</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="a-id-6-data-analysis-visualization-a-step-6-data-analysis-and-visualization">
<h2><a id=6.Data_Analysis_Visualization></a> <strong>Step 6: Data Analysis and Visualization</strong><a class="headerlink" href="#a-id-6-data-analysis-visualization-a-step-6-data-analysis-and-visualization" title="Permalink to this headline">¶</a></h2>
<p>The data retrieved via the Adam API are now available as a zip file that must be unzipped to directly handle the data in a geotiff format. Then with the Python packages provided in the Jupyter environment it is possible to process and visualized the requested product.</p>
<div class="section" id="unzip-data">
<h3>Unzip data<a class="headerlink" href="#unzip-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">zipfile</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">unzipData</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">out_prefix</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
        <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_prefix</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;2019&#39;</span><span class="p">,</span> <span class="s1">&#39;2020&#39;</span><span class="p">,</span> <span class="s1">&#39;2021&#39;</span><span class="p">]:</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">INPUT_DATA_DIR</span> <span class="o">+</span> <span class="s1">&#39;/PM10_FR_ADAMAPI_&#39;</span> <span class="o">+</span> <span class="n">year</span> <span class="o">+</span> <span class="s1">&#39;.zip&#39;</span>
    <span class="n">target_file</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">)))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">target_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">unzipData</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">INPUT_DATA_DIR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="read-data-and-make-a-monthly-average">
<h3>Read data and make a monthly average<a class="headerlink" href="#read-data-and-make-a-monthly-average" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">glob</span>
</pre></div>
</div>
</div>
</div>
<p>We now read these files using <code class="docutils literal notranslate"><span class="pre">xarray</span></code>. First, we make a list of all the geotiff files in a given folder. To ensure each raster is labelled correctly with its time, we can use a helper function <code class="docutils literal notranslate"><span class="pre">paths_to_datetimeindex()</span></code> to extract time information from the file paths we obtained above. We then load and concatenate each dataset along the time dimension using <code class="docutils literal notranslate"><span class="pre">xarray.open_rasterio()</span></code>, convert the resulting <code class="docutils literal notranslate"><span class="pre">xarray.DataArray</span></code> to a <code class="docutils literal notranslate"><span class="pre">xarray.Dataset</span></code>, and give the variable a more useful name (<strong>PM10</strong>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">paths_to_datetimeindex</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span>
    <span class="k">return</span>  <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">t</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="n">dirtif</span><span class="p">):</span>
    <span class="n">geotiff_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">dirtif</span><span class="p">)</span>
    <span class="c1"># Create variable used for time axis</span>
    <span class="n">time_var</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">paths_to_datetimeindex</span><span class="p">(</span><span class="n">geotiff_list</span><span class="p">))</span>
    <span class="c1"># Load in and concatenate all individual GeoTIFFs</span>
    <span class="n">geotiffs_da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">xr</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">parse_coordinates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">geotiff_list</span><span class="p">],</span>
                        <span class="n">dim</span><span class="o">=</span><span class="n">time_var</span><span class="p">)</span>
    <span class="c1"># Covert our xarray.DataArray into a xarray.Dataset</span>
    <span class="n">geotiffs_da</span> <span class="o">=</span> <span class="n">geotiffs_da</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">(</span><span class="s1">&#39;band&#39;</span><span class="p">)</span>
    <span class="c1"># Rename the dimensions to make it CF-convention compliant</span>
    <span class="n">geotiffs_da</span> <span class="o">=</span> <span class="n">geotiffs_da</span><span class="o">.</span><span class="n">rename_dims</span><span class="p">({</span><span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="s1">&#39;longitude&#39;</span><span class="p">})</span>
    <span class="c1"># Rename the variable to a more useful name</span>
    <span class="n">geotiffs_da</span> <span class="o">=</span> <span class="n">geotiffs_da</span><span class="o">.</span><span class="n">rename_vars</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;PM10&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="s1">&#39;longitude&#39;</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">geotiffs_da</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geotiff_ds</span> <span class="o">=</span> <span class="n">getData</span><span class="p">(</span> <span class="n">INPUT_DATA_DIR</span> <span class="o">+</span> <span class="s1">&#39;/PM10_FR_ADAMAPI_20*/*.tif&#39;</span><span class="p">)</span>
<span class="n">geotiff_ds</span><span class="p">[</span><span class="s1">&#39;PM10&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;units&#39;</span> <span class="p">:</span> <span class="s1">&#39;µg m-3&#39;</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span> <span class="p">:</span> <span class="s1">&#39;Particulate matter &lt; 10 µm&#39;</span><span class="p">}</span>
<span class="n">geotiff_ds</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:    (time: 90, latitude: 98, longitude: 148)
Coordinates:
  * latitude   (latitude) float64 51.05 50.95 50.85 50.75 ... 41.55 41.45 41.35
  * longitude  (longitude) float64 -5.15 -5.05 -4.95 -4.85 ... 9.35 9.45 9.55
  * time       (time) datetime64[ns] 2021-09-30 2021-09-29 ... 2019-09-01
Data variables:
    PM10       (time, latitude, longitude) float32 0.0 0.0 0.0 ... 0.0 0.0 0.0
Attributes:
    transform:      (0.1, 0.0, -5.200012009298998, 0.0, -0.1, 51.09999699761336)
    crs:            +init=epsg:4326
    res:            (0.1, 0.1)
    is_tiled:       0
    nodatavals:     (0.0,)
    scales:         (1.0,)
    offsets:        (0.0,)
    AREA_OR_POINT:  Area</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-c597dd44-8a12-4776-8d10-5993000ee1c8' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-c597dd44-8a12-4776-8d10-5993000ee1c8' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 90</li><li><span class='xr-has-index'>latitude</span>: 98</li><li><span class='xr-has-index'>longitude</span>: 148</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-a27c2131-bdaa-48e4-8e2b-db11f6219978' class='xr-section-summary-in' type='checkbox'  checked><label for='section-a27c2131-bdaa-48e4-8e2b-db11f6219978' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>latitude</span></div><div class='xr-var-dims'>(latitude)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>51.05 50.95 50.85 ... 41.45 41.35</div><input id='attrs-a909c31f-0b78-4fe8-a33a-c41d2ddd69f3' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-a909c31f-0b78-4fe8-a33a-c41d2ddd69f3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6d90f575-5ab1-4ddb-b5aa-303ad691ce85' class='xr-var-data-in' type='checkbox'><label for='data-6d90f575-5ab1-4ddb-b5aa-303ad691ce85' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([51.049997, 50.949997, 50.849997, 50.749997, 50.649997, 50.549997,
       50.449997, 50.349997, 50.249997, 50.149997, 50.049997, 49.949997,
       49.849997, 49.749997, 49.649997, 49.549997, 49.449997, 49.349997,
       49.249997, 49.149997, 49.049997, 48.949997, 48.849997, 48.749997,
       48.649997, 48.549997, 48.449997, 48.349997, 48.249997, 48.149997,
       48.049997, 47.949997, 47.849997, 47.749997, 47.649997, 47.549997,
       47.449997, 47.349997, 47.249997, 47.149997, 47.049997, 46.949997,
       46.849997, 46.749997, 46.649997, 46.549997, 46.449997, 46.349997,
       46.249997, 46.149997, 46.049997, 45.949997, 45.849997, 45.749997,
       45.649997, 45.549997, 45.449997, 45.349997, 45.249997, 45.149997,
       45.049997, 44.949997, 44.849997, 44.749997, 44.649997, 44.549997,
       44.449997, 44.349997, 44.249997, 44.149997, 44.049997, 43.949997,
       43.849997, 43.749997, 43.649997, 43.549997, 43.449997, 43.349997,
       43.249997, 43.149997, 43.049997, 42.949997, 42.849997, 42.749997,
       42.649997, 42.549997, 42.449997, 42.349997, 42.249997, 42.149997,
       42.049997, 41.949997, 41.849997, 41.749997, 41.649997, 41.549997,
       41.449997, 41.349997])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>longitude</span></div><div class='xr-var-dims'>(longitude)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-5.15 -5.05 -4.95 ... 9.45 9.55</div><input id='attrs-9a590537-146c-4633-aab6-11a525665dae' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9a590537-146c-4633-aab6-11a525665dae' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7e9ec490-a794-4c06-8015-09cf15052194' class='xr-var-data-in' type='checkbox'><label for='data-7e9ec490-a794-4c06-8015-09cf15052194' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([-5.150012, -5.050012, -4.950012, -4.850012, -4.750012, -4.650012,
       -4.550012, -4.450012, -4.350012, -4.250012, -4.150012, -4.050012,
       -3.950012, -3.850012, -3.750012, -3.650012, -3.550012, -3.450012,
       -3.350012, -3.250012, -3.150012, -3.050012, -2.950012, -2.850012,
       -2.750012, -2.650012, -2.550012, -2.450012, -2.350012, -2.250012,
       -2.150012, -2.050012, -1.950012, -1.850012, -1.750012, -1.650012,
       -1.550012, -1.450012, -1.350012, -1.250012, -1.150012, -1.050012,
       -0.950012, -0.850012, -0.750012, -0.650012, -0.550012, -0.450012,
       -0.350012, -0.250012, -0.150012, -0.050012,  0.049988,  0.149988,
        0.249988,  0.349988,  0.449988,  0.549988,  0.649988,  0.749988,
        0.849988,  0.949988,  1.049988,  1.149988,  1.249988,  1.349988,
        1.449988,  1.549988,  1.649988,  1.749988,  1.849988,  1.949988,
        2.049988,  2.149988,  2.249988,  2.349988,  2.449988,  2.549988,
        2.649988,  2.749988,  2.849988,  2.949988,  3.049988,  3.149988,
        3.249988,  3.349988,  3.449988,  3.549988,  3.649988,  3.749988,
        3.849988,  3.949988,  4.049988,  4.149988,  4.249988,  4.349988,
        4.449988,  4.549988,  4.649988,  4.749988,  4.849988,  4.949988,
        5.049988,  5.149988,  5.249988,  5.349988,  5.449988,  5.549988,
        5.649988,  5.749988,  5.849988,  5.949988,  6.049988,  6.149988,
        6.249988,  6.349988,  6.449988,  6.549988,  6.649988,  6.749988,
        6.849988,  6.949988,  7.049988,  7.149988,  7.249988,  7.349988,
        7.449988,  7.549988,  7.649988,  7.749988,  7.849988,  7.949988,
        8.049988,  8.149988,  8.249988,  8.349988,  8.449988,  8.549988,
        8.649988,  8.749988,  8.849988,  8.949988,  9.049988,  9.149988,
        9.249988,  9.349988,  9.449988,  9.549988])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2021-09-30 ... 2019-09-01</div><input id='attrs-e870b556-63b4-487e-a877-a039509b98c7' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e870b556-63b4-487e-a877-a039509b98c7' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-73b7fbde-f43d-466b-80f7-2b299a0775bb' class='xr-var-data-in' type='checkbox'><label for='data-73b7fbde-f43d-466b-80f7-2b299a0775bb' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;2021-09-30T00:00:00.000000000&#x27;, &#x27;2021-09-29T00:00:00.000000000&#x27;,
       &#x27;2021-09-28T00:00:00.000000000&#x27;, &#x27;2021-09-27T00:00:00.000000000&#x27;,
       &#x27;2021-09-26T00:00:00.000000000&#x27;, &#x27;2021-09-25T00:00:00.000000000&#x27;,
       &#x27;2021-09-24T00:00:00.000000000&#x27;, &#x27;2021-09-23T00:00:00.000000000&#x27;,
       &#x27;2021-09-22T00:00:00.000000000&#x27;, &#x27;2021-09-21T00:00:00.000000000&#x27;,
       &#x27;2021-09-20T00:00:00.000000000&#x27;, &#x27;2021-09-19T00:00:00.000000000&#x27;,
       &#x27;2021-09-18T00:00:00.000000000&#x27;, &#x27;2021-09-17T00:00:00.000000000&#x27;,
       &#x27;2021-09-16T00:00:00.000000000&#x27;, &#x27;2021-09-15T00:00:00.000000000&#x27;,
       &#x27;2021-09-14T00:00:00.000000000&#x27;, &#x27;2021-09-13T00:00:00.000000000&#x27;,
       &#x27;2021-09-12T00:00:00.000000000&#x27;, &#x27;2021-09-11T00:00:00.000000000&#x27;,
       &#x27;2021-09-10T00:00:00.000000000&#x27;, &#x27;2021-09-09T00:00:00.000000000&#x27;,
       &#x27;2021-09-08T00:00:00.000000000&#x27;, &#x27;2021-09-07T00:00:00.000000000&#x27;,
       &#x27;2021-09-06T00:00:00.000000000&#x27;, &#x27;2021-09-05T00:00:00.000000000&#x27;,
       &#x27;2021-09-04T00:00:00.000000000&#x27;, &#x27;2021-09-03T00:00:00.000000000&#x27;,
       &#x27;2021-09-02T00:00:00.000000000&#x27;, &#x27;2021-09-01T00:00:00.000000000&#x27;,
       &#x27;2020-09-30T00:00:00.000000000&#x27;, &#x27;2020-09-29T00:00:00.000000000&#x27;,
       &#x27;2020-09-28T00:00:00.000000000&#x27;, &#x27;2020-09-27T00:00:00.000000000&#x27;,
       &#x27;2020-09-26T00:00:00.000000000&#x27;, &#x27;2020-09-25T00:00:00.000000000&#x27;,
       &#x27;2020-09-24T00:00:00.000000000&#x27;, &#x27;2020-09-23T00:00:00.000000000&#x27;,
       &#x27;2020-09-22T00:00:00.000000000&#x27;, &#x27;2020-09-21T00:00:00.000000000&#x27;,
       &#x27;2020-09-20T00:00:00.000000000&#x27;, &#x27;2020-09-19T00:00:00.000000000&#x27;,
       &#x27;2020-09-18T00:00:00.000000000&#x27;, &#x27;2020-09-17T00:00:00.000000000&#x27;,
       &#x27;2020-09-16T00:00:00.000000000&#x27;, &#x27;2020-09-15T00:00:00.000000000&#x27;,
       &#x27;2020-09-14T00:00:00.000000000&#x27;, &#x27;2020-09-13T00:00:00.000000000&#x27;,
       &#x27;2020-09-12T00:00:00.000000000&#x27;, &#x27;2020-09-11T00:00:00.000000000&#x27;,
       &#x27;2020-09-10T00:00:00.000000000&#x27;, &#x27;2020-09-09T00:00:00.000000000&#x27;,
       &#x27;2020-09-08T00:00:00.000000000&#x27;, &#x27;2020-09-07T00:00:00.000000000&#x27;,
       &#x27;2020-09-06T00:00:00.000000000&#x27;, &#x27;2020-09-05T00:00:00.000000000&#x27;,
       &#x27;2020-09-04T00:00:00.000000000&#x27;, &#x27;2020-09-03T00:00:00.000000000&#x27;,
       &#x27;2020-09-02T00:00:00.000000000&#x27;, &#x27;2020-09-01T00:00:00.000000000&#x27;,
       &#x27;2019-09-30T00:00:00.000000000&#x27;, &#x27;2019-09-29T00:00:00.000000000&#x27;,
       &#x27;2019-09-28T00:00:00.000000000&#x27;, &#x27;2019-09-27T00:00:00.000000000&#x27;,
       &#x27;2019-09-26T00:00:00.000000000&#x27;, &#x27;2019-09-25T00:00:00.000000000&#x27;,
       &#x27;2019-09-24T00:00:00.000000000&#x27;, &#x27;2019-09-23T00:00:00.000000000&#x27;,
       &#x27;2019-09-22T00:00:00.000000000&#x27;, &#x27;2019-09-21T00:00:00.000000000&#x27;,
       &#x27;2019-09-20T00:00:00.000000000&#x27;, &#x27;2019-09-19T00:00:00.000000000&#x27;,
       &#x27;2019-09-18T00:00:00.000000000&#x27;, &#x27;2019-09-17T00:00:00.000000000&#x27;,
       &#x27;2019-09-16T00:00:00.000000000&#x27;, &#x27;2019-09-15T00:00:00.000000000&#x27;,
       &#x27;2019-09-14T00:00:00.000000000&#x27;, &#x27;2019-09-13T00:00:00.000000000&#x27;,
       &#x27;2019-09-12T00:00:00.000000000&#x27;, &#x27;2019-09-11T00:00:00.000000000&#x27;,
       &#x27;2019-09-10T00:00:00.000000000&#x27;, &#x27;2019-09-09T00:00:00.000000000&#x27;,
       &#x27;2019-09-08T00:00:00.000000000&#x27;, &#x27;2019-09-07T00:00:00.000000000&#x27;,
       &#x27;2019-09-06T00:00:00.000000000&#x27;, &#x27;2019-09-05T00:00:00.000000000&#x27;,
       &#x27;2019-09-04T00:00:00.000000000&#x27;, &#x27;2019-09-03T00:00:00.000000000&#x27;,
       &#x27;2019-09-02T00:00:00.000000000&#x27;, &#x27;2019-09-01T00:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-9df55c00-d4ee-4f2c-b145-e60695028c6c' class='xr-section-summary-in' type='checkbox'  checked><label for='section-9df55c00-d4ee-4f2c-b145-e60695028c6c' class='xr-section-summary' >Data variables: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>PM10</span></div><div class='xr-var-dims'>(time, latitude, longitude)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.0 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0</div><input id='attrs-6f0b1224-22a4-4bc2-97bc-7db9474fce41' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-6f0b1224-22a4-4bc2-97bc-7db9474fce41' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6e0e6f37-4ad3-4900-81e4-7d37f2a899fa' class='xr-var-data-in' type='checkbox'><label for='data-6e0e6f37-4ad3-4900-81e4-7d37f2a899fa' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>µg m-3</dd><dt><span>long_name :</span></dt><dd>Particulate matter &lt; 10 µm</dd></dl></div><div class='xr-var-data'><pre>array([[[0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        ...,
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.]],

       [[0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        ...,
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.]],

       [[0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        ...,
...
        ...,
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.]],

       [[0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        ...,
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.]],

       [[0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        ...,
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.]]], dtype=float32)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-5a8c9445-b13f-418c-8de3-cdb256db9833' class='xr-section-summary-in' type='checkbox'  checked><label for='section-5a8c9445-b13f-418c-8de3-cdb256db9833' class='xr-section-summary' >Attributes: <span>(8)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>transform :</span></dt><dd>(0.1, 0.0, -5.200012009298998, 0.0, -0.1, 51.09999699761336)</dd><dt><span>crs :</span></dt><dd>+init=epsg:4326</dd><dt><span>res :</span></dt><dd>(0.1, 0.1)</dd><dt><span>is_tiled :</span></dt><dd>0</dd><dt><span>nodatavals :</span></dt><dd>(0.0,)</dd><dt><span>scales :</span></dt><dd>(1.0,)</dd><dt><span>offsets :</span></dt><dd>(0.0,)</dd><dt><span>AREA_OR_POINT :</span></dt><dd>Area</dd></dl></div></li></ul></div></div></div></div>
</div>
</div>
<div class="section" id="analyze-data">
<h3>Analyze data<a class="headerlink" href="#analyze-data" title="Permalink to this headline">¶</a></h3>
<p>Make yearly average for September month</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geotiff_dm</span> <span class="o">=</span> <span class="n">geotiff_ds</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geotiff_dm</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:    (year: 3, latitude: 98, longitude: 148)
Coordinates:
  * latitude   (latitude) float64 51.05 50.95 50.85 50.75 ... 41.55 41.45 41.35
  * longitude  (longitude) float64 -5.15 -5.05 -4.95 -4.85 ... 9.35 9.45 9.55
  * year       (year) int64 2019 2020 2021
Data variables:
    PM10       (year, latitude, longitude) float32 0.0 0.0 0.0 ... 0.0 0.0 0.0
Attributes:
    transform:      (0.1, 0.0, -5.200012009298998, 0.0, -0.1, 51.09999699761336)
    crs:            +init=epsg:4326
    res:            (0.1, 0.1)
    is_tiled:       0
    nodatavals:     (0.0,)
    scales:         (1.0,)
    offsets:        (0.0,)
    AREA_OR_POINT:  Area</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-f72244b9-ab43-469f-aa74-0eb0f362a422' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-f72244b9-ab43-469f-aa74-0eb0f362a422' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>year</span>: 3</li><li><span class='xr-has-index'>latitude</span>: 98</li><li><span class='xr-has-index'>longitude</span>: 148</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-608f40c8-0ff4-44b5-94c9-cb950aa7fdbd' class='xr-section-summary-in' type='checkbox'  checked><label for='section-608f40c8-0ff4-44b5-94c9-cb950aa7fdbd' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>latitude</span></div><div class='xr-var-dims'>(latitude)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>51.05 50.95 50.85 ... 41.45 41.35</div><input id='attrs-9c86c27c-f739-41aa-8a9d-13f5c7a751f6' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9c86c27c-f739-41aa-8a9d-13f5c7a751f6' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1fc3b222-2a51-411b-b2bd-3e736697b377' class='xr-var-data-in' type='checkbox'><label for='data-1fc3b222-2a51-411b-b2bd-3e736697b377' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([51.049997, 50.949997, 50.849997, 50.749997, 50.649997, 50.549997,
       50.449997, 50.349997, 50.249997, 50.149997, 50.049997, 49.949997,
       49.849997, 49.749997, 49.649997, 49.549997, 49.449997, 49.349997,
       49.249997, 49.149997, 49.049997, 48.949997, 48.849997, 48.749997,
       48.649997, 48.549997, 48.449997, 48.349997, 48.249997, 48.149997,
       48.049997, 47.949997, 47.849997, 47.749997, 47.649997, 47.549997,
       47.449997, 47.349997, 47.249997, 47.149997, 47.049997, 46.949997,
       46.849997, 46.749997, 46.649997, 46.549997, 46.449997, 46.349997,
       46.249997, 46.149997, 46.049997, 45.949997, 45.849997, 45.749997,
       45.649997, 45.549997, 45.449997, 45.349997, 45.249997, 45.149997,
       45.049997, 44.949997, 44.849997, 44.749997, 44.649997, 44.549997,
       44.449997, 44.349997, 44.249997, 44.149997, 44.049997, 43.949997,
       43.849997, 43.749997, 43.649997, 43.549997, 43.449997, 43.349997,
       43.249997, 43.149997, 43.049997, 42.949997, 42.849997, 42.749997,
       42.649997, 42.549997, 42.449997, 42.349997, 42.249997, 42.149997,
       42.049997, 41.949997, 41.849997, 41.749997, 41.649997, 41.549997,
       41.449997, 41.349997])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>longitude</span></div><div class='xr-var-dims'>(longitude)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-5.15 -5.05 -4.95 ... 9.45 9.55</div><input id='attrs-09e39b70-124a-4de9-b02c-ce9fc2a062f4' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-09e39b70-124a-4de9-b02c-ce9fc2a062f4' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9ceacb3d-b135-4b36-a458-455ec6bdb7b9' class='xr-var-data-in' type='checkbox'><label for='data-9ceacb3d-b135-4b36-a458-455ec6bdb7b9' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([-5.150012, -5.050012, -4.950012, -4.850012, -4.750012, -4.650012,
       -4.550012, -4.450012, -4.350012, -4.250012, -4.150012, -4.050012,
       -3.950012, -3.850012, -3.750012, -3.650012, -3.550012, -3.450012,
       -3.350012, -3.250012, -3.150012, -3.050012, -2.950012, -2.850012,
       -2.750012, -2.650012, -2.550012, -2.450012, -2.350012, -2.250012,
       -2.150012, -2.050012, -1.950012, -1.850012, -1.750012, -1.650012,
       -1.550012, -1.450012, -1.350012, -1.250012, -1.150012, -1.050012,
       -0.950012, -0.850012, -0.750012, -0.650012, -0.550012, -0.450012,
       -0.350012, -0.250012, -0.150012, -0.050012,  0.049988,  0.149988,
        0.249988,  0.349988,  0.449988,  0.549988,  0.649988,  0.749988,
        0.849988,  0.949988,  1.049988,  1.149988,  1.249988,  1.349988,
        1.449988,  1.549988,  1.649988,  1.749988,  1.849988,  1.949988,
        2.049988,  2.149988,  2.249988,  2.349988,  2.449988,  2.549988,
        2.649988,  2.749988,  2.849988,  2.949988,  3.049988,  3.149988,
        3.249988,  3.349988,  3.449988,  3.549988,  3.649988,  3.749988,
        3.849988,  3.949988,  4.049988,  4.149988,  4.249988,  4.349988,
        4.449988,  4.549988,  4.649988,  4.749988,  4.849988,  4.949988,
        5.049988,  5.149988,  5.249988,  5.349988,  5.449988,  5.549988,
        5.649988,  5.749988,  5.849988,  5.949988,  6.049988,  6.149988,
        6.249988,  6.349988,  6.449988,  6.549988,  6.649988,  6.749988,
        6.849988,  6.949988,  7.049988,  7.149988,  7.249988,  7.349988,
        7.449988,  7.549988,  7.649988,  7.749988,  7.849988,  7.949988,
        8.049988,  8.149988,  8.249988,  8.349988,  8.449988,  8.549988,
        8.649988,  8.749988,  8.849988,  8.949988,  9.049988,  9.149988,
        9.249988,  9.349988,  9.449988,  9.549988])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>year</span></div><div class='xr-var-dims'>(year)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>2019 2020 2021</div><input id='attrs-2e9afcd3-d5af-4e3e-9036-27e6b7f35ea2' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2e9afcd3-d5af-4e3e-9036-27e6b7f35ea2' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b05403c9-c147-486f-9fcb-bd612546b589' class='xr-var-data-in' type='checkbox'><label for='data-b05403c9-c147-486f-9fcb-bd612546b589' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([2019, 2020, 2021])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-d49ca8f6-6601-494e-97a9-85ce5f744032' class='xr-section-summary-in' type='checkbox'  checked><label for='section-d49ca8f6-6601-494e-97a9-85ce5f744032' class='xr-section-summary' >Data variables: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>PM10</span></div><div class='xr-var-dims'>(year, latitude, longitude)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.0 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0</div><input id='attrs-e075cf47-bb3f-40ff-a441-cd28cac40dca' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-e075cf47-bb3f-40ff-a441-cd28cac40dca' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-576469f5-daa0-46d9-bcf2-adf4fdd05b99' class='xr-var-data-in' type='checkbox'><label for='data-576469f5-daa0-46d9-bcf2-adf4fdd05b99' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>µg m-3</dd><dt><span>long_name :</span></dt><dd>Particulate matter &lt; 10 µm</dd></dl></div><div class='xr-var-data'><pre>array([[[0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        ...,
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.]],

       [[0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        ...,
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.]],

       [[0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        ...,
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.],
        [0., 0., 0., ..., 0., 0., 0.]]], dtype=float32)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-39611b14-71ea-4e8e-ac93-2c0a50f9c829' class='xr-section-summary-in' type='checkbox'  checked><label for='section-39611b14-71ea-4e8e-ac93-2c0a50f9c829' class='xr-section-summary' >Attributes: <span>(8)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>transform :</span></dt><dd>(0.1, 0.0, -5.200012009298998, 0.0, -0.1, 51.09999699761336)</dd><dt><span>crs :</span></dt><dd>+init=epsg:4326</dd><dt><span>res :</span></dt><dd>(0.1, 0.1)</dd><dt><span>is_tiled :</span></dt><dd>0</dd><dt><span>nodatavals :</span></dt><dd>(0.0,)</dd><dt><span>scales :</span></dt><dd>(1.0,)</dd><dt><span>offsets :</span></dt><dd>(0.0,)</dd><dt><span>AREA_OR_POINT :</span></dt><dd>Area</dd></dl></div></li></ul></div></div></div></div>
</div>
</div>
<div class="section" id="visualize-data">
<h3>Visualize data<a class="headerlink" href="#visualize-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">cmaps</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting cmaps
  Using cached cmaps-1.0.5-py3-none-any.whl
Requirement already satisfied: matplotlib in /opt/conda/lib/python3.8/site-packages (from cmaps) (3.4.3)
Requirement already satisfied: numpy in /opt/conda/lib/python3.8/site-packages (from cmaps) (1.19.5)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in /opt/conda/lib/python3.8/site-packages (from matplotlib-&gt;cmaps) (1.3.1)
Requirement already satisfied: pillow&gt;=6.2.0 in /opt/conda/lib/python3.8/site-packages (from matplotlib-&gt;cmaps) (8.1.2)
Requirement already satisfied: cycler&gt;=0.10 in /opt/conda/lib/python3.8/site-packages (from matplotlib-&gt;cmaps) (0.10.0)
Requirement already satisfied: python-dateutil&gt;=2.7 in /opt/conda/lib/python3.8/site-packages (from matplotlib-&gt;cmaps) (2.8.1)
Requirement already satisfied: pyparsing&gt;=2.2.1 in /opt/conda/lib/python3.8/site-packages (from matplotlib-&gt;cmaps) (2.4.7)
Requirement already satisfied: six in /opt/conda/lib/python3.8/site-packages (from cycler&gt;=0.10-&gt;matplotlib-&gt;cmaps) (1.15.0)
Installing collected packages: cmaps
Successfully installed cmaps-1.0.5
Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">cmaps</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To plot over France, taking a central longitude of 24 is fine. You may want to change it when plotting over different geographical areas</span>
<span class="n">central_longitude</span> <span class="o">=</span> <span class="mf">24.0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># generate figure</span>
<span class="n">proj_plot</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mercator</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">)</span>

<span class="n">lcmap</span> <span class="o">=</span> <span class="n">cmaps</span><span class="o">.</span><span class="n">BlueYellowRed</span>
<span class="c1"># Only plot values greater than 0</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">geotiff_dm</span><span class="p">[</span><span class="s1">&#39;PM10&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">geotiff_dm</span><span class="p">[</span><span class="s1">&#39;PM10&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                            <span class="n">subplot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="n">proj_plot</span><span class="p">},</span>
                            <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                            <span class="n">col</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">lcmap</span><span class="p">,</span> <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># We have to set the map&#39;s options on all four axes</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span>  <span class="n">geotiff_dm</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Surface PM10</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;September &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;PM10_september_FR_2019-2021.png&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/RELIANCE_v0.2-France_67_0.png" src="../_images/RELIANCE_v0.2-France_67_0.png" />
</div>
</div>
</div>
<div class="section" id="plot-one-single-date">
<h3>Plot one single date<a class="headerlink" href="#plot-one-single-date" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="c1"># Define the projection</span>
<span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>

<span class="c1"># We&#39;re using cartopy and are plotting in Orthographic projection </span>
<span class="c1"># (see documentation on cartopy)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Mercator</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;10m&#39;</span><span class="p">)</span>

<span class="c1"># custom colormap</span>

<span class="n">lcmap</span> <span class="o">=</span> <span class="n">cmaps</span><span class="o">.</span><span class="n">BlueYellowRed</span>

<span class="c1"># We need to project our data to the new Mercator projection and for this we use `transform`.</span>
<span class="c1"># we set the original data projection in transform (here PlateCarree)</span>
<span class="c1"># we only plot values greather than 0</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">geotiff_ds</span><span class="p">[</span><span class="s1">&#39;PM10&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">geotiff_ds</span><span class="p">[</span><span class="s1">&#39;PM10&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;2021-09-15&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">lcmap</span><span class="p">)</span>  

<span class="c1"># Title for plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Surface PM10 </span><span class="se">\n</span><span class="s1"> 15th September 2021 over France&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;PM10_september_FR_2021-09-15.png&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/RELIANCE_v0.2-France_69_0.png" src="../_images/RELIANCE_v0.2-France_69_0.png" />
</div>
</div>
</div>
<div class="section" id="interactive-plot-with-bokeh">
<h3>Interactive plot with bokeh<a class="headerlink" href="#interactive-plot-with-bokeh" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">holoviews</span> <span class="k">as</span> <span class="nn">hv</span>
<span class="kn">import</span> <span class="nn">hvplot.xarray</span>
</pre></div>
</div>
</div>
</div>
<div align="center">
    <h1 style="font-size:5vw">PM10 over France from 1st September to 30th September 2021</h1>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geotiff_ds</span> <span class="o">=</span> <span class="n">geotiff_ds</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_start_time</span> <span class="o">=</span> <span class="s1">&#39;2021-09-01&#39;</span>
<span class="n">plot_end_time</span> <span class="o">=</span> <span class="s1">&#39;2021-09-30&#39;</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">geotiff_ds</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span> <span class="n">text_font_size</span><span class="o">=</span><span class="s1">&#39;6pt&#39;</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">xoffset</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">map_hv</span> <span class="o">=</span> <span class="n">geotiff_ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">geotiff_ds</span><span class="p">[</span><span class="s1">&#39;PM10&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">plot_start_time</span><span class="p">,</span> <span class="n">plot_end_time</span><span class="p">))</span><span class="o">.</span><span class="n">PM10</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span>
    <span class="n">groupby</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">lcmap</span><span class="p">,</span>
    <span class="n">geo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">coastline</span><span class="o">=</span><span class="s1">&#39;10m&#39;</span><span class="p">,</span>
    <span class="n">frame_width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
    <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">35</span><span class="p">)</span> 
<span class="p">)</span>
<span class="n">hv</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">map_hv</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="s2">&quot;interactive_map_&quot;</span> <span class="o">+</span> <span class="n">plot_start_time</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">plot_end_time</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span><span class="p">),</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;bokeh&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                               
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="save-data-cube-selection-into-netcdf">
<h3>Save Data Cube selection into netCDF<a class="headerlink" href="#save-data-cube-selection-into-netcdf" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geotiff_ds</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="s2">&quot;PM10_september_FR_2019-2021.nc&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-a-timeseries">
<h3>Plot a timeseries<a class="headerlink" href="#plot-a-timeseries" title="Permalink to this headline">¶</a></h3>
<div align="center">
    <h1 style="font-size:5vw">PM10 over Paris from 1st September to 30th September 2021</h1>
</div><p>Sort times and then select one location</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># You may change this location accordingly</span>
<span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;Paris&quot;</span>
<span class="n">latitude</span> <span class="o">=</span> <span class="mf">48.864716</span>
<span class="n">longitude</span> <span class="o">=</span> <span class="mf">2.349014</span>
<span class="n">plot_end_time</span> <span class="o">=</span> <span class="s1">&#39;2021-09-01&#39;</span>
<span class="n">plot_end_time</span> <span class="o">=</span> <span class="s1">&#39;2021-09-30&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">geotiff_ds</span><span class="p">[</span><span class="s1">&#39;PM10&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">geotiff_ds</span><span class="p">[</span><span class="s1">&#39;PM10&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span> \
        <span class="n">sel</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">longitude</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span><span class="o">.</span> \
        <span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">plot_start_time</span><span class="p">,</span> <span class="n">plot_end_time</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_plot</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">ts</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_plot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div id='4065'>





  <div class="bk-root" id="5dd5392b-e149-4222-b952-0041919eca15" data-root-id="4065"></div>
</div>
<script type="application/javascript">(function(root) {
  function embed_document(root) {
    var docs_json = {"59370c82-ebaf-4a04-8455-c245a7b97f19":{"defs":[{"extends":null,"module":null,"name":"ReactiveHTML1","overrides":[],"properties":[]},{"extends":null,"module":null,"name":"FlexBox1","overrides":[],"properties":[{"default":"flex-start","kind":null,"name":"align_content"},{"default":"flex-start","kind":null,"name":"align_items"},{"default":"row","kind":null,"name":"flex_direction"},{"default":"wrap","kind":null,"name":"flex_wrap"},{"default":"flex-start","kind":null,"name":"justify_content"}]},{"extends":null,"module":null,"name":"TemplateActions1","overrides":[],"properties":[{"default":0,"kind":null,"name":"open_modal"},{"default":0,"kind":null,"name":"close_modal"}]},{"extends":null,"module":null,"name":"MaterialTemplateActions1","overrides":[],"properties":[{"default":0,"kind":null,"name":"open_modal"},{"default":0,"kind":null,"name":"close_modal"}]}],"roots":{"references":[{"attributes":{"text_color":"black","text_font_size":"12pt"},"id":"4076","type":"Title"},{"attributes":{"source":{"id":"4122"}},"id":"4129","type":"CDSView"},{"attributes":{"data_source":{"id":"4122"},"glyph":{"id":"4125"},"hover_glyph":null,"muted_glyph":{"id":"4127"},"nonselection_glyph":{"id":"4126"},"selection_glyph":{"id":"4130"},"view":{"id":"4129"}},"id":"4128","type":"GlyphRenderer"},{"attributes":{"line_alpha":0.2,"line_color":"purple","line_width":2,"x":{"field":"time"},"y":{"field":"PM10"}},"id":"4118","type":"Line"},{"attributes":{"mantissas":[1,2,5],"max_interval":500.0,"num_minor_ticks":0},"id":"4142","type":"AdaptiveTicker"},{"attributes":{},"id":"4082","type":"LinearScale"},{"attributes":{"axis_label":"Particulate matter < 10 \u00b5m (\u00b5g m-3)","formatter":{"id":"4111"},"major_label_policy":{"id":"4112"},"ticker":{"id":"4089"}},"id":"4088","type":"LinearAxis"},{"attributes":{},"id":"4111","type":"BasicTickFormatter"},{"attributes":{"line_color":"purple","line_width":2,"x":{"field":"time"},"y":{"field":"PM10"}},"id":"4116","type":"Line"},{"attributes":{},"id":"4114","type":"Selection"},{"attributes":{"axis":{"id":"4088"},"dimension":1,"grid_line_color":null,"ticker":null},"id":"4091","type":"Grid"},{"attributes":{"axis":{"id":"4084"},"grid_line_color":null,"ticker":null},"id":"4087","type":"Grid"},{"attributes":{},"id":"4141","type":"UnionRenderers"},{"attributes":{"end":25.872784423828126,"reset_end":25.872784423828126,"reset_start":9.163966369628906,"start":9.163966369628906,"tags":[[["PM10","Particulate matter < 10 \u00b5m","\u00b5g m-3"]]]},"id":"4070","type":"Range1d"},{"attributes":{"bottom_units":"screen","fill_alpha":0.5,"fill_color":"lightgrey","left_units":"screen","level":"overlay","line_alpha":1.0,"line_color":"black","line_dash":[4,4],"line_width":2,"right_units":"screen","syncable":false,"top_units":"screen"},"id":"4097","type":"BoxAnnotation"},{"attributes":{"axis_label":"time","formatter":{"id":"4108"},"major_label_policy":{"id":"4109"},"ticker":{"id":"4085"}},"id":"4084","type":"DatetimeAxis"},{"attributes":{},"id":"4089","type":"BasicTicker"},{"attributes":{"months":[0,2,4,6,8,10]},"id":"4150","type":"MonthsTicker"},{"attributes":{"angle":{"value":0.0},"fill_alpha":{"value":1.0},"fill_color":{"value":"blue"},"hatch_alpha":{"value":1.0},"hatch_color":{"value":"black"},"hatch_scale":{"value":12.0},"hatch_weight":{"value":1.0},"line_alpha":{"value":1.0},"line_cap":{"value":"butt"},"line_color":{"value":"blue"},"line_dash":{"value":[]},"line_dash_offset":{"value":0},"line_join":{"value":"bevel"},"line_width":{"value":1},"marker":{"value":"circle"},"size":{"value":3.872983346207417},"x":{"field":"time"},"y":{"field":"PM10"}},"id":"4130","type":"Scatter"},{"attributes":{"base":24,"mantissas":[1,2,4,6,8,12],"max_interval":43200000.0,"min_interval":3600000.0,"num_minor_ticks":0},"id":"4144","type":"AdaptiveTicker"},{"attributes":{"months":[0,1,2,3,4,5,6,7,8,9,10,11]},"id":"4149","type":"MonthsTicker"},{"attributes":{},"id":"4123","type":"Selection"},{"attributes":{"days":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]},"id":"4145","type":"DaysTicker"},{"attributes":{"data":{"PM10":{"__ndarray__":"tvOrQQhdqEHT18NBpvWvQcYAjkFP16tB1kihQf53qkGk6IBBkY8rQeLmKEFccoJBT2pyQfVsdkFDjZlBNBuNQXOBjEEB8YtBpamSQbBYY0Ep2LdBU6moQdEcv0HV2pVB7LSeQdR/c0H8szpBzwCJQZxrKUGMo2hB","dtype":"float32","order":"little","shape":[30]},"time":{"__ndarray__":"AABAfOq5d0IAAADiPLp3QgAAwEePundCAACAreG6d0IAAEATNLt3QgAAAHmGu3dCAADA3ti7d0IAAIBEK7x3QgAAQKp9vHdCAAAAENC8d0IAAMB1Ir13QgAAgNt0vXdCAABAQce9d0IAAACnGb53QgAAwAxsvndCAACAcr6+d0IAAEDYEL93QgAAAD5jv3dCAADAo7W/d0IAAIAJCMB3QgAAQG9awHdCAAAA1azAd0IAAMA6/8B3QgAAgKBRwXdCAABABqTBd0IAAABs9sF3QgAAwNFIwndCAACAN5vCd0IAAECd7cJ3QgAAAANAw3dC","dtype":"float64","order":"little","shape":[30]}},"selected":{"id":"4123"},"selection_policy":{"id":"4141"}},"id":"4122","type":"ColumnDataSource"},{"attributes":{"days":[1,15]},"id":"4148","type":"DaysTicker"},{"attributes":{"below":[{"id":"4084"}],"center":[{"id":"4087"},{"id":"4091"}],"height":300,"left":[{"id":"4088"}],"margin":[5,5,5,5],"min_border_bottom":10,"min_border_left":10,"min_border_right":10,"min_border_top":10,"renderers":[{"id":"4119"},{"id":"4128"}],"sizing_mode":"fixed","title":{"id":"4076"},"toolbar":{"id":"4098"},"width":700,"x_range":{"id":"4069"},"x_scale":{"id":"4080"},"y_range":{"id":"4070"},"y_scale":{"id":"4082"}},"id":"4075","subtype":"Figure","type":"Plot"},{"attributes":{"line_color":"purple","line_width":2,"x":{"field":"time"},"y":{"field":"PM10"}},"id":"4121","type":"Line"},{"attributes":{"base":60,"mantissas":[1,2,5,10,15,20,30],"max_interval":1800000.0,"min_interval":1000.0,"num_minor_ticks":0},"id":"4143","type":"AdaptiveTicker"},{"attributes":{"overlay":{"id":"4097"}},"id":"4095","type":"BoxZoomTool"},{"attributes":{"days":[1,8,15,22]},"id":"4147","type":"DaysTicker"},{"attributes":{"margin":[5,5,5,5],"name":"HSpacer16981","sizing_mode":"stretch_width"},"id":"4347","type":"Spacer"},{"attributes":{},"id":"4139","type":"UnionRenderers"},{"attributes":{"days":[1,4,7,10,13,16,19,22,25,28]},"id":"4146","type":"DaysTicker"},{"attributes":{"active_multi":null,"tools":[{"id":"4071"},{"id":"4092"},{"id":"4093"},{"id":"4094"},{"id":"4095"},{"id":"4096"}]},"id":"4098","type":"Toolbar"},{"attributes":{},"id":"4112","type":"AllLabels"},{"attributes":{"months":[0,6]},"id":"4152","type":"MonthsTicker"},{"attributes":{},"id":"4153","type":"YearsTicker"},{"attributes":{"source":{"id":"4113"}},"id":"4120","type":"CDSView"},{"attributes":{"end":1632960000000.0,"reset_end":1632960000000.0,"reset_start":1630454400000.0,"start":1630454400000.0,"tags":[[["time","time",null]]]},"id":"4069","type":"Range1d"},{"attributes":{},"id":"4108","type":"DatetimeTickFormatter"},{"attributes":{},"id":"4096","type":"ResetTool"},{"attributes":{},"id":"4080","type":"LinearScale"},{"attributes":{},"id":"4109","type":"AllLabels"},{"attributes":{},"id":"4092","type":"SaveTool"},{"attributes":{"months":[0,4,8]},"id":"4151","type":"MonthsTicker"},{"attributes":{"children":[{"id":"4066"},{"id":"4075"},{"id":"4347"}],"margin":[0,0,0,0],"name":"Row16976","tags":["embedded"]},"id":"4065","type":"Row"},{"attributes":{"fill_color":{"value":"blue"},"line_color":{"value":"blue"},"size":{"value":3.872983346207417},"x":{"field":"time"},"y":{"field":"PM10"}},"id":"4125","type":"Scatter"},{"attributes":{"num_minor_ticks":5,"tickers":[{"id":"4142"},{"id":"4143"},{"id":"4144"},{"id":"4145"},{"id":"4146"},{"id":"4147"},{"id":"4148"},{"id":"4149"},{"id":"4150"},{"id":"4151"},{"id":"4152"},{"id":"4153"}]},"id":"4085","type":"DatetimeTicker"},{"attributes":{"margin":[5,5,5,5],"name":"HSpacer16980","sizing_mode":"stretch_width"},"id":"4066","type":"Spacer"},{"attributes":{"data":{"PM10":{"__ndarray__":"tvOrQQhdqEHT18NBpvWvQcYAjkFP16tB1kihQf53qkGk6IBBkY8rQeLmKEFccoJBT2pyQfVsdkFDjZlBNBuNQXOBjEEB8YtBpamSQbBYY0Ep2LdBU6moQdEcv0HV2pVB7LSeQdR/c0H8szpBzwCJQZxrKUGMo2hB","dtype":"float32","order":"little","shape":[30]},"time":{"__ndarray__":"AABAfOq5d0IAAADiPLp3QgAAwEePundCAACAreG6d0IAAEATNLt3QgAAAHmGu3dCAADA3ti7d0IAAIBEK7x3QgAAQKp9vHdCAAAAENC8d0IAAMB1Ir13QgAAgNt0vXdCAABAQce9d0IAAACnGb53QgAAwAxsvndCAACAcr6+d0IAAEDYEL93QgAAAD5jv3dCAADAo7W/d0IAAIAJCMB3QgAAQG9awHdCAAAA1azAd0IAAMA6/8B3QgAAgKBRwXdCAABABqTBd0IAAABs9sF3QgAAwNFIwndCAACAN5vCd0IAAECd7cJ3QgAAAANAw3dC","dtype":"float64","order":"little","shape":[30]}},"selected":{"id":"4114"},"selection_policy":{"id":"4139"}},"id":"4113","type":"ColumnDataSource"},{"attributes":{},"id":"4094","type":"WheelZoomTool"},{"attributes":{"data_source":{"id":"4113"},"glyph":{"id":"4116"},"hover_glyph":null,"muted_glyph":{"id":"4118"},"nonselection_glyph":{"id":"4117"},"selection_glyph":{"id":"4121"},"view":{"id":"4120"}},"id":"4119","type":"GlyphRenderer"},{"attributes":{"fill_alpha":{"value":0.2},"fill_color":{"value":"blue"},"line_alpha":{"value":0.2},"line_color":{"value":"blue"},"size":{"value":3.872983346207417},"x":{"field":"time"},"y":{"field":"PM10"}},"id":"4127","type":"Scatter"},{"attributes":{"callback":null,"formatters":{"@{time}":"datetime"},"renderers":[{"id":"4119"},{"id":"4128"}],"tags":["hv_created"],"tooltips":[["time","@{time}{%F %T}"],["Particulate matter < 10 \u00b5m (\u00b5g m-3)","@{PM10}"]]},"id":"4071","type":"HoverTool"},{"attributes":{},"id":"4093","type":"PanTool"},{"attributes":{"line_alpha":0.1,"line_color":"purple","line_width":2,"x":{"field":"time"},"y":{"field":"PM10"}},"id":"4117","type":"Line"},{"attributes":{"fill_alpha":{"value":0.1},"fill_color":{"value":"blue"},"line_alpha":{"value":0.1},"line_color":{"value":"blue"},"size":{"value":3.872983346207417},"x":{"field":"time"},"y":{"field":"PM10"}},"id":"4126","type":"Scatter"}],"root_ids":["4065"]},"title":"Bokeh Application","version":"2.3.1"}};
    var render_items = [{"docid":"59370c82-ebaf-4a04-8455-c245a7b97f19","root_ids":["4065"],"roots":{"4065":"5dd5392b-e149-4222-b952-0041919eca15"}}];
    root.Bokeh.embed.embed_items_notebook(docs_json, render_items);
  }
  if (root.Bokeh !== undefined && root.Bokeh.Panel !== undefined) {
    embed_document(root);
  } else {
    var attempts = 0;
    var timer = setInterval(function(root) {
      if (root.Bokeh !== undefined && root.Bokeh.Panel !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else if (document.readyState == "complete") {
        attempts++;
        if (attempts > 200) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 25, root)
  }
})(window);</script></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hv</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">ts_plot</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="s2">&quot;interactive_timeseries_&quot;</span> <span class="o">+</span> <span class="n">location</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">plot_start_time</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">plot_end_time</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span><span class="p">),</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;bokeh&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="save-timeseries-into-tabular-csv-file">
<h3>Save timeseries into tabular (csv) file<a class="headerlink" href="#save-timeseries-into-tabular-csv-file" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="s2">&quot;timeseries_paris_september2021.csv&quot;</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="a-id-7-rohub-a-step-7-create-research-object-and-share-my-work">
<h2><a id=7.rohub></a> <strong>Step 7: Create Research Object and Share my work</strong><a class="headerlink" href="#a-id-7-rohub-a-step-7-create-research-object-and-share-my-work" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="create-research-object-in-rohub">
<h2>Create Research Object in ROHUB<a class="headerlink" href="#create-research-object-in-rohub" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">rohub</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: rohub in /opt/conda/lib/python3.8/site-packages (1.0.0.post1)
Requirement already satisfied: pandas in /opt/conda/lib/python3.8/site-packages (from rohub) (1.2.4)
Requirement already satisfied: requests in /opt/conda/lib/python3.8/site-packages (from rohub) (2.25.1)
Requirement already satisfied: python-dateutil&gt;=2.7.3 in /opt/conda/lib/python3.8/site-packages (from pandas-&gt;rohub) (2.8.1)
Requirement already satisfied: pytz&gt;=2017.3 in /opt/conda/lib/python3.8/site-packages (from pandas-&gt;rohub) (2021.1)
Requirement already satisfied: numpy&gt;=1.16.5 in /opt/conda/lib/python3.8/site-packages (from pandas-&gt;rohub) (1.19.5)
Requirement already satisfied: six&gt;=1.5 in /opt/conda/lib/python3.8/site-packages (from python-dateutil&gt;=2.7.3-&gt;pandas-&gt;rohub) (1.15.0)
Requirement already satisfied: certifi&gt;=2017.4.17 in /opt/conda/lib/python3.8/site-packages (from requests-&gt;rohub) (2021.10.8)
Requirement already satisfied: chardet&lt;5,&gt;=3.0.2 in /opt/conda/lib/python3.8/site-packages (from requests-&gt;rohub) (4.0.0)
Requirement already satisfied: urllib3&lt;1.27,&gt;=1.21.1 in /opt/conda/lib/python3.8/site-packages (from requests-&gt;rohub) (1.26.4)
Requirement already satisfied: idna&lt;3,&gt;=2.5 in /opt/conda/lib/python3.8/site-packages (from requests-&gt;rohub) (2.10)
Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">from</span> <span class="nn">rohub</span> <span class="kn">import</span> <span class="n">rohub</span><span class="p">,</span> <span class="n">settings</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="authenticating">
<h3>Authenticating<a class="headerlink" href="#authenticating" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>If the code cell below fails,  make sure you have created the two files:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">rohub-user</span></code>: contains your rohub username</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rohub-pwd</span></code>: contains your rohub password</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rohub_user</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s2">&quot;rohub-user&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
<span class="n">rohub_pwd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s2">&quot;rohub-pwd&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rohub</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">rohub_user</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">rohub_pwd</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Logged successfully as annefou@geo.uio.no.
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="create-a-new-exectuable-ro">
<h2>Create a new Exectuable RO<a class="headerlink" href="#create-a-new-exectuable-ro" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ro_title</span> <span class="o">=</span> <span class="s2">&quot;Jupyter notebook demonstrating the usage of CAMS European air quality analysis from Copernicus Atmosphere Monitoring with RELIANCE services&quot;</span>
<span class="n">ro_research_areas</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Earth sciences&quot;</span><span class="p">]</span>
<span class="n">ro_description</span> <span class="o">=</span> <span class="s2">&quot;This Research Object demonstrates how to use CAMS European air quality analysis from Copernicus Atmosphere Monitoring with RELIANCE services and compute monthly map of PM10 over a given geographical area.&quot;</span>
<span class="n">ro</span> <span class="o">=</span> <span class="n">rohub</span><span class="o">.</span><span class="n">ros_create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">ro_title</span><span class="p">,</span> <span class="n">research_areas</span><span class="o">=</span><span class="n">ro_research_areas</span><span class="p">,</span> 
                      <span class="n">description</span><span class="o">=</span><span class="n">ro_description</span><span class="p">,</span> 
                      <span class="n">template</span><span class="o">=</span><span class="s2">&quot;Executable Research Object folders structure&quot;</span><span class="p">,</span>
                      <span class="n">ros_type</span><span class="o">=</span><span class="s2">&quot;Executable Research Object&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Research Object was successfully created with id = b13d7b6a-66bf-40df-84c8-f9c88775b6c1
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="show-metadata">
<h2>Show metadata<a class="headerlink" href="#show-metadata" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ro</span><span class="o">.</span><span class="n">show_metadata</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;identifier&#39;: &#39;b13d7b6a-66bf-40df-84c8-f9c88775b6c1&#39;,
 &#39;shared_link&#39;: &#39;https://w3id.org/ro-id/b13d7b6a-66bf-40df-84c8-f9c88775b6c1&#39;,
 &#39;title&#39;: &#39;Jupyter notebook demonstrating the usage of CAMS European air quality analysis from Copernicus Atmosphere Monitoring with RELIANCE services&#39;,
 &#39;description&#39;: &#39;This Research Object demonstrates how to use CAMS European air quality analysis from Copernicus Atmosphere Monitoring with RELIANCE services and compute monthly map of PM10 over a given geographical area.&#39;,
 &#39;status&#39;: &#39;LIVE&#39;,
 &#39;access_mode&#39;: &#39;PUBLIC&#39;,
 &#39;type&#39;: &#39;Executable Research Object&#39;,
 &#39;template&#39;: &#39;Executable Research Object folders structure&#39;,
 &#39;created&#39;: &#39;2022-01-18T18:28:05.432674Z&#39;,
 &#39;creator&#39;: &#39;annefou@geo.uio.no&#39;,
 &#39;modificator&#39;: None,
 &#39;modified&#39;: &#39;2022-01-18T18:28:05.736775Z&#39;,
 &#39;importer&#39;: None,
 &#39;research_areas&#39;: [&#39;Earth sciences&#39;],
 &#39;owner&#39;: &#39;annefou@geo.uio.no&#39;,
 &#39;editors&#39;: [],
 &#39;readers&#39;: [],
 &#39;rating&#39;: &#39;0.00&#39;,
 &#39;number_of_ratings&#39;: 0,
 &#39;number_of_likes&#39;: 0,
 &#39;number_of_dislikes&#39;: 0,
 &#39;quality&#39;: 0,
 &#39;size&#39;: 0,
 &#39;creation_mode&#39;: &#39;MANUAL&#39;,
 &#39;doi&#39;: None,
 &#39;api_link&#39;: &#39;https://api.rohub.org/api/ros/b13d7b6a-66bf-40df-84c8-f9c88775b6c1/&#39;}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-additional-authors-and-or-contributors-to-our-research-object">
<h2>Add additional authors and/or contributors to our Research Object<a class="headerlink" href="#add-additional-authors-and-or-contributors-to-our-research-object" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">usernames</span> <span class="o">=</span> <span class="n">rohub</span><span class="o">.</span><span class="n">users_find</span><span class="p">(</span><span class="n">search</span><span class="o">=</span><span class="s2">&quot;jeani@uio.no&quot;</span><span class="p">)</span>
<span class="n">usernames</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>identifier</th>
      <th>username</th>
      <th>display_name</th>
      <th>affiliation</th>
      <th>orcid_identifier</th>
      <th>external</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1ac03644-c78c-4ca2-b0b4-2d9e40f671af</td>
      <td>jeani@uio.no</td>
      <td>Jean Iaquinta</td>
      <td>UiO</td>
      <td>0000-0002-8763-1643</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">additional_username</span> <span class="o">=</span> <span class="n">usernames</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ro</span><span class="o">.</span><span class="n">set_authors</span><span class="p">(</span><span class="n">agents</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;annefou@geo.uio.no&#39;</span><span class="p">,</span> <span class="n">additional_username</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Agent: annefou@geo.uio.no recognized in the system.
Agent: jeani@uio.no recognized in the system.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;username&#39;: &#39;annefou@geo.uio.no&#39;,
  &#39;name&#39;: &#39;annefou@geo.uio.no&#39;,
  &#39;display_name&#39;: &#39;Anne Fouilloux&#39;,
  &#39;orcid_identifier&#39;: &#39;0000-0002-1784-2920&#39;,
  &#39;affiliation&#39;: &#39;Nordic e-Infrastructure Collaboration (NeIC)&#39;},
 {&#39;username&#39;: &#39;jeani@uio.no&#39;,
  &#39;name&#39;: &#39;jeani@uio.no&#39;,
  &#39;display_name&#39;: &#39;Jean Iaquinta&#39;,
  &#39;orcid_identifier&#39;: &#39;0000-0002-8763-1643&#39;,
  &#39;affiliation&#39;: &#39;UiO&#39;}]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-publisher-copyright-holder">
<h2>Add publisher/copyright holder<a class="headerlink" href="#add-publisher-copyright-holder" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Use <a class="reference external" href="https://ror.org/">Research Organization Registry (ROR)</a> to find the identifier of your organization</p></li>
</ul>
<div class="section" id="add-the-university-of-olso-and-the-nordic-e-infrastructure-collaboration-as-publishers">
<h3>Add the University of Olso and the Nordic e-Infrastructure Collaboration as publishers<a class="headerlink" href="#add-the-university-of-olso-and-the-nordic-e-infrastructure-collaboration-as-publishers" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NeIC_organization</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;org_id&quot;</span><span class="p">:</span><span class="s2">&quot;https://neic.no/&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;display_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Nordic e-Infrastructure Collaboration&quot;</span><span class="p">,</span> 
                     <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ror_identifier&quot;</span><span class="p">:</span><span class="s2">&quot;04jcwf484&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;organization_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://neic.no/&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">UiO_organization</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;org_id&quot;</span><span class="p">:</span><span class="s2">&quot;http://www.uio.no/english/&quot;</span><span class="p">,</span> 
                     <span class="s2">&quot;display_name&quot;</span><span class="p">:</span> <span class="s2">&quot;University of Oslo&quot;</span><span class="p">,</span> 
                     <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;ror_identifier&quot;</span><span class="p">:</span><span class="s2">&quot;01xtthb56&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;organization_url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://www.uio.no/english/&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ro</span><span class="o">.</span><span class="n">set_publishers</span><span class="p">(</span><span class="n">agents</span><span class="o">=</span><span class="p">[</span><span class="n">NeIC_organization</span><span class="p">,</span> <span class="n">UiO_organization</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Agent: {&#39;org_id&#39;: &#39;https://neic.no/&#39;, &#39;display_name&#39;: &#39;Nordic e-Infrastructure Collaboration&#39;, &#39;email&#39;: &#39;&#39;, &#39;ror_identifier&#39;: &#39;04jcwf484&#39;, &#39;organization_url&#39;: &#39;https://neic.no/&#39;} recognized in the system.
Agent: {&#39;org_id&#39;: &#39;http://www.uio.no/english/&#39;, &#39;display_name&#39;: &#39;University of Oslo&#39;, &#39;email&#39;: &#39;&#39;, &#39;ror_identifier&#39;: &#39;01xtthb56&#39;, &#39;organization_url&#39;: &#39;http://www.uio.no/english/&#39;} recognized in the system.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;username&#39;: &#39;https://neic.no/&#39;,
  &#39;name&#39;: &#39;https://neic.no/&#39;,
  &#39;display_name&#39;: &#39;Nordic e-Infrastructure Collaboration&#39;},
 {&#39;username&#39;: &#39;http://www.uio.no/english/&#39;,
  &#39;name&#39;: &#39;http://www.uio.no/english/&#39;,
  &#39;display_name&#39;: &#39;University of Oslo&#39;}]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ro</span><span class="o">.</span><span class="n">set_copyright_holders</span><span class="p">(</span><span class="n">agents</span><span class="o">=</span><span class="p">[</span><span class="n">UiO_organization</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Agent: {&#39;org_id&#39;: &#39;http://www.uio.no/english/&#39;, &#39;display_name&#39;: &#39;University of Oslo&#39;, &#39;email&#39;: &#39;&#39;, &#39;ror_identifier&#39;: &#39;01xtthb56&#39;, &#39;organization_url&#39;: &#39;http://www.uio.no/english/&#39;} recognized in the system.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;username&#39;: &#39;http://www.uio.no/english/&#39;,
  &#39;name&#39;: &#39;http://www.uio.no/english/&#39;,
  &#39;display_name&#39;: &#39;University of Oslo&#39;}]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">organizations</span> <span class="o">=</span> <span class="n">rohub</span><span class="o">.</span><span class="n">organizations_find</span><span class="p">()</span>
<span class="n">organizations</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>identifier</th>
      <th>organization_id</th>
      <th>display_name</th>
      <th>email</th>
      <th>url</th>
      <th>ror_identifier</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>92459295-cc33-40a2-b2ca-e416ad73a95e</td>
      <td>neworg_1@example.org</td>
      <td>Example Org 1</td>
      <td>neworg1@example.org</td>
      <td>http://neworg1.example.org</td>
      <td>abcd123</td>
    </tr>
    <tr>
      <th>1</th>
      <td>556f3671-87b4-4576-b39d-654942ef248e</td>
      <td>neworg_2@example.org</td>
      <td>Example Org 2</td>
      <td>neworg2@example.org</td>
      <td>http://neworg2.example.org</td>
      <td>abcd123</td>
    </tr>
    <tr>
      <th>2</th>
      <td>b1893a50-9f9b-49e8-8ab7-114152e29b9e</td>
      <td>https://neic.no/</td>
      <td>Nordic e-Infrastructure Collaboration</td>
      <td></td>
      <td>https://neic.no/</td>
      <td>04jcwf484</td>
    </tr>
    <tr>
      <th>3</th>
      <td>64ec5402-1171-42f6-b9dd-6fa901ca9724</td>
      <td>https://ror.org/025cj6e44</td>
      <td>Poznan Supercomputing and Networking Center</td>
      <td>office@man.poznan.pl</td>
      <td>https://www.psnc.pl/</td>
      <td>025cj6e44</td>
    </tr>
    <tr>
      <th>4</th>
      <td>f8b4ad0c-a4b1-4595-81a0-dcf42db083d4</td>
      <td>http://www.uio.no/english/</td>
      <td>University of Oslo</td>
      <td></td>
      <td>http://www.uio.no/english/</td>
      <td>01xtthb56</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="add-ro-funding-information">
<h2>Add RO Funding information<a class="headerlink" href="#add-ro-funding-information" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grant_id</span><span class="o">=</span><span class="s2">&quot;101017502&quot;</span>
<span class="n">grant_Name</span><span class="o">=</span><span class="s2">&quot;RELIANCE&quot;</span>
<span class="n">grant_title</span><span class="o">=</span><span class="s2">&quot;Research Lifecycle Management for Earth Science Communities and Copernicus Users&quot;</span>
<span class="n">funder_name</span><span class="o">=</span><span class="s2">&quot;European Commission&quot;</span>
<span class="n">funder_doi</span><span class="o">=</span><span class="s2">&quot;10.13039/501100000781&quot;</span>

<span class="c1">#ro.set_funding(grant_identifier=grant_id, grant_name=grant_Name, funder_name=funder_name, grant_title=grant_title, funder_doi=funder_doi)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-ro-license">
<h2>Add RO license<a class="headerlink" href="#add-ro-license" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">licenses</span> <span class="o">=</span> <span class="n">rohub</span><span class="o">.</span><span class="n">list_available_licenses</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">licenses</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;0BSD&#39;, &#39;AAL&#39;, &#39;ADSL&#39;, &#39;AFL-1.1&#39;, &#39;AFL-1.2&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ro</span><span class="o">.</span><span class="n">set_license</span><span class="p">(</span><span class="n">license_id</span><span class="o">=</span><span class="s1">&#39;MIT&#39;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;identifier&#39;: &#39;MIT&#39;,
 &#39;title&#39;: &#39;MIT License&#39;,
 &#39;description&#39;: &#39;MIT License&#39;,
 &#39;created&#39;: &#39;2016-09-12T02:51:35.895509+00:00&#39;,
 &#39;updated&#39;: &#39;2021-10-07T08:21:23.483114+00:00&#39;,
 &#39;creator&#39;: None,
 &#39;status&#39;: &#39;active&#39;,
 &#39;url&#39;: &#39;https://opensource.org/licenses/MIT&#39;,
 &#39;custom&#39;: False}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="aggregate-resources">
<h2>Aggregate Resources<a class="headerlink" href="#aggregate-resources" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>We will be adding all the resources generated by our notebook (data and plots)</p></li>
<li><p>Our data and plots can also be shared in B2DROP so we will get the shared link from B2DROP and add it to our research object</p></li>
</ul>
<div class="section" id="list-ro-folders-for-this-type-of-ro">
<h3>List RO folders for this type of RO<a class="headerlink" href="#list-ro-folders-for-this-type-of-ro" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">myfolders</span> <span class="o">=</span> <span class="n">ro</span><span class="o">.</span><span class="n">list_folders</span><span class="p">()</span>
<span class="n">myfolders</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>identifier</th>
      <th>name</th>
      <th>description</th>
      <th>creator</th>
      <th>created_on</th>
      <th>modified_on</th>
      <th>path</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>e107aafc-acee-4e2e-b211-e3d2ff81affe</td>
      <td>biblio</td>
      <td>None</td>
      <td>annefou@geo.uio.no</td>
      <td>2022-01-18T18:28:05.875544+0000</td>
      <td>2022-01-18T18:28:05.876593+0000</td>
      <td>biblio</td>
    </tr>
    <tr>
      <th>1</th>
      <td>e7994c37-86b7-4072-a06f-71825b41181a</td>
      <td>input</td>
      <td>None</td>
      <td>annefou@geo.uio.no</td>
      <td>2022-01-18T18:28:05.875693+0000</td>
      <td>2022-01-18T18:28:05.876703+0000</td>
      <td>input</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ab50dbb5-4132-4d6d-a19d-c31372e941e2</td>
      <td>output</td>
      <td>None</td>
      <td>annefou@geo.uio.no</td>
      <td>2022-01-18T18:28:05.875783+0000</td>
      <td>2022-01-18T18:28:05.876770+0000</td>
      <td>output</td>
    </tr>
    <tr>
      <th>3</th>
      <td>da2feea4-1c97-49c0-ab7d-85f5f3344399</td>
      <td>tool</td>
      <td>None</td>
      <td>annefou@geo.uio.no</td>
      <td>2022-01-18T18:28:05.875864+0000</td>
      <td>2022-01-18T18:28:05.876832+0000</td>
      <td>tool</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="aggregate-internal-resources">
<h2>Aggregate internal resources<a class="headerlink" href="#aggregate-internal-resources" title="Permalink to this headline">¶</a></h2>
<div class="section" id="add-sketch-to-my-ro">
<h3>Add sketch to my RO<a class="headerlink" href="#add-sketch-to-my-ro" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;PM10_september_FR_2019-2021.png&#39;</span><span class="p">)</span>
<span class="n">res_res_type</span> <span class="o">=</span> <span class="s2">&quot;Sketch&quot;</span>
<span class="n">res_title</span> <span class="o">=</span> <span class="s2">&quot;Particule matter &lt; 10 μm [μg/m3] over France for September 2019, 2020 and 2021&quot;</span>
<span class="n">res_description</span> <span class="o">=</span> <span class="s2">&quot;Monthly average maps of CAMS Particule matter &lt; 10 μm [μg/m3] over France in 2019, 2020 and 2021&quot;</span>
<span class="n">res_folder</span> <span class="o">=</span>  <span class="n">myfolders</span><span class="p">[</span><span class="n">myfolders</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;output&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;identifier&#39;</span><span class="p">]</span>

<span class="n">ro</span><span class="o">.</span><span class="n">add_internal_resource</span><span class="p">(</span><span class="n">res_type</span><span class="o">=</span><span class="n">res_res_type</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">res_file_path</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">res_title</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">res_description</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">res_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resource was successfully created with id = 759450a8-3a93-4fea-a270-3c5d6187aee3
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resource(identifier=759450a8-3a93-4fea-a270-3c5d6187aee3, post_request=False)
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="aggregate-external-resources">
<h2>Aggregate external resources<a class="headerlink" href="#aggregate-external-resources" title="Permalink to this headline">¶</a></h2>
<div class="section" id="get-shared-link-from-datahub">
<h3>Get shared link from datahub<a class="headerlink" href="#get-shared-link-from-datahub" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>Retrieve your client identifier, client secret and refresh token from <a class="reference external" href="https://aai.egi.eu/fedcloud/">https://aai.egi.eu/fedcloud/</a></p></li>
<li><p>Create a new file in your HOME area for instance using nano (keep <code class="docutils literal notranslate"><span class="pre">$</span></code> character in front of HOME; this is meant to be an environment variable):</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>nano $HOME/egi_fedcloud.cfg
</pre></div>
</div>
<ol class="simple">
<li><p>paste your client identifier, client secret and refresh token using the following syntax (do not forget <code class="docutils literal notranslate"><span class="pre">{</span></code> and <code class="docutils literal notranslate"><span class="pre">}</span></code> as well as comma <code class="docutils literal notranslate"><span class="pre">,</span></code> and columns <code class="docutils literal notranslate"><span class="pre">:</span></code></p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;XXXXXXXXXXXXXXXXX&quot;</span><span class="p">,</span>
<span class="s2">&quot;secret&quot;</span><span class="p">:</span> <span class="s2">&quot;YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY&quot;</span><span class="p">,</span>
<span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="s2">&quot;ffffffffffffffffffffffff&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="simple">
<li><p>You are ready to go. If you have issues, check first that the syntax is correct in your egi_fedcloud.cfg, that this file is located in the correct folder and than finally that your refresh token is still valid (check on <a class="reference external" href="https://aai.egi.eu/fedcloud/">https://aai.egi.eu/fedcloud/</a>)</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">shutil</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="egi-datahub-functions-to-initialize-egi-datahub-and-get-shared-link">
<h4>EGI Datahub functions to initialize EGI datahub and get shared link<a class="headerlink" href="#egi-datahub-functions-to-initialize-egi-datahub-and-get-shared-link" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">egi_datahub_init</span><span class="p">():</span>
    <span class="n">egi_fedcloud_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span> <span class="s1">&#39;egi_fedcloud.cfg&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">egi_fedcloud_filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">convert_file</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">convert_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">egi_fedcloud_auth</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Retrieving an OIDC token from Check-in</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="n">egi_fedcloud_auth</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                <span class="s1">&#39;client_secret&#39;</span><span class="p">:</span> <span class="n">egi_fedcloud_auth</span><span class="p">[</span><span class="s1">&#39;secret&#39;</span><span class="p">],</span>
                <span class="s1">&#39;refresh_token&#39;</span><span class="p">:</span> <span class="n">egi_fedcloud_auth</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">],</span>
                <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="s1">&#39;openid email profile&#39;</span><span class="p">,</span>
                <span class="s1">&#39;grant_type&#39;</span><span class="p">:</span> <span class="s1">&#39;refresh_token&#39;</span>
            <span class="p">}</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;https://aai.egi.eu/oidc/token&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">egi_fedcloud_auth</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> 
                                                                                       <span class="n">egi_fedcloud_auth</span><span class="p">[</span><span class="s1">&#39;secret&#39;</span><span class="p">]))</span>
            <span class="c1">#print(json.dumps(response.json(), indent=2))</span>
            <span class="n">EGItoken</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;access_token&#39;</span><span class="p">]</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;X-Auth-Token&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;egi:&quot;</span> <span class="o">+</span> <span class="n">EGItoken</span><span class="p">,</span>
                <span class="s1">&#39;Content-type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="c1"># get current timestamp</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span> 
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;REST and CDMI access token &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">),</span> 
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="p">{</span> 
                    <span class="s1">&#39;accessToken&#39;</span><span class="p">:</span> <span class="p">{}</span> 
                <span class="p">},</span> 
                <span class="s1">&#39;caveats&#39;</span><span class="p">:</span> <span class="p">[</span> <span class="p">{</span> 
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;interface&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;interface&#39;</span><span class="p">:</span> <span class="s1">&#39;rest&#39;</span> 
                <span class="p">}]</span> 
            <span class="p">})</span>

            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;https://datahub.egi.eu/api/v3/onezone/user/tokens/named&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="n">DATAHUB_TOKEN</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;token&#39;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">DATAHUB_TOKEN</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;EGI Datahub Authentication problem: check your credentials&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">egi_datahub_getlink</span><span class="p">(</span><span class="n">datahub_token</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="n">bname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">datahub_remote_prefix</span> <span class="o">=</span> <span class="s1">&#39;https://cesnet-oneprovider-01.datahub.egi.eu/api/v3/oneprovider/files/&#39;</span>
    <span class="n">hname</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;datahub/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">datahub_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">datahub_remote_prefix</span><span class="p">,</span> <span class="n">hname</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">datahub_location</span><span class="p">)</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;X-Auth-Token&#39;</span><span class="p">:</span> <span class="n">datahub_token</span> <span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">datahub_location</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">dh_fileid</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
    
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;X-Auth-Token&#39;</span><span class="p">:</span> <span class="n">datahub_token</span><span class="p">,</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">bname</span><span class="p">,</span>
    <span class="s1">&#39;fileId&#39;</span><span class="p">:</span> <span class="n">dh_fileid</span>
    <span class="p">})</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;https://cesnet-oneprovider-01.datahub.egi.eu/api/v3/oneprovider/shares&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="c1"># print(json.dumps(response.json(), indent=2))</span>
    <span class="n">shareIdGenerated</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;shareId&#39;</span><span class="p">]</span>
    
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X-Auth-Token&#39;</span><span class="p">:</span> <span class="n">datahub_token</span><span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://cesnet-oneprovider-01.datahub.egi.eu/api/v3/oneprovider/shares/&#39;</span><span class="o">+</span><span class="n">shareIdGenerated</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span> 
    <span class="c1"># print(json.dumps(response.json(), indent=2))</span>
    <span class="n">publicURL</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;publicUrl&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">publicURL</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="egi-datahub-initialization">
<h3>EGI DataHub initialization<a class="headerlink" href="#egi-datahub-initialization" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DATAHUB_TOKEN</span> <span class="o">=</span> <span class="n">egi_datahub_init</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="add-inputs-to-my-ro">
<h2>Add inputs to my RO<a class="headerlink" href="#add-inputs-to-my-ro" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>I used ADAM to retrieve relevant data but to avoid my collaborators to re-download input data, I will be sharing what I retrieved from the data cube.</p></li>
</ul>
<div class="section" id="geojson-file-used-for-rertieving-data-from-adam-data-cube">
<h3>Geojson file used for rertieving data from ADAM data-cube<a class="headerlink" href="#geojson-file-used-for-rertieving-data-from-adam-data-cube" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shared_input_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;fra.geo.json&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">shared_input_path</span><span class="p">)</span>
<span class="n">res_file_url</span> <span class="o">=</span> <span class="n">egi_datahub_getlink</span><span class="p">(</span><span class="n">DATAHUB_TOKEN</span><span class="p">,</span> <span class="n">shared_input_path</span><span class="p">)</span>
<span class="n">res_type</span> <span class="o">=</span> <span class="s2">&quot;Dataset&quot;</span>
<span class="n">res_title</span> <span class="o">=</span> <span class="s2">&quot;Geojson for France&quot;</span>
<span class="n">res_description</span> <span class="o">=</span> <span class="s2">&quot;Geojson file used for retrieving data from the ADAM platform over France&quot;</span>
<span class="n">res_folder</span> <span class="o">=</span> <span class="n">myfolders</span><span class="p">[</span><span class="n">myfolders</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;input&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;identifier&#39;</span><span class="p">]</span>
<span class="n">ro</span><span class="o">.</span><span class="n">add_external_resource</span><span class="p">(</span><span class="n">res_type</span><span class="o">=</span><span class="n">res_type</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">res_file_url</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">res_title</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">res_description</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">res_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/jovyan/datahub/Reliance/Climate/input/fra.geo.json
https://cesnet-oneprovider-01.datahub.egi.eu/api/v3/oneprovider/files/Reliance/Climate/input/fra.geo.json
Resource was successfully created with id = 39998d72-f5b0-4288-be3c-33685ea5157b
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resource(identifier=39998d72-f5b0-4288-be3c-33685ea5157b, post_request=False)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="input-data-retrieved-from-adam-data-cube">
<h3>Input data retrieved from ADAM data-cube<a class="headerlink" href="#input-data-retrieved-from-adam-data-cube" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;2019&#39;</span><span class="p">,</span> <span class="s1">&#39;2020&#39;</span><span class="p">,</span> <span class="s1">&#39;2021&#39;</span><span class="p">]:</span>
    <span class="n">shared_input_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;PM10_FR_ADAMAPI_&#39;</span> <span class="o">+</span> <span class="n">year</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">shared_input_path</span><span class="p">)</span>
    <span class="n">res_file_url</span> <span class="o">=</span> <span class="n">egi_datahub_getlink</span><span class="p">(</span><span class="n">DATAHUB_TOKEN</span><span class="p">,</span> <span class="n">shared_input_path</span><span class="p">)</span>
    <span class="n">res_type</span> <span class="o">=</span> <span class="s2">&quot;Data Cube Product&quot;</span>
    <span class="n">res_title</span> <span class="o">=</span> <span class="s2">&quot;Data-Cube from ADAM platform over France in September &quot;</span> <span class="o">+</span> <span class="n">year</span>
    <span class="n">res_description</span> <span class="o">=</span> <span class="s2">&quot;This dataset is a data-Cube retrieved from the ADAM platform over France in September &quot;</span> <span class="o">+</span> <span class="n">year</span>
    <span class="n">res_folder</span> <span class="o">=</span> <span class="n">myfolders</span><span class="p">[</span><span class="n">myfolders</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;input&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;identifier&#39;</span><span class="p">]</span>
    <span class="n">ro</span><span class="o">.</span><span class="n">add_external_resource</span><span class="p">(</span><span class="n">res_type</span><span class="o">=</span><span class="n">res_type</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">res_file_url</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">res_title</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">res_description</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">res_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/jovyan/datahub/Reliance/Climate/input/PM10_FR_ADAMAPI_2019
https://cesnet-oneprovider-01.datahub.egi.eu/api/v3/oneprovider/files/Reliance/Climate/input/PM10_FR_ADAMAPI_2019
Resource was successfully created with id = 0a5aac29-0ec5-4ebf-aacb-e68970f7bfff
/home/jovyan/datahub/Reliance/Climate/input/PM10_FR_ADAMAPI_2020
https://cesnet-oneprovider-01.datahub.egi.eu/api/v3/oneprovider/files/Reliance/Climate/input/PM10_FR_ADAMAPI_2020
Resource was successfully created with id = 0e1c4d37-1802-483a-beea-de120ed93c67
/home/jovyan/datahub/Reliance/Climate/input/PM10_FR_ADAMAPI_2021
https://cesnet-oneprovider-01.datahub.egi.eu/api/v3/oneprovider/files/Reliance/Climate/input/PM10_FR_ADAMAPI_2021
Resource was successfully created with id = ee5f9da0-4885-4cbc-bb57-c202f110c412
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-our-jupyter-notebook-to-our-ro">
<h3>Add our Jupyter Notebook to our RO<a class="headerlink" href="#add-our-jupyter-notebook-to-our-ro" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Make a copy of the current notebook to the tool folder for sharing as an external resources</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">notebook_filename</span> <span class="o">=</span> <span class="s1">&#39;RELIANCE_v0.2-France.ipynb&#39;</span>
<span class="n">local_notebook_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">notebook_filename</span><span class="p">)</span>
<span class="n">shared_notebook_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TOOL_DATA_DIR</span><span class="p">,</span> <span class="n">notebook_filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shared_notebook_path</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;/home/jovyan/datahub/Reliance/Climate/tool/RELIANCE_v0.2-France.ipynb&#39;
</pre></div>
</div>
</div>
</div>
<div class="section" id="copy-current-notebook-to-shared-datahub">
<h4>Copy current notebook to shared datahub<a class="headerlink" href="#copy-current-notebook-to-shared-datahub" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkfile</span> <span class="o">=</span> <span class="n">shared_notebook_path</span> <span class="o">+</span> <span class="s1">&#39;.bak&#39;</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">bkfile</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">bkfile</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">shared_notebook_path</span><span class="p">,</span> <span class="n">bkfile</span><span class="p">)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">local_notebook_path</span><span class="p">,</span> <span class="n">shared_notebook_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;/home/jovyan/datahub/Reliance/Climate/tool/RELIANCE_v0.2-France.ipynb&#39;
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="create-a-shared-link-for-my-jupyter-notebook">
<h3>Create a shared link for my Jupyter Notebook<a class="headerlink" href="#create-a-shared-link-for-my-jupyter-notebook" title="Permalink to this headline">¶</a></h3>
<div class="section" id="get-public-url-from-egi-datahub-to-share-link-in-ro">
<h4>Get public URL from EGI Datahub to share link in RO<a class="headerlink" href="#get-public-url-from-egi-datahub-to-share-link-in-ro" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_file_url</span> <span class="o">=</span> <span class="n">egi_datahub_getlink</span><span class="p">(</span><span class="n">DATAHUB_TOKEN</span><span class="p">,</span> <span class="n">shared_notebook_path</span><span class="p">)</span>
<span class="n">res_type</span> <span class="o">=</span> <span class="s2">&quot;Jupyter Notebook&quot;</span>
<span class="n">res_title</span> <span class="o">=</span> <span class="s2">&quot;Jupyter Notebook of CAMS European air quality analysis from Copernicus Atmosphere Monitoring with RELIANCE services&quot;</span>
<span class="n">res_description</span> <span class="o">=</span> <span class="s2">&quot;Jupyter Notebook for discovering, accessing and processing RELIANCE data cube, and creating a Research Object with results, and finally publish it in Zenodo&quot;</span>
<span class="n">res_folder</span> <span class="o">=</span> <span class="n">myfolders</span><span class="p">[</span><span class="n">myfolders</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;tool&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;identifier&#39;</span><span class="p">]</span>
<span class="n">ro</span><span class="o">.</span><span class="n">add_external_resource</span><span class="p">(</span><span class="n">res_type</span><span class="o">=</span><span class="n">res_type</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">res_file_url</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">res_title</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">res_description</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">res_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>https://cesnet-oneprovider-01.datahub.egi.eu/api/v3/oneprovider/files/Reliance/Climate/tool/RELIANCE_v0.2-France.ipynb
Resource was successfully created with id = 4fe02379-adae-4606-ba4f-287a4f81d287
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resource(identifier=4fe02379-adae-4606-ba4f-287a4f81d287, post_request=False)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-first-plot-as-image-to-my-research-object-external-resource-from-egi-datahub">
<h4>Add first plot as Image to my Research Object (external resource from EGI Datahub)<a class="headerlink" href="#add-first-plot-as-image-to-my-research-object-external-resource-from-egi-datahub" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shared_plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;PM10_september_FR_2019-2021.png&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">shared_plot_path</span><span class="p">)</span>
<span class="n">res_file_url</span> <span class="o">=</span> <span class="n">egi_datahub_getlink</span><span class="p">(</span><span class="n">DATAHUB_TOKEN</span><span class="p">,</span> <span class="n">shared_plot_path</span><span class="p">)</span>
<span class="n">res_type</span> <span class="o">=</span> <span class="s2">&quot;Image&quot;</span>
<span class="n">res_title</span> <span class="o">=</span> <span class="s2">&quot;Particule matter &lt; 10 μm [μg/m3] over France for September 2019, 2020 and 2021&quot;</span>
<span class="n">res_description</span> <span class="o">=</span> <span class="s2">&quot;Monthly average maps of CAMS Particule matter &lt; 10 μm [μg/m3] over France in 2019, 2020 and 2021&quot;</span>
<span class="n">res_folder</span> <span class="o">=</span> <span class="n">myfolders</span><span class="p">[</span><span class="n">myfolders</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;output&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;identifier&#39;</span><span class="p">]</span>
<span class="n">ro</span><span class="o">.</span><span class="n">add_external_resource</span><span class="p">(</span><span class="n">res_type</span><span class="o">=</span><span class="n">res_type</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">res_file_url</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">res_title</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">res_description</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">res_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/jovyan/datahub/Reliance/Climate/output/PM10_september_FR_2019-2021.png
https://cesnet-oneprovider-01.datahub.egi.eu/api/v3/oneprovider/files/Reliance/Climate/output/PM10_september_FR_2019-2021.png
Resource was successfully created with id = 81a79803-e68c-49e8-92ef-e31ac47040d2
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resource(identifier=81a79803-e68c-49e8-92ef-e31ac47040d2, post_request=False)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-second-plot-as-image-to-my-research-object-external-resource-from-egi-datahub">
<h4>Add second plot as Image to my Research Object (external resource from EGI Datahub)<a class="headerlink" href="#add-second-plot-as-image-to-my-research-object-external-resource-from-egi-datahub" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shared_plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;PM10_september_FR_2021-09-15.png&#39;</span><span class="p">)</span>
<span class="n">res_file_url</span> <span class="o">=</span> <span class="n">egi_datahub_getlink</span><span class="p">(</span><span class="n">DATAHUB_TOKEN</span><span class="p">,</span> <span class="n">shared_plot_path</span><span class="p">)</span>
<span class="n">res_type</span><span class="o">=</span><span class="s2">&quot;Image&quot;</span>
<span class="n">res_title</span><span class="o">=</span><span class="s2">&quot;Particule matter &lt; 10 μm [μg/m3] over France on September 15, 2021&quot;</span>
<span class="n">res_description</span><span class="o">=</span><span class="s2">&quot;Daily average maps of CAMS Particule matter &lt; 10 μm [μg/m3] over France on September 15, 2021&quot;</span>
<span class="n">ro</span><span class="o">.</span><span class="n">add_external_resource</span><span class="p">(</span><span class="n">res_type</span><span class="o">=</span><span class="n">res_type</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">res_file_url</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">res_title</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">res_description</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">res_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>https://cesnet-oneprovider-01.datahub.egi.eu/api/v3/oneprovider/files/Reliance/Climate/output/PM10_september_FR_2021-09-15.png
Resource was successfully created with id = de7387fe-96e1-4945-afdd-87d7055f5399
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resource(identifier=de7387fe-96e1-4945-afdd-87d7055f5399, post_request=False)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-timeseries-for-paris-external-resource-from-egi-datahub">
<h4>Add timeseries for Paris (external resource from EGI Datahub)<a class="headerlink" href="#add-timeseries-for-paris-external-resource-from-egi-datahub" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shared_plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;timeseries_paris_september2021.csv&#39;</span><span class="p">)</span>
<span class="n">res_file_url</span> <span class="o">=</span> <span class="n">egi_datahub_getlink</span><span class="p">(</span><span class="n">DATAHUB_TOKEN</span><span class="p">,</span> <span class="n">shared_plot_path</span><span class="p">)</span>
<span class="n">res_type</span><span class="o">=</span><span class="s2">&quot;Result&quot;</span>
<span class="n">res_title</span><span class="o">=</span><span class="s2">&quot;Timeseries of particule matter &lt; 10 μm [μg/m3] over Paris in september 2021&quot;</span>
<span class="n">res_description</span><span class="o">=</span><span class="s2">&quot;Daily average of CAMS Particule matter &lt; 10 μm [μg/m3] over Paris in September 2021&quot;</span>
<span class="n">ro</span><span class="o">.</span><span class="n">add_external_resource</span><span class="p">(</span><span class="n">res_type</span><span class="o">=</span><span class="n">res_type</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">res_file_url</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">res_title</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">res_description</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">res_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>https://cesnet-oneprovider-01.datahub.egi.eu/api/v3/oneprovider/files/Reliance/Climate/output/timeseries_paris_september2021.csv
Resource was successfully created with id = 030e5afa-283e-43f0-b572-01b60c65c6ca
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resource(identifier=030e5afa-283e-43f0-b572-01b60c65c6ca, post_request=False)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="add-netcdf-file-corresponding-to-data-cube-selection-external-resource-from-egi-datahub">
<h4>Add netCDF file corresponding to Data cube selection (external resource from EGI Datahub)<a class="headerlink" href="#add-netcdf-file-corresponding-to-data-cube-selection-external-resource-from-egi-datahub" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shared_plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;PM10_september_FR_2019-2021.nc&#39;</span><span class="p">)</span>
<span class="n">res_file_url</span> <span class="o">=</span> <span class="n">egi_datahub_getlink</span><span class="p">(</span><span class="n">DATAHUB_TOKEN</span><span class="p">,</span> <span class="n">shared_plot_path</span><span class="p">)</span>
<span class="n">res_type</span><span class="o">=</span><span class="s2">&quot;Result&quot;</span>
<span class="n">res_title</span><span class="o">=</span><span class="s2">&quot;netCDF data for daily PM10 concentration over France in September 2019, 2020 and 2021&quot;</span>
<span class="n">res_description</span><span class="o">=</span><span class="s2">&quot;netCDF data corresponding to daily average of CAMS Particule matter &lt; 10 μm [μg/m3] over France for September 2019, September 2020 and September 2021&quot;</span>
<span class="n">ro</span><span class="o">.</span><span class="n">add_external_resource</span><span class="p">(</span><span class="n">res_type</span><span class="o">=</span><span class="n">res_type</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">res_file_url</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">res_title</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">res_description</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="n">res_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>https://cesnet-oneprovider-01.datahub.egi.eu/api/v3/oneprovider/files/Reliance/Climate/output/PM10_september_FR_2019-2021.nc
Resource was successfully created with id = 9c8e8af4-6999-43d3-ad00-0c482ec7384b
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resource(identifier=9c8e8af4-6999-43d3-ad00-0c482ec7384b, post_request=False)
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="additional-metadata-for-the-ro">
<h2>Additional metadata for the RO<a class="headerlink" href="#additional-metadata-for-the-ro" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#ro.add_annotations(&quot;EOSC Jupyter Notebook&quot;)</span>
<span class="c1">#ro.add_annotations(&quot;Pangeo Notebook&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="add-geolocation-to-my-research-object">
<h3>Add geolocation to my Research Object<a class="headerlink" href="#add-geolocation-to-my-research-object" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>We need to transform our geojson file to geojson-ld</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geojson_ld_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;fra.geo-ld.json&#39;</span><span class="p">)</span>
<span class="n">bkfile</span> <span class="o">=</span> <span class="n">geojson_ld_file</span> <span class="o">+</span> <span class="s1">&#39;.bak&#39;</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">bkfile</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">bkfile</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">geojson_ld_file</span><span class="p">,</span> <span class="n">bkfile</span><span class="p">)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;fra.geo.json&#39;</span><span class="p">),</span> <span class="n">geojson_ld_file</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">geojson_ld_file</span> <span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;@context&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;geojson&quot;</span><span class="p">:</span> <span class="s2">&quot;https://purl.org/geojson/vocab#&quot;</span> <span class="p">}</span> 
    <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>        
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">truncate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geolocation_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">INPUT_DATA_DIR</span><span class="p">,</span> <span class="s1">&#39;fra.geo-ld.json&#39;</span><span class="p">)</span> 
<span class="n">ro</span><span class="o">.</span><span class="n">add_geolocation</span><span class="p">(</span><span class="n">body_specification_json</span><span class="o">=</span><span class="n">geolocation_file_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;identifier&#39;: &#39;4b10ec21-8232-4aee-b23d-ee9f37dce383&#39;,
  &#39;name&#39;: &#39;annotations/4b10ec21-8232-4aee-b23d-ee9f37dce383&#39;,
  &#39;filename&#39;: &#39;.ro/annotations/4b10ec21-8232-4aee-b23d-ee9f37dce383.ttl&#39;,
  &#39;relation&#39;: False,
  &#39;read_only&#39;: False,
  &#39;target&#39;: &#39;b13d7b6a-66bf-40df-84c8-f9c88775b6c1&#39;,
  &#39;ro&#39;: &#39;b13d7b6a-66bf-40df-84c8-f9c88775b6c1&#39;,
  &#39;resources&#39;: [],
  &#39;created&#39;: &#39;2022-01-18T18:30:45.529314+0000&#39;,
  &#39;creator&#39;: &#39;annefou@geo.uio.no&#39;,
  &#39;modificator&#39;: None,
  &#39;modified&#39;: &#39;2022-01-18T18:30:45.529243+0000&#39;,
  &#39;authors_credits&#39;: [&#39;annefou@geo.uio.no&#39;],
  &#39;contributors_credits&#39;: [],
  &#39;api_link&#39;: &#39;https://api.rohub.org/api/annotations/4b10ec21-8232-4aee-b23d-ee9f37dce383/&#39;}]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="export-to-ro-crate">
<h3>Export to RO-crate<a class="headerlink" href="#export-to-ro-crate" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ro</span><span class="o">.</span><span class="n">export_to_rocrate</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;climate_EU-CAMS_ro-crate&quot;</span><span class="p">,</span> <span class="n">use_format</span><span class="o">=</span><span class="s2">&quot;zip&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>File was successfully downloaded.
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="take-a-snapshot-of-my-ro">
<h3>Take a snapshot of my RO<a class="headerlink" href="#take-a-snapshot-of-my-ro" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">snapshot_id</span><span class="o">=</span><span class="n">ro</span><span class="o">.</span><span class="n">snapshot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Trying to confirm status of the job. It can take a while...
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="archive-and-publish-to-zenodo-optionally-assign-doi">
<h3>Archive and publish to Zenodo, optionally assign DOI<a class="headerlink" href="#archive-and-publish-to-zenodo-optionally-assign-doi" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">snapshot_title</span><span class="o">=</span><span class="s2">&quot;Jupyter Notebook Analysing the Air quality during Covid-19 pandemic using Copernicus Atmosphere Monitoring Service&quot;</span>
<span class="n">snapshot_id_pub</span><span class="o">=</span><span class="n">ro</span><span class="o">.</span><span class="n">snapshot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">snapshot_title</span><span class="p">,</span> <span class="n">create_doi</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">publication_services</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Zenodo&quot;</span><span class="p">])</span>
<span class="n">snapshot_id_pub</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="load-the-published-research-object">
<h3>Load the published Research Object<a class="headerlink" href="#load-the-published-research-object" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">published_ro</span> <span class="o">=</span> <span class="n">rohub</span><span class="o">.</span><span class="n">ros_load</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="n">snapshot_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="show-the-doi-and-get-the-link">
<h3>Show the DOI and get the link<a class="headerlink" href="#show-the-doi-and-get-the-link" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">published_ro</span><span class="o">.</span><span class="n">show_publication</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="fork-and-reuse-existing-ro-to-create-derivative-work">
<h3>Fork and reuse existing RO to create derivative work<a class="headerlink" href="#fork-and-reuse-existing-ro-to-create-derivative-work" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fork_id</span><span class="o">=</span><span class="n">ro</span><span class="o">.</span><span class="n">fork</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Forked Jupyter Notebook to analyze  the Air quality during Covid-19 pandemic using Copernicus Atmosphere Monitoring Servic&quot;</span><span class="p">)</span>
<span class="n">forked_ro</span> <span class="o">=</span> <span class="n">rohub</span><span class="o">.</span><span class="n">ros_load</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="n">fork_id</span><span class="p">)</span>
<span class="n">forked_ro</span><span class="o">.</span><span class="n">show_metadata</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./demo-eosc-future"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="RELIANCE-Datacube-featuring-EOSC_v0.2.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Using CAMS European air quality analysis from Copernicus Atmosphere Monitoring with RELIANCE services</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../science/intro.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Notebooks from researchers</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Anne Fouilloux<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>